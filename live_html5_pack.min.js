function CommentFilter(){this.modifiers=[],this.runtime=null,this.allowTypes={1:!0,4:!0,5:!0,6:!0,7:!0,8:!0,17:!0},this.doModify=function(t){for(var e=0;e<this.modifiers.length;e++)t=this.modifiers[e](t);return t},this.beforeSend=function(t){return t},this.doValidate=function(t){return!!this.allowTypes[t.mode]},this.addRule=function(t){},this.addModifier=function(t){this.modifiers.push(t)},this.runtimeFilter=function(t){return null==this.runtime?t:this.runtime(t)},this.setRuntimeFilter=function(t){this.runtime=t}}function isMobile(){var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t}var shield=function(){var t,e=!0,i=1,o=null,n=0,a=!1,s=[],l=function(t){return document.querySelectorAll(t)},r=function(t){return document.querySelector(t)},c=null,d={init:function(i){if(e){void 0!=i&&(c=i),e=!1,shield.tab(0),void 0==localStorage.shieldList&&(localStorage.shieldList='{"text":[],"user":[],"color":[],"useReg":false}'),o=JSON.parse(localStorage.shieldList),void 0==o.color&&(o.color=[]),void 0==o.useReg&&(o.useReg=!1),a=o.useReg,t=o.limit,d.render();var s,h,u;for(u=l(".shield_tab"),s=0,h=u.length;s<h;s++)u[s].tabNum=s,u[s].addEventListener("mouseenter",function(){d.tab(this.tabNum)}),u[s].addEventListener("mouseleave",function(t){var e=this.getBoundingClientRect(),i=t.clientX,o=t.clientY;(i-e.left<0||i-e.left>e.width||o-e.top<0||o-e.top>e.height)&&d.tab(n)}),u[s].addEventListener("click",function(){d.switchTab(this.tabNum)});r(".shield-enrty").addEventListener("click",shield.show),r(".shield .close").addEventListener("click",shield.show),r(".shield .add").addEventListener("click",shield.add),r("#useReg").addEventListener("click",function(){a=!a,d.save(),d.render(3)})}},switchTab:function(t){n=t,r(".shield_body_wrapper").style.transform="translateX("+t*-278+"px)",r(".shield_body_wrapper").style.webkitTransform="translateX("+t*-278+"px)"},tab:function(t){var e=r(".shield"),i=e.getBoundingClientRect(),o=r(".shield .shield_tab:nth-of-type("+(t+1)+")>div").getBoundingClientRect(),n=o.left-i.left,a=o.width,s=r(".shield .shield_tab_slash");s.style.left=n+"px",s.style.width=a+"px"},render:function(t){var e=!0,i=0;for(void 0!=t&&(e=!1,i=t);;){switch(i){case 0:var n,s,c,h="";for(n=0,s=o.text.length;n<s;n++)h+='<div class="shield_item"><div class="text">'+o.text[n]+'</div><div class="delete"></div></div>';for(r("#shield_text").innerHTML=h,c=l("#shield_text .shield_item .delete"),n=0,s=c.length;n<s;n++)c[n].onclick=d.del;break;case 1:for(var c,h="",n=0;n<o.user.length;n++)h+='<div class="shield_item"><div class="text">'+o.user[n]+" mid "+crc_engine(o.user[n])+'</div><div class="delete"></div></div>';for(0==n&&(h='<div class="shield_item">'+ABP.Strings.blockUserEmpty+"</div>"),r("#shield_user").innerHTML=h,c=l("#shield_user .shield_item .delete"),n=0,s=c.length;n<s;n++)c[n].onclick=d.delUser;break;case 2:for(var u,c,h="",n=0;n<o.color.length;n++){for(u=o.color[n].toString(16);u.length<6;)u="0"+u;h+='<div class="shield_color"><div class="color" style="background:#'+u+'">'+o.color[n]+'</div><div class="delete"></div></div>'}for(0==n&&(h='<div class="shield_color">'+ABP.Strings.blockColorEmpty+"</div>"),r("#shield_color").innerHTML=h,c=l("#shield_color .shield_color .delete"),n=0,s=c.length;n<s;n++)c[n].onclick=d.delColor;break;case 3:r("#useReg").className="shield_toggle"+(a?" on":"");break;default:return}i++}},save:function(){o.useReg=a,o.limit=t,localStorage.shieldList=JSON.stringify(o),d.shield()},show:function(){i?l(".shield")[0].setAttribute("class","shield"):l(".shield")[0].setAttribute("class","shield hidden"),i^=1},add:function(){d.addText(r(".shield_item .new").value),r(".shield_item .new").value=""},addText:function(t){return""!=t&&o.text.indexOf(t)==-1&&(o.text.push(t),d.save(),void d.render(0))},addUser:function(t){return o.user.indexOf(t)==-1&&(o.user.push(t),d.save(),void d.render(1))},addColor:function(t){return t=parseInt(t,16),!isNaN(t)&&o.color.indexOf(t)==-1&&(o.color.push(t),d.save(),void d.render(2))},del:function(t){var e,i=t.target.parentNode.childNodes[0].innerHTML,n=o.text.indexOf(i);return n!=-1&&(e=o.text.splice(0,n),o.text=e.concat(o.text.splice(1)),d.save(),void d.render(0))},delUser:function(t){var e,i=t.target.parentNode.childNodes[0].innerHTML.split(" ")[0],n=o.user.indexOf(i);return n!=-1&&(e=o.user.splice(0,n),o.user=e.concat(o.user.splice(1)),d.save(),void d.render(1))},delColor:function(t){var e,i=t.target.parentNode.childNodes[0].innerHTML,n=o.color.indexOf(1*i);return n!=-1&&(e=o.color.splice(0,n),o.color=e.concat(o.color.splice(1)),d.save(),void d.render(2))},filterChk:function(t){var e;if(o.color.indexOf(t.color)!=-1||o.user.indexOf(t.hash)!=-1)return!1;for(e=0;e<s.length;e++)try{if(null!=t.text.match(s[e]))return!1}catch(t){}return!0},filter:function(t){return!!shield.filterChk(t)&&(t.filtered||(t.oriSize=t.size,t.filtered=!0),t.size=t.oriSize*abpinst.commentScale,t)},shield:function(){s=[];var t,e,i,n=c.cmManager.runline;for(e=0;e<o.text.length;e++)s.push(a?new RegExp(o.text[e]):o.text[e]);for(t=0;t<n.length;t++)if(i=n[t],o.color.indexOf(i.color)!=-1||o.user.indexOf(i.originalData.hash)!=-1)i.finish(),t--;else for(e=0;e<s.length;e++)if(null!=i.text.match(e)){i.finish(),t--;break}}};return d}();window.shield=shield,unsafeWindow.shield=shield;var BinArray=function(){var t={};return t.bsearch=function(t,e,i){if(0===t.length)return 0;if(i(e,t[0])<0)return 0;if(i(e,t[t.length-1])>=0)return t.length;for(var o=0,n=0,a=0,s=t.length-1;o<=s;){if(n=Math.floor((s+o+1)/2),a++,i(e,t[n-1])>=0&&i(e,t[n])<0)return n;i(e,t[n-1])<0?s=n-1:i(e,t[n])>=0?o=n:console.error("Program Error"),a>1500&&console.error("Too many run cycles.")}return-1},t.binsert=function(e,i,o){var n=t.bsearch(e,i,o);return e.splice(n,0,i),n},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},CommentSpaceAllocator=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._pools=[[]],this.avoid=1,this._width=t,this._height=e}return t.prototype.willCollide=function(t,e){return t.stime+t.ttl>=e.stime+e.ttl/2},t.prototype.pathCheck=function(t,e,i){for(var o=t+e.height,n=e.right,a=0;a<i.length;a++)if(!(i[a].y>o||i[a].bottom<t)){if(!(i[a].right<e.x||i[a].x>n))return!1;if(this.willCollide(i[a],e))return!1}return!0},t.prototype.assign=function(t,e){for(;this._pools.length<=e;)this._pools.push([]);var i=this._pools[e];if(0===i.length)return t.cindex=e,0;if(this.pathCheck(0,t,i))return t.cindex=e,0;for(var o=0,n=0;n<i.length&&(o=i[n].bottom+this.avoid,!(o+t.height>this._height));n++)if(this.pathCheck(o,t,i))return t.cindex=e,o;return this.assign(t,e+1)},t.prototype.add=function(t){t.height>this._height?(t.cindex=-2,t.y=0):(t.y=this.assign(t,0),BinArray.binsert(this._pools[t.cindex],t,function(t,e){return t.bottom<e.bottom?-1:t.bottom>e.bottom?1:0}))},t.prototype.remove=function(t){if(!(t.cindex<0)){if(t.cindex>=this._pools.length)throw new Error("cindex out of bounds");var e=this._pools[t.cindex].indexOf(t);e<0||this._pools[t.cindex].splice(e,1)}},t.prototype.setBounds=function(t,e){this._width=t,this._height=e},t}(),AnchorCommentSpaceAllocator=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.add=function(e){t.prototype.add.call(this,e),e.x=(this._width-e.width)/2},e.prototype.willCollide=function(t,e){return!0},e.prototype.pathCheck=function(t,e,i){for(var o=t+e.height,n=0;n<i.length;n++)if(!(i[n].y>o||i[n].bottom<t))return!1;return!0},e}(CommentSpaceAllocator),CoreComment=function(){function t(e,i){if(void 0===i&&(i={}),this.mode=1,this.stime=0,this.text="",this.ttl=4e3,this.dur=4e3,this.cindex=-1,this.motion=[],this.movable=!0,this._alphaMotion=null,this.absolute=!0,this.align=0,this._alpha=1,this._size=25,this._color=16777215,this._border=!1,this._shadow=!0,this._font="",!e)throw new Error("Comment not bound to comment manager.");if(this.parent=e,i.hasOwnProperty("stime")&&(this.stime=i.stime),i.hasOwnProperty("mode")?this.mode=i.mode:this.mode=1,i.hasOwnProperty("dur")&&(this.dur=i.dur,this.ttl=this.dur),this.dur*=this.parent.options.global.scale,this.ttl*=this.parent.options.global.scale,4!==this.mode&&5!==this.mode||(this.dur*=.6,this.ttl*=.6),i.hasOwnProperty("text")&&(this.text=i.text),i.hasOwnProperty("motion")){this._motionStart=[],this._motionEnd=[],this.motion=i.motion;for(var o=0,n=0;n<i.motion.length;n++){this._motionStart.push(o);var a=0;for(var s in i.motion[n]){var l=i.motion[n][s];a=Math.max(l.dur,a),null!==l.easing&&void 0!==l.easing||(i.motion[n][s].easing=t.LINEAR)}o+=a,this._motionEnd.push(o)}this._curMotion=0}i.hasOwnProperty("color")&&(this._color=i.color),i.hasOwnProperty("size")&&(this._size=i.size),i.hasOwnProperty("border")&&(this._border=i.border),i.hasOwnProperty("opacity")&&(this._alpha=i.opacity),i.hasOwnProperty("alpha")&&(this._alphaMotion=i.alpha),i.hasOwnProperty("font")&&(this._font=i.font),i.hasOwnProperty("x")&&(this._x=i.x),i.hasOwnProperty("y")&&(this._y=i.y),i.hasOwnProperty("shadow")&&(this._shadow=i.shadow),i.hasOwnProperty("position")&&"relative"===i.position&&(this.absolute=!1,this.mode<7&&console.warn("Using relative position for CSA comment."))}return t.prototype.init=function(t){void 0===t&&(t=null),null!==t?this.dom=t.dom:this.dom=document.createElement("div"),this.dom.className=this.parent.options.global.className,this.dom.appendChild(document.createTextNode(this.text)),this.dom.textContent=this.text,this.dom.innerText=this.text,this.size=this._size,16777215!=this._color&&(this.color=this._color),this.shadow=this._shadow,this._border&&(this.border=this._border),""!==this._font&&(this.font=this._font),void 0!==this._x&&(this.x=this._x),void 0!==this._y&&(this.y=this._y),(1!==this._alpha||this.parent.options.global.opacity<1)&&(this.alpha=this._alpha),this.motion.length>0&&this.animate()},Object.defineProperty(t.prototype,"x",{get:function(){return null!==this._x&&void 0!==this._x||(this.align%2===0?this._x=this.dom.offsetLeft:this._x=this.parent.width-this.dom.offsetLeft-this.width),this.absolute?this._x:this._x/this.parent.width},set:function(t){this._x=t,this.absolute||(this._x*=this.parent.width),this.align%2===0?this.dom.style.left=this._x+"px":this.dom.style.right=this._x+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return null!==this._y&&void 0!==this._y||(this.align<2?this._y=this.dom.offsetTop:this._y=this.parent.height-this.dom.offsetTop-this.height),this.absolute?this._y:this._y/this.parent.height},set:function(t){this._y=t,this.absolute||(this._y*=this.parent.height),this.align<2?this.dom.style.top=this._y+"px":this.dom.style.bottom=this._y+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return null!==this._width&&void 0!==this._width||(this._width=this.dom.offsetWidth),this._width},set:function(t){this._width=t,this.dom.style.width=this._width+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return null!==this._height&&void 0!==this._height||(this._height=this.dom.offsetHeight),this._height},set:function(t){this._height=t,this.dom.style.height=this._height+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},set:function(t){this._size=t,this.dom.style.fontSize=this._size+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t;var e=t.toString(16);e=e.length>=6?e:new Array(6-e.length+1).join("0")+e,this.dom.style.color="#"+e,0===this._color&&(this.dom.className=this.parent.options.global.className+" rshadow")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t,this.dom.style.opacity=Math.min(this._alpha,this.parent.options.global.opacity)+""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"border",{get:function(){return this._border},set:function(t){this._border=t,this._border?this.dom.style.border="1px solid #00ffff":this.dom.style.border="none"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadow",{get:function(){return this._shadow},set:function(t){this._shadow=t,this._shadow||(this.dom.className=this.parent.options.global.className+" noshadow")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"font",{get:function(){return this._font},set:function(t){this._font=t,this._font.length>0?this.dom.style.fontFamily=this._font:this.dom.style.fontFamily=""},enumerable:!0,configurable:!0}),t.prototype.time=function(t){this.ttl-=t,this.ttl<0&&(this.ttl=0),this.movable&&this.update(),this.ttl<=0&&this.finish()},t.prototype.update=function(){this.animate()},t.prototype.invalidate=function(){this._x=null,this._y=null,this._width=null,this._height=null},t.prototype._execMotion=function(t,e){for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];this[i]=o.easing(Math.min(Math.max(e-o.delay,0),o.dur),o.from,o.to-o.from,o.dur)}},t.prototype.animate=function(){if(this._alphaMotion&&(this.alpha=(this.dur-this.ttl)*(this._alphaMotion.to-this._alphaMotion.from)/this.dur+this._alphaMotion.from),0!==this.motion.length){var t=Math.max(this.ttl,0),e=this.dur-t-this._motionStart[this._curMotion];return this._execMotion(this.motion[this._curMotion],e),this.dur-t>this._motionEnd[this._curMotion]?(this._curMotion++,void(this._curMotion>=this.motion.length&&(this._curMotion=this.motion.length-1))):void 0}},t.prototype.stop=function(){},t.prototype.finish=function(){this.parent.finish(this)},t.prototype.toString=function(){return["[",this.stime,"|",this.ttl,"/",this.dur,"]","(",this.mode,")",this.text].join("")},t.LINEAR=function(t,e,i,o){return t*i/o+e},t}(),ScrollComment=function(t){function e(e,i){t.call(this,e,i),this.dur*=this.parent.options.scroll.scale,this.ttl*=this.parent.options.scroll.scale}return __extends(e,t),Object.defineProperty(e.prototype,"alpha",{set:function(t){this._alpha=t,this.dom.style.opacity=Math.min(Math.min(this._alpha,this.parent.options.global.opacity),this.parent.options.scroll.opacity)+""},enumerable:!0,configurable:!0}),e.prototype.init=function(e){void 0===e&&(e=null),t.prototype.init.call(this,e),this.x=this.parent.width,this.parent.options.scroll.opacity<1&&(this.alpha=this._alpha),this.absolute=!0},e.prototype.update=function(){this.x=this.ttl/this.dur*(this.parent.width+this.width)-this.width},e}(CoreComment),CSSCompatLayer=function(){function t(){}return t.transform=function(t,e){t.style.transform=e,t.style.webkitTransform=e,t.style.msTransform=e,t.style.oTransform=e},t}(),CSSScrollComment=function(t){function e(){t.apply(this,arguments),this._dirtyCSS=!0}return __extends(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this.ttl/this.dur*(this.parent.width+this.width)-this.width},set:function(t){if("number"==typeof this._x){var e=t-this._x;this._x=t,CSSCompatLayer.transform(this.dom,"translateX("+e+"px)")}else this._x=t,this.absolute||(this._x*=this.parent.width),this.align%2===0?this.dom.style.left=this._x+"px":this.dom.style.right=this._x+"px"},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._dirtyCSS&&(this.dom.style.transition="transform "+this.ttl+"ms linear",this.x=-this.width,this._dirtyCSS=!1)},e.prototype.invalidate=function(){t.prototype.invalidate.call(this),this._dirtyCSS=!0},e.prototype.stop=function(){this.dom.style.transition="",this.x=this._x,this._x=null,this.x=this.ttl/this.dur*(this.parent.width+this.width)-this.width,this._dirtyCSS=!0},e}(ScrollComment),CommentManager=function(){function t(t){var e=0,o=this;this._listeners={},this._lastPosition=0,this.stage=t,this.paused=!0,this.pausedTime=0,this.canvas=document.createElement("canvas"),this.canvasStatic=document.createElement("canvas"),this.staticUpdate=!1,this.canvasFPS=0,o.canvas.style.width="100%",o.canvas.style.height="100%",o.stage.appendChild(o.canvas),o.canvasStatic.style.width="100%",o.canvasStatic.style.height="100%",o.canvasStatic.style.position="absolute",o.canvasStatic.style.top=0,o.canvasStatic.style.left=0,o.stage.appendChild(o.canvasStatic),this.options={global:{opacity:1,scale:1,className:"cmt",useCSS:!1,autoOpacity:!1,autoOpacityVal:1},scroll:{opacity:1,scale:1},limit:0},this.timeline=[],this.runline=[],this.position=0,this.limiter=0,this.filter=null,this.csa={scroll:new CommentSpaceAllocator(0,0),top:new AnchorCommentSpaceAllocator(0,0),bottom:new AnchorCommentSpaceAllocator(0,0),reverse:new CommentSpaceAllocator(0,0),scrollbtm:new CommentSpaceAllocator(0,0)},this.width=this.stage.offsetWidth,this.height=this.stage.offsetHeight;var n=0;this.startTimer=function(){if(!(e>0)){var t=(new Date).getTime(),i=this;e=window.setInterval(function(){var e=(new Date).getTime()-t;t=(new Date).getTime(),i.onTimerEvent(e,i),i.sendQueueLoader()},1e3/60),this.paused=!1,this.pausedTime=Date.now()-n}},this.stopTimer=function(){window.clearInterval(e),e=0,this.paused=!0,n=Date.now()};var a=(this.options.global.opacity,!1),s=0,l=0,r=function(){o.options.global.autoOpacity&&(o.options.global.useCSS?o.stage.style.opacity=i(l):o.options.global.autoOpacityVal=o.options.global.opacity*i(l))};setInterval(function(){o.canvasFPS=s,s=0},1e3),this.addEventListener("enterComment",function(){l++,r()}),this.addEventListener("exitComment",function(){l--,r()}),this.canvasDrawerWrapper=function(t){a||(t||(t=performance.now()),a=!0,s++,o.canvasDrawer(0|t),a=!1)},this.ttlRecalcAll=function(){this.runline.forEach(c)};var h=[];this.send=function(t){h.push(t)},this.sendQueueLoader=function(){for(var t,e=performance.now();h.length>0;)if(o.sendAsync(h.shift()),t=performance.now()-e,t>8)return},this.addEventListener("clear",function(){h=[]}),requestAnimationFrame(this.canvasDrawerWrapper),function(){var t=window.devicePixelRatio;window.addEventListener("resize",function(){var e=window.devicePixelRatio;t!=e&&(o.runline.forEach(function(t){t.textData&&d(t)}),t=e),o.ttlRecalcAll()})}()}var e=function(t,e){for(var i=Math.PI/180,o=t*i,n=e*i,a=Math.cos,s=Math.sin,l=[a(o)*a(n),a(o)*s(n),s(o),0,-s(n),a(n),0,0,-s(o)*a(n),-s(o)*s(n),a(o),0,0,0,0,1],r=0;r<l.length;r++)Math.abs(l[r])<1e-6&&(l[r]=0);return"matrix3d("+l.join(",")+")"},i=function(t){return-Math.tanh((t-50)/25)/Math.PI*.8+.718},o="-apple-system,Arial,'PingFang SC','STHeiti Light','Hiragino Kaku Gothic ProN','Microsoft YaHei'";t.prototype.stop=function(){this.stopTimer();for(var t=0;t<this.runline.length;t++)"undefined"!=typeof this.runline[t].stop&&this.runline[t].stop()},t.prototype.start=function(){this.startTimer()},t.prototype.seek=function(t){this.position=BinArray.bsearch(this.timeline,t,function(t,e){return t<e.stime?-1:t>e.stime?1:0})},t.prototype.validate=function(t){return null!=t&&this.filter.doValidate(t)},t.prototype.load=function(t){this.timeline=t,this.timeline.sort(function(t,e){return t.stime>e.stime?2:t.stime<e.stime?-2:t.date>e.date?1:t.date<e.date?-1:null!=t.dbid&&null!=e.dbid?t.dbid>e.dbid?1:t.dbid<e.dbid?-1:0:0}),this.dispatchEvent("load")},t.prototype.insert=function(t){var e=BinArray.binsert(this.timeline,t,function(t,e){return t.stime>e.stime?2:t.stime<e.stime?-2:t.date>e.date?1:t.date<e.date?-1:null!=t.dbid&&null!=e.dbid?t.dbid>e.dbid?1:t.dbid<e.dbid?-1:0:0});e<=this.position&&this.position++,this.dispatchEvent("insert")},t.prototype.clear=function(){for(;this.runline.length>0;)this.runline[0].finish();this.dispatchEvent("clear"),this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.canvasStatic.getContext("2d").clearRect(0,0,this.canvasStatic.width,this.canvasStatic.height)},t.prototype.setBounds=function(){this.width=this.stage.offsetWidth,this.height=this.stage.offsetHeight,this.dispatchEvent("resize");for(var t in this.csa)this.csa[t].setBounds(this.width,this.height);this.stage.style.perspective=this.width*Math.tan(40*Math.PI/180)/2+"px",this.stage.style.webkitPerspective=this.width*Math.tan(40*Math.PI/180)/2+"px"},t.prototype.init=function(){this.setBounds(),null==this.filter&&(this.filter=new CommentFilter)},t.prototype.time=function(t){if(t-=1,this.position>=this.timeline.length||Math.abs(this._lastPosition-t)>=2e3){if(this.seek(t),this._lastPosition=t,this.timeline.length<=this.position)return}else this._lastPosition=t;for(;this.position<this.timeline.length&&this.timeline[this.position].stime<=t;this.position++)this.options.limit>0&&this.runline.length>this.limiter||this.validate(this.timeline[this.position])&&this.send(this.timeline[this.position])},t.prototype.canvasResize=function(){try{var t=(this.width,this.height,window.devicePixelRatio);this.canvas.width=this.canvas.offsetWidth*t,this.canvasStatic.height=this.canvasStatic.offsetHeight*t,this.ttlRecalcAll(),n(this),a(this)}catch(t){return console.error("shit happened! forcing CSS! ",t.message),void this.useCSS(!0)}};var n=function(t){var e,i,o,n,a=t.canvasStatic,s=a.getContext("2d"),r=window.devicePixelRatio,c=t.height,d=[0];t.runline.forEach(function(t){[4,5].indexOf(t.mode)!=-1&&d.push(t._width)}),d=Math.min(t.width,Math.max.apply(Math,d)),e=d,n=(t.width-d)/2,d!=a.offsetWidth?(a.style.width=d+"px",a.style.left="calc(50% - "+d/2+"px)",a.width=d*r):s.clearRect(0,0,e*r,c*r),s.globalAlpha=t.options.global.autoOpacity?t.options.global.autoOpacityVal:t.options.global.opacity,t.runline.forEach(function(t){if(t.textData){switch(t.mode){case 4:t.x=(e-t.width)/2+n,i=t.x-n,o=c-t.y-t.height;break;case 5:t.x=(e-t.width)/2+n,i=t.x-n,o=t.y;break;default:return}s.drawImage(t.textData,l(i*r),l(o*r))}})},a=function(t){var e,i,o,n=t.canvas,a=n.getContext("2d"),s=window.devicePixelRatio,r=t.width,c=[0];t.runline.forEach(function(t){1==t.mode&&c.push(t._y+t._height)}),c=Math.max.apply(Math,c),e=c,n.offsetHeight!=c?(n.style.height=c+"px",n.height=c*s):a.clearRect(0,0,r*s,e*s),a.globalAlpha=t.options.global.autoOpacity?t.options.global.autoOpacityVal:t.options.global.opacity,t.runline.forEach(function(t){if(t.textData){switch(t.mode){case 1:t.x=r-t.rx,i=r-t.rx,o=t.y;break;default:return}a.drawImage(t.textData,l(i*s),l(o*s))}})};t.prototype.canvasDrawer=function(){if(!this.options.global.useCSS){if(this.paused)return void requestAnimationFrame(this.canvasDrawerWrapper);var t=0|performance.now(),e=window.devicePixelRatio,i=this.pausedTime,o=this.canvas.getContext("2d"),s=this.width,l=this.height;o.clearRect(0,0,s*e,l*e),o.globalAlpha=this.options.global.autoOpacity?this.options.global.autoOpacityVal:this.options.global.opacity,o.imageSmoothingEnabled=!1,0!=i&&(this.runline.forEach(function(t){if(t.textData)switch(t.mode){case 1:t.prev+=i;break;case 4:case 5:t.removeTime+=i}}),this.pausedTime=0),this.runline.forEach(function(e){if(e.textData)switch(e.mode){case 1:e.rx+=e.speed*(t-e.prev)/1e3,e.prev=t}}),this.staticUpdate&&(n(this),this.staticUpdate=!1),a(this),requestAnimationFrame(this.canvasDrawerWrapper)}};var s=Math.ceil,l=Math.round,r=function(t){for(var t=t.toString(16);t.length<6;)t="0"+t;return t},c=function(t){if(t.speed){var e=t.dur-t.ttl;t.dur=(t.parent.width+t.width)/t.speed*1e3,t.ttl=t.dur-e}},d=function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),n=window.devicePixelRatio;i.font=t.size*n+"px "+o,i.imageSmoothingEnabled=!1,t.width=s(i.measureText(t.text).width/n)+2,t.height=s(t.size+3)+2,t.oriWidth=s(t.width*n),t.oriHeight=s(t.height*n),e.width=t.oriWidth,e.height=t.oriHeight,i.font=t.size*n+"px "+o,i.lineWidth=l(1*n),i.strokeStyle=0==t._color?"#FFFFFF":"#000000",i.textBaseline="bottom",i.textAlign="left",i.shadowBlur=l(2*n),i.shadowColor=0==t._color?"#FFFFFF":"#000000",i.fillStyle="#"+r(t.color),i.strokeText(t.text,1,e.height-1),i.fillText(t.text,1,e.height-1),t.border&&(i.lineWidth=l(2*n),i.strokeStyle="#00ffff",i.shadowBlur=0,i.strokeRect(0,0,e.width,e.height)),t.textData=e};return t.prototype.getCommentFromPoint=function(t,e){var i,o,n=[],a=this.height;return this.runline.forEach(function(s){i=t-s.x,o=4==s.mode?e-(a-s.y-s.height):e-s.y,i>=0&&i<=s.width&&o>=0&&o<=s.height&&n.push(s)}),n},t.prototype.useCSS=function(t){this.options.global.useCSS=t,this.clear(),t||(this.stage.style.opacity="",requestAnimationFrame(this.canvasDrawerWrapper))},t.prototype.autoOpacity=function(t){this.options.global.autoOpacity=t},t.prototype.sendAsync=function(t){if(8===t.mode)return console.log(t),void(this.scripting&&console.log(this.scripting.eval(t.code)));if(null==this.filter||(t=this.filter.doModify(t),null!=t&&t!==!1)){if(this.options.global.useCSS||[1,4,5].indexOf(t.mode)==-1){if(1===t.mode||2===t.mode||6===t.mode)var i=new CSSScrollComment(this,t);else var i=new CoreComment(this,t);switch(i.mode){case 1:i.align=0;break;case 2:i.align=2;break;case 4:i.align=2;break;case 5:i.align=0;break;case 6:i.align=1}switch(i.init(),this.stage.appendChild(i.dom),i.dom.transitionStartTime=(new Date).getTime(),i.mode){default:case 1:this.csa.scroll.add(i);break;case 2:this.csa.scrollbtm.add(i);break;case 4:this.csa.bottom.add(i);break;case 5:this.csa.top.add(i);break;case 6:this.csa.reverse.add(i);break;case 17:case 7:0===t.rY&&0===t.rZ||(i.dom.style.transform=e(t.rY,t.rZ),i.dom.style.webkitTransform=e(t.rY,t.rZ),i.dom.style.OTransform=e(t.rY,t.rZ),i.dom.style.MozTransform=e(t.rY,t.rZ),i.dom.style.MSTransform=e(t.rY,t.rZ))}i.y=i.y}else{var o=performance.now(),i=new CoreComment(this,t);switch(i.dom={style:{}},d(i),1==t.mode||6==t.mode?(i.rx=0,i.x=this.width,i.prev=o,i.speed=(this.width+i.width)/i.dur*1e3):4!=t.mode&&5!=t.mode||(i.removeTime=o+i.dur),i.mode){default:case 1:this.csa.scroll.add(i);break;case 4:this.csa.bottom.add(i),this.staticUpdate=!0;break;case 5:this.csa.top.add(i),this.staticUpdate=!0}}i.originalData=t,this.dispatchEvent("enterComment",i),this.runline.push(i)}},t.prototype.finish=function(t){this.dispatchEvent("exitComment",t);try{this.stage.removeChild(t.dom)}catch(t){}var e=this.runline.indexOf(t);switch(e>=0&&this.runline.splice(e,1),t.mode){default:case 1:this.csa.scroll.remove(t);break;case 2:this.csa.scrollbtm.remove(t);break;case 4:this.csa.bottom.remove(t),this.staticUpdate=!0;break;case 5:this.csa.top.remove(t),this.staticUpdate=!0;break;case 6:this.csa.reverse.remove(t);break;case 7:}t.textData&&(t.textData=null)},t.prototype.resumeComment=function(){Array.prototype.slice.call(this.stage.children).forEach(function(t){t.classList.contains("cmt")&&t.classList.contains("paused")&&(t.style.transitionDuration=t.finalDuration+"ms",t.style.transform=t.finalTransform,t.transitionStartTime=(new Date).getTime(),t.classList.remove("paused"))})},t.prototype.pauseComment=function(){Array.prototype.slice.call(this.stage.children).forEach(function(t){t.classList.contains("cmt")&&!t.classList.contains("paused")&&(t.finalTransform=t.style.transform,t.style.transform=window.getComputedStyle(t).getPropertyValue("transform"),t.finalDuration=parseFloat(t.style.transitionDuration)-(new Date).getTime()+t.transitionStartTime,t.style.transitionDuration="10ms",t.classList.add("paused"))})},t.prototype.addEventListener=function(t,e){"undefined"!=typeof this._listeners[t]?this._listeners[t].push(e):this._listeners[t]=[e]},t.prototype.dispatchEvent=function(t,e){if("undefined"!=typeof this._listeners[t])for(var i=0;i<this._listeners[t].length;i++)try{this._listeners[t][i](e)}catch(t){console.err(t.stack)}},t.prototype.onTimerEvent=function(t,e){for(var i=0;i<e.runline.length;i++){var o=e.runline[i];o.hold||o.time(t)}},t}(),ABP={version:"0.8.0",Strings:{statsPlayer:"播放器尺寸：",statsVideo:"视频分辨率：",statsBuffer:"可用缓冲：",statsBufferClip:"缓冲片段：",statsMozParse:"已解析帧：",statsMozDecode:"已解码帧：",statsMozPaint:"已绘制帧：",statsWebkitDecode:"已解码帧：",statsPresent:"已显示帧：",statsDrop:"已丢弃帧：",statsVideoCodec:"视频编码：",statsAudioCodec:"音频编码：",statsVideoBitrate:"视频码率：",statsAudioBitrate:"音频码率：",statsCurrentBitrate:"本段码率：",statsRealtimeBitrate:"实时码率：",overallBitrate:"总体码率：",statsDownloadSpeed:"下载速度：",sendSmall:"小字号",sendMid:"中字号",sendSize:"弹幕字号",sendMode:"弹幕模式",sendTop:"顶端渐隐",sendScroll:"滚动字幕",sendBottom:"底端渐隐",send:"发送",sendStyle:"弹幕样式",sendColor:"弹幕颜色",commentSpeed:"弹幕速度",commentScale:"弹幕比例",commentOpacity:"弹幕不透明度",commentBlock:"弹幕屏蔽列表",playSpeed:"播放速度",playSpeedReset:"还原正常速度",displayScaleD:"默认",displayScaleF:"全屏",shieldTypeText:"文字",shieldTypeUser:"用户",shieldTypeColor:"颜色",shieldTypeSetting:"设置",shieldAdd:"添加屏蔽……",shieldUseRegex:"启用正则",viewers:" 观众",comments:" 弹幕",commentTime:"时间",commentContent:"评论",commentDate:"发送日期",showStats:"显示统计信息",loadingMeta:"正在加载视频信息",switching:"正在切换",fetchURL:"正在获取视频地址",buffering:"正在缓冲",play:"播放",pause:"暂停",mute:"静音",unmute:"取消静音",fullScreen:"浏览器全屏",exitFullScreen:"退出全屏",webFull:"网页全屏",exitWebFull:"退出网页全屏",wideScreen:"宽屏模式",exitWideScreen:"退出宽屏",sendTooltip:"毁灭地喷射白光!da!",showComment:"显示弹幕",hideComment:"隐藏弹幕",loopOn:"洗脑循环 on",loopOff:"重新载入",usingCanvas:"正在使用Canvas",usingCSS:"正在使用CSS",useCSS:"使用CSS绘制弹幕",autoOpacityOn:"关闭自动不透明度",autoOpacityOff:"开启自动不透明度",copyComment:"复制弹幕",findComment:"定位弹幕",blockContent:"屏蔽内容“",blockUser:"屏蔽发送者",blockColor:"屏蔽颜色",blockColorWhite:"不能屏蔽白色",copyFail:"复制失败，浏览器不支持",blockUserEmpty:"没有屏蔽用户",blockColorEmpty:"没有屏蔽颜色"}};(function(){"use strict";if(ABP){var t=jQuery,e=window.setTimeout,i=window.clearTimeout,o="addEventListener",n="HTML5 Player ver.170525 based on ABPlayer-bilibili-ver",a=function(t){return document.getElementById(t)},s=function(t,e,i,o){var n=null;if("text"===t)return document.createTextNode(e);n=document.createElement(t);for(var a in e)if("style"!==a&&"className"!==a)n.setAttribute(a,e[a]);else if("className"===a)n.className=e[a];else for(var s in e.style)n.style[s]=e.style[s];if(i)for(var l=0;l<i.length;l++)null!=i[l]&&n.appendChild(i[l]);return o&&"function"==typeof o&&o(n),n},l=function(t,e){for(;t;t=t.parentNode)if(f(t.parentNode,e))return t};HTMLElement.prototype.tooltip=function(t){
this.tooltipData=t,this.dispatchEvent(new Event("updatetooltip"))},"undefined"==typeof HTMLElement.prototype.requestFullScreen&&(HTMLElement.prototype.requestFullScreen=function(){this.webkitRequestFullscreen?this.webkitRequestFullscreen():this.mozRequestFullScreen?this.mozRequestFullScreen():this.msRequestFullscreen&&this.msRequestFullscreen()}),"undefined"==typeof document.isFullScreen&&(document.isFullScreen=function(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenEnabled}),"undefined"==typeof document.exitFullscreen&&(document.exitFullscreen=function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():window.msExitFullscreen&&msExitFullscreen()});var r=function(t,e){e=e||2;for(var i=""+t;i.length<e;)i="0"+i;return i},c=function(t,e){for(var i="",o=1;o<=e-(t+"").length;o++)i+="0";return i+t},d=function(t,e){if(0==t)return lang.oneDay;var i,o,n,a,s,l,r=new Date(1e3*parseInt(t));return i=String(r.getFullYear()),o=String(r.getMonth()+1),1==o.length&&(o="0"+o),n=String(r.getDate()),1==n.length&&(n="0"+n),a=String(r.getHours()),1==a.length&&(a="0"+a),s=String(r.getMinutes()),1==s.length&&(s="0"+s),l=String(r.getSeconds()),1==l.length&&(l="0"+l),e?String(o+"-"+n+" "+a+":"+s):String(i+"-"+o+"-"+n+" "+a+":"+s+":"+l)},h=function(t){return isNaN(t)?"00:00":c(parseInt(t/60),2)+":"+c(parseInt(t%60),2)},u=function(t){for(var e=t.split(":"),i=0,o=0;o<e.length;o++){i*=60;var n=parseInt(e[o]);if(isNaN(n)||n<0)return!1;i+=n}return i},m=function(t,e,i){t&&(t[o]("mousemove",function(o){var n,r=a("ABP-Tooltip"),c=t.clientWidth,d=t.clientHeight,h=t.getBoundingClientRect(),u=l(t,"ABP-Unit").getBoundingClientRect(),m=h.top-u.top,p=e?o.clientX-u.left:h.left-u.left,f=p;null==r&&(r=s("div",{id:"ABP-Tooltip"},[s("text",t.tooltipData)]),r.by=t,l(t,"ABP-Unit").appendChild(r),r.style.top=m+d+2+"px",r.style.left=p+c/2-r.clientWidth/2+"px",f+=c/2-r.clientWidth/2),e&&(r.style.left=p-r.clientWidth/2+"px",f-=c/2),n=r.getBoundingClientRect(),n.left<u.left?r.style.left="0px":n.right>u.right&&(r.style.left=u.width-n.width+"px"),i=i||-6,i&&(r.style.top=m-r.clientHeight+2+i+"px")}),t[o]("mouseout",function(){var t=a("ABP-Tooltip");t&&t.parentNode&&t.parentNode.removeChild(t)}),t[o]("updatetooltip",function(e){var i=a("ABP-Tooltip");i&&i.by==e.target&&(i.innerHTML=t.tooltipData)}))},p=function(t,e){if(null!=t){var i=t.className.split(" ");""==i[0]&&(i=[]),i.indexOf(e)<0&&i.push(e),t.className=i.join(" ")}},f=function(t,e){if(null==t)return!1;var i=t.className.split(" ");return""==i[0]&&(i=[]),i.indexOf(e)>=0},v=function(t,e){if(null!=t){var i=t.className.split(" ");""==i[0]&&(i=[]),i.indexOf(e)>=0&&i.splice(i.indexOf(e),1),t.className=i.join(" ")}},g=function(t,e){var i={};for(var o in e)t&&"undefined"!=typeof t[o]?i[o]=t[o]:i[o]=e[o];return i};ABP.create=function(t,e){var i=t;if(e||(e={}),ABP.playerConfig=e.config?e.config:{},e=g(e,{replaceMode:!0,width:512,height:384,src:""}),"string"==typeof t&&(i=a(t)),f(i,"ABP-Unit"))l=i;else{var l=s("div",{className:"ABP-Unit",theme:"YouTube",style:{width:e.width.toString().indexOf("%")>=0?e.width:e.width+"px",height:e.height.toString().indexOf("%")>=0?e.height:e.height+"px"}});i.appendChild(l)}l.children.length>0&&e.replaceMode&&(l.innerHTML="");var r=[],c=[];if("string"==typeof e.src)e.src=s("video",{autobuffer:"true",dataSetup:"{}"},[s("source",{src:e.src})]),r.push(e.src);else if(e.src.hasOwnProperty("playlist"))for(var d=e.src,h=d.playlist,u=0;u<h.length;u++){if(h[u].hasOwnProperty("sources")){var m=[];for(var p in h[u].sources)m.push(s("source",{src:h[u][p],type:p}));r.push(s("video",{autobuffer:"true",dataSetup:"{}"},m))}else h[u].hasOwnProperty("video")&&r.push(h[u].video);c.push(h[u].comments)}else r.push(e.src);l.appendChild(s("div",{className:"ABP-Player"},[s("div",{className:"ABP-Video",tabindex:"10"},[s("div",{id:"info-box",style:{opacity:1}},[s("div",{className:"text-wrapper"},[s("div",{},[s("text",ABP.Strings.loadingMeta)])]),s("div",{id:"dots"})]),s("div",{className:"ABP-Container"}),r[0],s("div",{className:"Player-Stats"},[s("div",{id:"player-dimension"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsPlayer)]),s("span")]),s("div",{id:"video-dimension"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsVideo)]),s("span")]),s("div",{id:"buffer-health"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsBuffer)]),s("span",{className:"stats-column",id:"buffer-health-column"}),s("span")]),s("br",{className:"flvjs"}),s("div",{className:"flvjs"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsVideoCodec)]),s("span")]),s("div",{className:"flvjs"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsAudioCodec)]),s("span")]),s("div",{className:"flvjs"},[s("span",{className:"stats_name"},[s("text","fps：")]),s("span")]),s("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsVideoBitrate)]),s("span")]),s("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsAudioBitrate)]),s("span")]),s("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsRealtimeBitrate)]),s("span",{className:"stats-column",id:"realtime-bitrate-column",style:{verticalAlign:"top"}}),s("span")]),s("div",{className:"flvjs"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsDownloadSpeed)]),s("span",{className:"stats-column",id:"download-speed-column",style:{verticalAlign:"top"}}),s("span")]),s("br",{className:"hlsjs"}),s("div",{className:"hlsjs"},[s("span",{className:"stats_name"},[s("text","当前分片：")]),s("span",{style:{width:"180px",height:"5px",display:"inline-block",position:"relative",border:"solid #AAA 1px",borderRadius:"4px",verticalAlign:"middle",marginRight:"2px"}},[s("span",{id:"download-progress-hls",style:{position:"absolute",left:"2px",right:"2px",top:"1px",bottom:"1px",background:"#CCC",borderRadius:"3px",transition:"width .3s",width:0}})]),s("span")]),s("div",{className:"hlsjs"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsDownloadSpeed)]),s("span",{className:"stats-column",id:"download-speed-hls-column",style:{verticalAlign:"top"}}),s("span")]),s("br"),s("div",{style:{position:"relative"}},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsBufferClip)]),s("span",{id:"buffer-clips"},[s("span"),s("span",{},[s("div",{style:{width:"1px",height:"400%",top:"-150%",position:"absolute",background:"#FFF",left:0}})])]),s("pre",{style:{position:"absolute",margin:0,left:"250px",width:"90px",fontFamily:"inherit"}})]),s("div",{id:"canvas-fps"},[s("span",{className:"stats_name"},[s("text","Canvas fps：")]),s("span")]),s("div",{className:"gecko"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsMozParse)]),s("span",{id:"mozParsedFrames"})]),s("div",{className:"gecko"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsMozDecode)]),s("span",{id:"mozDecodedFrames"})]),s("div",{className:"gecko"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsMozPaint)]),s("span",{id:"mozPaintedFrames"})]),s("div",{className:"webkit"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsWebkitDecode)]),s("span",{id:"webkitDecodedFrameCount"})]),s("div",{className:"webkit"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsDrop)]),s("span",{id:"webkitDroppedFrameCount"})]),s("div",{className:"videoQuality"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsPresent)]),s("span",{id:"totalVideoFrames"})]),s("div",{className:"videoQuality"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsDrop)]),s("span",{id:"droppedVideoFrames"})]),s("br"),s("div",{style:{fontSize:"11px"}},[s("text",n)]),s("div",{style:{fontSize:"11px"}},[s("text","2017©esterTion")]),s("div",{id:"stats-close"},[s("text","×")])])]),s("div",{className:"ABP-FullScreenProgress"}),s("div",{className:"ABP-Bottom"},[s("div",{className:"ABP-Bottom-Extend"}),s("div",{className:"ABP-Bottom-Wrapper"},[s("div",{className:"ABP-Text"},[s("div",{className:"ABP-CommentStyle"},[s("div",{className:"button-group ABP-Comment-FontGroup"},[s("div",{className:"button ABP-Comment-Font icon-font-style"}),s("div",{className:"ABP-Comment-FontOption"},[s("p",{className:"style-title"},[s("text",ABP.Strings.sendSize)]),s("div",{className:"style-select",name:"commentFontSize"},[s("div",{className:"style-option",value:18},[s("text",ABP.Strings.sendSmall)]),s("div",{className:"style-option on",value:25},[s("text",ABP.Strings.sendMid)])]),s("p",{className:"style-title"},[s("text",ABP.Strings.sendMode)]),s("div",{className:"style-select",name:"commentMode"},[s("div",{className:"style-option",value:5},[s("text",ABP.Strings.sendTop)]),s("div",{className:"style-option on",value:1},[s("text",ABP.Strings.sendScroll)]),s("div",{className:"style-option",value:4},[s("text",ABP.Strings.sendBottom)])])])]),s("div",{className:"button-group ABP-Comment-ColorGroup"},[s("div",{className:"ABP-Comment-Color-Display"}),s("div",{className:"button ABP-Comment-Color icon-color-mode"}),s("div",{className:"ABP-Comment-ColorOption"},[s("div",{className:"ABP-Comment-ColorPicker"})])])]),s("form",{},[s("input",{className:"ABP-Comment-Input"})]),s("div",{className:"ABP-Comment-Send"},[s("text",ABP.Strings.send)])]),s("div",{className:"ABP-Control"},[s("div",{className:"button ABP-Play icon-play"}),s("div",{className:"progress-bar"},[s("div",{className:"bar"},[s("div",{className:"load"}),s("div",{className:"dark"})])]),s("div",{className:"time-label"},[s("text","00:00")]),s("div",{className:"button ABP-Volume icon-volume-high"}),s("div",{className:"volume-bar"},[s("div",{className:"bar"},[s("div",{className:"load"})])]),s("div",{className:"button-group ABP-CommentGroup"},[s("div",{className:"button ABP-CommentShow icon-comment on"}),s("div",{className:"ABP-CommentOption"},[s("p",{className:"label"},[s("text",ABP.Strings.useCSS),s("div",{className:"prop-checkbox"})]),s("p",{className:"label"},[s("text",ABP.Strings.commentSpeed)]),s("div",{className:"speed-bar"},[s("div",{className:"bar"},[s("div",{className:"load"})])]),s("p",{className:"label"},[s("text",ABP.Strings.commentScale)]),s("div",{className:"scale-bar"},[s("div",{className:"bar"},[s("div",{className:"load"})])]),s("p",{className:"label"},[s("text",ABP.Strings.commentOpacity)]),s("div",{className:"opacity-bar",style:{width:"calc(100% - 25px)"}},[s("div",{className:"bar"},[s("div",{className:"load"})])]),s("div",{className:"prop-checkbox",style:{top:"121px"}}),s("div",{className:"shield-enrty"},[s("text",ABP.Strings.commentBlock)])])]),s("div",{className:"button-group ABP-PlaySpeedGroup"},[s("div",{className:"button ABP-Loop icon-loop"})]),s("div",{className:"button ABP-WideScreen icon-tv"}),s("div",{className:"button-group ABP-FullScreenGroup"},[s("div",{className:"button ABP-FullScreen icon-screen-full"}),s("div",{className:"button ABP-Web-FullScreen icon-screen"})])])]),s("div",{className:"BiliPlus-Scale-Menu"},[s("div",{className:"Video-Defination"}),s("div",{className:"Video-Scale"},[s("div",{changeTo:"default",className:"on"},[s("text",ABP.Strings.displayScaleD)]),s("div",{changeTo:"16_9"},[s("text","16:9")]),s("div",{changeTo:"4_3"},[s("text","4:3")]),s("div",{changeTo:"full"},[s("text",ABP.Strings.displayScaleF)])])])])])),l.appendChild(s("div",{className:"shield hidden"},[s("div",{className:"shield_top"},[s("text",ABP.Strings.commentBlock),s("span",{className:"close"})]),s("div",{className:"shield_tabs"},[s("div",{className:"shield_tab on"},[s("div",{},[s("text",ABP.Strings.shieldTypeText)])]),s("div",{className:"shield_tab"},[s("div",{},[s("text",ABP.Strings.shieldTypeUser)])]),s("div",{className:"shield_tab"},[s("div",{},[s("text",ABP.Strings.shieldTypeColor)])]),s("div",{className:"shield_tab"},[s("div",{},[s("text",ABP.Strings.shieldTypeSetting)])])]),s("div",{className:"shield_tab_slash"}),s("div",{className:"shield_body"},[s("div",{className:"shield_body_wrapper"},[s("div",{className:"shield_tab_body"},[s("div",{id:"shield_text"}),s("div",{className:"shield_item"},[s("input",{className:"new",type:"text",placeholder:ABP.Strings.shieldAdd}),s("div",{className:"add"})])]),s("div",{className:"shield_tab_body"},[s("div",{id:"shield_user"})]),s("div",{className:"shield_tab_body"},[s("div",{id:"shield_color"})]),s("div",{className:"shield_tab_body"},[s("div",{className:"shield_toggle",id:"useReg"},[s("text",ABP.Strings.shieldUseRegex)])])])])])),l.appendChild(s("div",{className:"ABP-Comment-List"},[s("div",{className:"ABP-Comment-List-Count"},[s("div",{style:{position:"absolute",right:"200px"}},[s("span",{id:"viewer",style:{fontWeight:"bold"}},[s("text","--")]),s("text",ABP.Strings.viewers)]),s("div",{style:{position:"absolute",right:"20px"}},[s("span",{id:"danmaku",style:{fontWeight:"bold"}},[s("text","--")]),s("text",ABP.Strings.comments)])]),s("div",{className:"ABP-Comment-List-Title"},[s("div",{className:"cmt-time",item:"time"},[s("text",ABP.Strings.commentTime)]),s("div",{className:"cmt-content",item:"content"},[s("text",ABP.Strings.commentContent)]),s("div",{className:"cmt-date",item:"date"},[s("text",ABP.Strings.commentDate)])]),s("div",{className:"ABP-Comment-List-Container"},[s("ul",{className:"ABP-Comment-List-Container-Inner"})])])),l.appendChild(s("div",{className:"Context-Menu"},[s("div",{className:"Context-Menu-Background"}),s("div",{className:"Context-Menu-Body"},[s("div",{id:"Player-Stats-Toggle"},[s("text",ABP.Strings.showStats)]),s("div",{id:"Player-Speed-Control",className:"dm"},[s("div",{className:"content"},[s("text",ABP.Strings.playSpeed)]),s("div",{className:"dmMenu",style:{top:"-37px"}},[s("div",{"data-speed":.5},[s("text",.5)]),s("div",{"data-speed":1},[s("text",1)]),s("div",{"data-speed":1.25},[s("text",1.25)]),s("div",{"data-speed":1.5},[s("text",1.5)]),s("div",{"data-speed":2},[s("text",2)])])]),s("div",{className:"about"},[s("text",n)])])]));var v=ABP.bind(l);if(r.length>0){var y=r[0];v.gotoNext=function(){var t=r.indexOf(y)+1;if(t<r.length){y=r[t],y.style.display="";var e=v.video.parentNode;e.removeChild(v.video),e.appendChild(y),v.video.style.display="none",v.video=y,v.swapVideo(y),y[o]("ended",function(){v.gotoNext()})}},y[o]("ended",function(){v.gotoNext()})}return v};var y=function(){var t=3988292384,e=new Array(256),i=function(){var i,o,n;for(o=0;o<256;++o){for(i=o,n=0;n<8;++n)i=0!=(1&i)?t^i>>>1:i>>>1;e[o]=i}},o=function(t,i){for(var o,n=4294967295,a=t.length,s=0;s<a;++s)o=255&(n^t.charCodeAt(s)),n=n>>>8^e[o];return i?o:n},n=function(t){for(var i=0;i<256;i++)if(e[i]>>>24==t)return i;return-1},a="",s=function(t,i){var n=0,s="",l=o(t.toString(),!1);return n=255&l^i[2],n<=57&&n>=48?(s+=n-48,l=e[i[2]]^l>>>8,n=255&l^i[1],n<=57&&n>=48?(s+=n-48,l=e[i[1]]^l>>>8,n=255&l^i[0],n<=57&&n>=48?(s+=n-48,l=e[i[0]]^l>>>8,a=s,1):0):0):0};i();var l=new Array(4);return function(t){var i,r,c,d=4294967295^parseInt(t,16);for(r=1;r<1001;r++)if(d==o(r.toString(),!1))return r;for(r=3;r>=0;r--)l[3-r]=n(d>>>8*r),i=e[l[3-r]],d^=i>>>8*(3-r);for(r=0;r<1e5&&(c=o(r.toString(),!0),c!=l[3]||!s(r,l));r++);return 1e5==r?-1:r+""+a}},b=function(t){for(var e,i,o=0,n=t.currentTime;o<t.buffered.length;o++)if(n>=t.buffered.start(o)&&n<=t.buffered.end(o)){e=t.buffered.start(o),i=t.buffered.end(o);break}return o==t.buffered.length?{start:0,end:0,delta:0}:{start:e,end:i,delta:i-n}};window.crc_engine=new y,ABP.bind=function(n,a){var l={playerUnit:n,btnPlay:null,barTime:null,barFullScreenTime:null,barLoad:null,barTimeHitArea:null,barVolume:null,barVolumeHitArea:null,barOpacity:null,barOpacityHitArea:null,barScale:null,barScaleHitArea:null,barSpeed:null,barSpeedHitArea:null,btnFont:null,btnColor:null,btnSend:null,controlBar:null,timeLabel:null,timeJump:null,divComment:null,btnWide:null,btnFull:null,btnWebFull:null,btnDm:null,btnLoop:null,btnProp:null,btnAutoOpacity:null,videoDiv:null,btnVolume:null,video:null,txtText:null,commentColor:"ffffff",commentFontSize:25,commentMode:1,displayColor:null,cmManager:null,commentList:null,commentListContainer:null,lastSelectedComment:null,commentCoolDown:1e4,commentScale:ABP.playerConfig.scale?ABP.playerConfig.scale:1,commentSpeed:ABP.playerConfig.speed?ABP.playerConfig.speed:1,proportionalScale:ABP.playerConfig.prop,defaults:{w:0,h:0},state:g(a,{fullscreen:!1,commentVisible:!0,allowRescale:!1,autosize:!1,widescreen:!1}),createPopup:function(t,i){if(n.hasPopup===!0)return!1;var o=s("div",{className:"ABP-Popup"},[s("text",t)]);return o.remove=function(){o.isRemoved||(o.isRemoved=!0,n.removeChild(o),n.hasPopup=!1)},n.appendChild(o),n.hasPopup=!0,"number"==typeof i&&e(function(){o.remove()},i),o},removePopup:function(){for(var t=n.getElementsByClassName("ABP-Popup"),e=0;e<t.length;e++)null!=t[e].remove?t[e].remove():t[e].parentNode.removeChild(t[e]);n.hasPopup=!1},loadCommentList:function(t,e){e="asc"==e?-1:1;var i=Object.keys(l.commentList).sort(function(i,o){return l.commentList[i][t]<l.commentList[o][t]?e:l.commentList[i][t]>l.commentList[o][t]?-e:0});l.commentObjArray=[];for(w in i){var n=i[w],a=l.commentList[n];if(a&&a.time){var r=s("li",{}),c=s("span",{className:"cmt-time"},[s("text",h(a.time/1e3))]),u=s("span",{className:"cmt-content"},[s("text",a.content)]),p=s("span",{className:"cmt-date"},[s("text",d(a.date,!0))]);m(u,!1,36),m(p,!1,18),u.tooltip(a.content),p.tooltip(d(a.date)),r.appendChild(c),r.appendChild(u),r.appendChild(p),r.data=a,r.originalData=danmaku,8==a.mode?r.style.background="#ffe100":0!=a.pool&&(r.style.background="#20ff20"),r[o]("dblclick",function(t){l.video.currentTime=this.data.time/1e3,Ut(x.currentTime)}),l.commentObjArray.push(r)}}l.commentListContainer.style.height=24*l.commentObjArray.length+"px",l.renderCommentList(),l.playerUnit.querySelector(".ABP-Comment-List-Count span#danmaku").innerHTML=l.commentObjArray.length},renderCommentList:function(){var t=l.commentListContainer.parentElement.scrollTop,e=parseInt(t/24);l.commentListContainer.innerHTML="";for(var i=e;i<=e+40&&"undefined"!=typeof l.commentObjArray[i];i++){if(i==e&&i>0){var n=l.commentObjArray[i].cloneNode(!0),a=n.getElementsByClassName("cmt-content")[0],s=n.getElementsByClassName("cmt-date")[0];n[o]("dblclick",function(t){l.video.currentTime=l.commentObjArray[i].data.time/1e3,Ut(x.currentTime)}),m(a,!1,36),m(s,!1,18),a.tooltip(l.commentObjArray[i].data.content),s.tooltip(d(l.commentObjArray[i].data.date)),n.style.paddingTop=24*e+"px"}else var n=l.commentObjArray[i];l.commentObjArray[i].data.originalData.isBlocked?l.commentObjArray[i].childNodes[0].className="cmt-time blocked":l.commentObjArray[i].childNodes[0].className="cmt-time",l.commentListContainer.appendChild(n)}l.commentListContainer.parentElement.scrollTop=t},commentCallback:function(t){t.result?(l.commentList[t.id]=l.commentList[t.tmp_id],delete l.commentList[t.tmp_id]):(delete l.commentList[t.tmp_id],l.createPopup(t.error,5e3))},swapVideo:null},c=function(t,e){var i=localStorage.html5Settings||"{}";i=JSON.parse(i),i[t]=e,localStorage.html5Settings=JSON.stringify(i)};if(c.scale=function(t){c("scale",l.commentScale)},c.opacity=function(t){c("opacity",l.cmManager.options.global.opacity)},c.speed=function(t){c("speed",l.commentSpeed)},c.commentVisible=function(t){c("commentVisible",l.cmManager.display)},c.useCSS=function(t){c("useCSS",l.cmManager.options.global.useCSS)},c.autoOpacity=function(t){c("autoOpacity",l.cmManager.options.global.autoOpacity)},l.swapVideo=function(t){var i=function(){if(!qt){Ut(t.currentTime);try{l.barLoad.style.width="100%"}catch(t){return}}};t[o]("timeupdate",i),t[o]("ended",function(){l.btnPlay.className="button ABP-Play icon-play",l.barTime.style.width="0%",l.barFullScreenTime.style.width="0%"}),t[o]("progress",i),t.isBound=!0;var a=0,s=!1;if(l.cmManager){l.cmManager[o]("load",function(){l.commentList={};for(w in l.cmManager.timeline){var t=l.cmManager.timeline[w];8!=t.mode||s||(s=!0,e(function(){var t=new CCLScripting("/js/CommentCoreLibraryScripting.min.js");l.cmManager.scripting=t.getSandbox(l.divComment,l.video)},0)),t.dbid&&t.stime&&(l.commentList[t.dbid]={date:t.date,time:t.stime,mode:t.mode,user:t.hash,pool:t.pool,content:t.text||t.code,originalData:t})}l.loadCommentList("date","asc"),l.commentListContainer.parentElement[o]("scroll",l.renderCommentList)}),l.cmManager.setBounds=function(){n.offsetHeight<=300||n.offsetWidth<=700?p(n,"ABP-Mini"):v(n,"ABP-Mini");var t=l.videoDiv.offsetWidth,e=l.videoDiv.offsetHeight;l.proportionalScale?e/493*l.commentScale:l.commentScale;this.width=t,this.height=e,this.options.global.scale=this.width/680/l.commentSpeed,this.dispatchEvent("resize");for(var i in this.csa)this.csa[i].setBounds(this.width,this.height);this.stage.style.width=this.width+"px",this.stage.style.height=this.height+"px",this.stage.style.perspective=this.width*Math.tan(40*Math.PI/180)/2+"px",this.stage.style.webkitPerspective=this.width*Math.tan(40*Math.PI/180)/2+"px",n.querySelector(".BiliPlus-Scale-Menu .Video-Scale div.on").click(),this.canvasResize()},l.cmManager.setBounds(),l.cmManager.clear();var r=0,c=!1,d=!1,h=function(){d=!1,t.removeEventListener("canplay",h),t.paused&&l.btnPlay.click()},u=function(){var e=t.readyState,i=document.getElementById("info-box");if(!t.ended)switch(e){case 1:isMobile()&&t.paused&&l.createPopup("请点击播放器开始播放",3e3);case 2:0==i.style.opacity&&(i.style.opacity=1),dots.running||dots.runTimer();try{var o=b(t);i.childNodes[0].childNodes[0].innerHTML=ABP.Strings.buffering+" "+Math.floor(100*o.delta)/100+"s"}catch(t){i.childNodes[0].childNodes[0].innerHTML=ABP.Strings.buffering}break;case 3:case 4:1==i.style.opacity&&(i.style.opacity=0,dots.stopTimer())}};t[o]("autoplay",function(){t[o]("canplay",h)}),t[o]("loop",function(){c=t.loop}),t[o]("canplay",h),t[o]("canplay",u),t[o]("waiting",u),t[o]("progress",u),t[o]("progress",function(){a==t.currentTime&&m&&(new Date).getTime()-r>=100?t.hasStalled=!0:a!=t.currentTime&&(a=t.currentTime),r=(new Date).getTime()}),window&&window[o]("resize",function(){l.cmManager.setBounds()}),t[o]("timeupdate",function(){l.cmManager.display!==!1&&(t.hasStalled&&(t.hasStalled=!1),l.cmManager.time(Math.floor(1e3*t.currentTime)))}),t[o]("ratechange",function(){1!=this.playbackRate&&(l.createPopup("检测到播放速度改变，10秒后恢复",3e3),e(function(){t.playbackRate=1,l.createPopup("播放速度已恢复",1e3)},1e4))});var m=!1;t[o]("pause",function(){m=!1}),t[o]("waiting",function(){m=!1}),t[o]("playing",function(){m=!0})}},null!==n&&null!==n.getElementsByClassName){l.defaults.w=n.offsetWidth,l.defaults.h=n.offsetHeight;var y=n.getElementsByClassName("ABP-Video");if(!(y.length<=0)){var x=null;l.videoDiv=y[0];for(var w in y[0].children)if(null!=y[0].children[w].tagName&&"VIDEO"===y[0].children[w].tagName.toUpperCase()){x=y[0].children[w];break}var S=y[0].getElementsByClassName("ABP-Container");if(S.length>0&&(l.divComment=S[0]),null!==x){l.video=x,l.video.seek=function(t){this.currentTime=parseFloat(t)/1e3};var C=n.getElementsByClassName("ABP-Play");if(!(C.length<=0)){l.btnPlay=C[0],l.btnPlay.tooltip(ABP.Strings.play),m(l.btnPlay);var k=n.getElementsByClassName("progress-bar");if(!(k.length<=0)){var _=k[0].getElementsByClassName("bar");l.barTimeHitArea=_[0],l.barLoad=_[0].getElementsByClassName("load")[0],l.barTime=_[0].getElementsByClassName("dark")[0];var P=n.getElementsByClassName("ABP-FullScreenProgress");if(!(P.length<=0)){l.barFullScreenTime=P[0];var A=n.getElementsByClassName("time-label");if(!(A.length<=0)){l.timeLabel=A[0];var B=n.getElementsByClassName("ABP-Volume");if(!(B.length<=0)){l.btnVolume=B[0],l.btnVolume.tooltip(ABP.Strings.mute),m(l.btnVolume);var N=n.getElementsByClassName("volume-bar");if(!(N.length<=0)){var M=N[0].getElementsByClassName("bar");l.barVolumeHitArea=M[0],l.barVolume=M[0].getElementsByClassName("load")[0];var T=n.getElementsByClassName("opacity-bar");if(!(T.length<=0)){var T=T[0].getElementsByClassName("bar");l.barOpacityHitArea=T[0],l.barOpacity=T[0].getElementsByClassName("load")[0];var F=n.getElementsByClassName("scale-bar");if(!(F.length<=0)){var F=F[0].getElementsByClassName("bar");l.barScaleHitArea=F[0],l.barScale=F[0].getElementsByClassName("load")[0];var L=n.getElementsByClassName("speed-bar");if(!(L.length<=0)){var L=L[0].getElementsByClassName("bar");l.barSpeedHitArea=L[0],l.barSpeed=L[0].getElementsByClassName("load")[0];var E=n.getElementsByClassName("prop-checkbox");if(!(E.length<=0)){l.btnAutoOpacity=E[1],l.btnAutoOpacity.tooltip(ABP.Strings.autoOpacityOn),m(l.btnAutoOpacity),l.btnProp=E[0],l.btnProp.tooltip(ABP.Strings.usingCanvas),m(l.btnProp);var O=n.getElementsByClassName("ABP-FullScreen");if(!(O.length<=0)){l.btnFull=O[0],l.btnFull.tooltip(ABP.Strings.fullScreen),m(l.btnFull);var H=n.getElementsByClassName("ABP-Web-FullScreen");if(!(H.length<=0)){l.btnWebFull=H[0],l.btnWebFull.tooltip(ABP.Strings.webFull),m(l.btnWebFull);var D=n.getElementsByClassName("ABP-WideScreen");if(!(D.length<=0)){l.btnWide=D[0],l.btnWide.tooltip(ABP.Strings.wideScreen),m(l.btnWide);var I=n.getElementsByClassName("ABP-Comment-Font");if(!(I.length<=0)){l.btnFont=I[0],l.btnFont.tooltip(ABP.Strings.sendStyle),m(l.btnFont);var R=n.getElementsByClassName("ABP-Comment-Color");if(!(R.length<=0)){l.btnColor=R[0],l.btnColor.tooltip(ABP.Strings.sendColor),m(l.btnColor);var W=n.getElementsByClassName("ABP-Comment-Color-Display");if(!(W.length<=0)){l.displayColor=W[0];var V=n.getElementsByClassName("ABP-Comment-Input");if(!(V.length<=0)){l.txtText=V[0];var z=n.getElementsByClassName("ABP-Comment-List-Container-Inner");if(!(z.length<=0)){l.commentListContainer=z[0];var j=n.getElementsByClassName("ABP-Comment-Send");if(!(j.length<=0)){l.btnSend=j[0],l.btnSend.tooltip(ABP.Strings.sendTooltip),m(l.btnSend);var q=n.getElementsByClassName("ABP-Control");q.length>0&&(l.controlBar=q[0]);var U=n.getElementsByClassName("ABP-CommentShow");if(!(U.length<=0)){l.btnDm=U[0],l.btnDm.tooltip(ABP.Strings.hideComment),m(l.btnDm);var X=n.getElementsByClassName("ABP-Loop");if(!(X.length<=0)){l.btnLoop=X[0],l.btnLoop.tooltip(ABP.Strings.loopOff),m(l.btnLoop);var Y={videoDimension:!0,gecko:!0,webkit:!0,videoQuality:!0,flvjs:!0},J=function(t){return document.querySelector(t)},Q=function(t){return(1*t).toFixed(2)},G=">:last-child",Z=J("#player-dimension"+G),K=J("#video-dimension"+G),$=J("#canvas-fps"+G),tt=J("#buffer-health-column"),et=J("#realtime-bitrate-column"),it=J("#download-speed-column"),ot=J("#download-speed-hls-column"),nt=[],at=[],st=[],lt=[],rt=J("#buffer-health"+G),ct='<svg style="width:180px;height:21px"><polyline style="fill:transparent;stroke:#ccc"></polyline><polyline points="1,21 180,21 180,1" style="fill:transparent;stroke:#fff"></polyline></svg>',dt="",ht=document.createElement("style"),ut=document.createElement("style"),mt=document.createElement("style"),pt=document.querySelectorAll(".flvjs>:last-child"),ft=document.querySelectorAll(".hlsjs>:last-child"),w=0,vt=function(t,e){var i,o=0,n=[];e.forEach(function(t){o=t>o?t:o}),0==o&&(o=1);for(i in e)n.push(3*i+","+(20*(1-e[i]/o)+1)+" "+(3*i+3)+","+(20*(1-e[i]/o)+1));t.setAttribute("points",n.join(" "))},gt=!1,yt=J("#Player-Stats-Toggle"),bt=function(t){"stats-close"==t.target.id&&t.stopPropagation(),J(".Player-Stats").style.display=gt?"":"block",gt=!gt},xt=-1,wt=!1;for(yt[o]("click",bt),J("#stats-close")[o]("click",bt);w<60;w++)nt.push(0),at.push(0),st.push(0),lt.push(0);if(tt.innerHTML=ct,tt=tt.querySelector("polyline"),et.innerHTML=ct,et=et.querySelector("polyline"),it.innerHTML=ct,it=it.querySelector("polyline"),ot.innerHTML=ct,ot=ot.querySelector("polyline"),void 0==x.videoWidth&&(Y.videoDimension=!1,dt+="#video-dimension{display:none}"),void 0==x.mozDecodedFrames&&(Y.gecko=!1,dt+=".gecko{display:none}"),void 0==x.webkitDecodedFrameCount&&(Y.webkit=!1,dt+=".webkit{display:none}"),void 0==x.getVideoPlaybackQuality&&(Y.videoQuality=!1,dt+=".videoQuality{display:none}"),ht.innerHTML=dt,document.head.appendChild(ht),ut.innerHTML=".flvjs{display:none}",document.head.appendChild(ut),mt.innerHTML=".hlsjs{display:none}",document.head.appendChild(mt),setInterval(function(){wt=!wt,Z.innerHTML=x.offsetWidth+"x"+x.offsetHeight+" *"+devicePixelRatio,Y.videoDimension&&(K.innerHTML=x.videoWidth+"x"+x.videoHeight);var t={};try{t=b(x)}catch(t){}if(t=t.delta||0,nt.push(t),nt.shift(),rt.innerHTML=Q(t)+"s",vt(tt,nt),gt){for(var e,i,o=x.buffered,n=J("#buffer-clips>span"),a=x.duration==1/0?o.end(o.length-1):x.duration,r=[],c=0;c<o.length;c++)c>=n.childNodes.length&&n.appendChild(s("span",{className:"buffer-clip"})),e=o.start(c),i=o.end(c)-e,n.childNodes[c].style.left=Q(e/a*100)+"%",n.childNodes[c].style.width=Q(i/a*100)+"%",r.push(h(0|e)+" - "+h(e+i|0));for(;c<n.childNodes.length;)n.childNodes[c].remove();n.parentNode.parentNode.childNodes[2].innerHTML=r.join("\n"),J("#buffer-clips>span>div").style.left=Q(x.currentTime/a*100)+"%"}if(null!=player.flv){ut.textContent="";var d,u,c=0,m=player.flv._mediaInfo,p=player.flv.statisticsInfo,f=x.currentTime,v=player.flv._mediaDataSource.segments,g=0,y=0;for(u=0;u<v.length;u++){if(f<=(g+v[u].duration)/1e3){g=f-g/1e3|0;break}g+=v[u].duration,y++}if(pt[c++].textContent=m.videoCodec||"",pt[c++].textContent=m.audioCodec||"",pt[c++].textContent=Q(m.fps),pt[c++].textContent=Q(m.videoDataRate)+" kbps",pt[c++].textContent=Q(m.audioDataRate)+" kbps",m.bitrateMap){var d,f=x.currentTime,g=0|f,y=0;m.bitrateMap[y]&&(d=m.bitrateMap[y][g]),void 0!=d?wt&&xt!=(0|x.currentTime)?(xt=0|x.currentTime,pt[c++].textContent=Q(d)+" kbps",at.push(d),at.shift(),gt&&vt(et,at)):c++:pt[c++].textContent="N/A"}else pt[c++].textContent="N/A";wt?("number"==typeof p.speed&&(st.push(p.speed),st.shift()),gt&&vt(it,st),pt[c++].textContent=Q(p.speed)+" KB/s",player.flv._statisticsInfo.speed=0):c++}else{ut.textContent=".flvjs{display:none}";for(var w=J("#buffer-clips>span:nth-of-type(2)").children;w.length>1;)w[1].remove()}if(null!=player.hls){mt.innerHTML="";var S,C=0,c=0;if(void 0!=player.hls.fragmentLoader.loaders.main&&(S=player.hls.fragmentLoader.loaders.main,S.stats.total&&(C=S.stats.loaded/S.stats.total*100)),J("#download-progress-hls").style.width=C+"%",ft[c++].innerHTML=Q(C)+"%",wt){var k=player.hls.speed||0;lt.push(k),lt.shift(),gt&&vt(ot,lt),ft[c++].innerHTML=Q(k)+" KB/s"}}else mt.innerHTML=".hlsjs{display:none}";if(wt&&($.innerHTML=l.cmManager.canvasFPS),Y.gecko&&["mozParsedFrames","mozDecodedFrames","mozPaintedFrames"].find(function(t){J("#"+t).innerHTML=x[t]}),Y.webkit&&["webkitDecodedFrameCount","webkitDroppedFrameCount"].find(function(t){J("#"+t).innerHTML=x[t]}),Y.videoQuality){var _=x.getVideoPlaybackQuality();J("#totalVideoFrames").innerHTML=_.totalVideoFrames,J("#droppedVideoFrames").innerHTML=_.droppedVideoFrames}},500),"undefined"!=typeof CommentManager&&(l.cmManager=new CommentManager(l.divComment),l.cmManager.display=!0,l.cmManager.init(),l.cmManager.clear(),l.cmManager.filter.addModifier(shield.filter),l.cmManager.startTimer(),window&&window[o]("resize",function(){l.cmManager.setBounds()})),"object"==typeof ABP.playerConfig&&(ABP.playerConfig.volume&&(l.video.volume=ABP.playerConfig.volume),ABP.playerConfig.opacity&&(l.cmManager.options.global.opacity=ABP.playerConfig.opacity)),t(".ABP-Comment-List-Title *").click(function(){var e=t(this).attr("item"),i=t(this).hasClass("asc")?"desc":"asc";t(".ABP-Comment-List-Title *").removeClass("asc").removeClass("desc"),t(this).addClass(i),l.loadCommentList(e,i)}),t(".ABP-Unit .ABP-CommentStyle .ABP-Comment-FontOption .style-option").click(function(){t(this).closest(".style-select").find(".style-option").removeClass("on"),t(this).addClass("on"),l[t(this).closest(".style-select").attr("name")]=parseInt(t(this).attr("value"))}),t(n).find(".ABP-Comment-ColorPicker").colpick({flat:!0,submit:0,color:"ffffff",onChange:function(t,e){l.commentColor=e,l.displayColor.style.backgroundColor="#"+e}}),x.isBound!==!0){l.swapVideo(x),l.playerUnit.querySelector(".BiliPlus-Scale-Menu .Video-Defination")[o]("click",function(t){if(!t.target.hasAttribute("changeto"))return!1;var e=JSON.parse(t.target.getAttribute("changeto"));
changeSrc({target:{value:e[1]}},e[0]),v(t.target.parentNode.querySelector(".on"),"on"),p(t.target,"on")}),l.playerUnit.querySelector(".BiliPlus-Scale-Menu .Video-Scale")[o]("click",function(t){if(!t.target.hasAttribute("changeto"))return!1;switch(t.target.getAttribute("changeto")){case"default":f(l.video,"scale")&&v(l.video,"scale"),l.video.style.width="",l.video.style.height="",l.video.style.paddingTop="",l.video.style.paddingLeft="";break;case"16_9":p(l.video,"scale");var e=l.videoDiv.offsetWidth,i=l.videoDiv.offsetHeight,o="",n="";e<i/9*16?(o=(i-e/16*9)/2+"px",i=e/16*9/i*100+"%",e="100%"):(n=(e-i/9*16)/2+"px",e=i/9*16/e*100+"%",i="100%"),l.video.style.width=e,l.video.style.height=i,l.video.style.paddingTop=o,l.video.style.paddingLeft=n;break;case"4_3":p(l.video,"scale");var e=l.videoDiv.offsetWidth,i=l.videoDiv.offsetHeight,o="",n="";e<i/3*4?(o=(i-e/4*3)/2+"px",i=e/4*3/i*100+"%",e="100%"):(n=(e-i/3*4)/2+"px",e=i/3*4/e*100+"%",i="100%"),l.video.style.width=e,l.video.style.height=i,l.video.style.paddingTop=o,l.video.style.paddingLeft=n;break;case"full":p(l.video,"scale"),l.video.style.width="",l.video.style.height="",l.video.style.paddingTop="",l.video.style.paddingLeft=""}v(t.target.parentNode.querySelector(".on"),"on"),p(t.target,"on")});var St=0,Ct=function(t){var e=Date.now();e-St<=500?l.btnFull.click():x.paused&&l.btnPlay.click(),St=e,t.preventDefault()};l.videoDiv[o]("click",Ct),l.playerUnit.querySelector(".ABP-Bottom-Extend")[o]("click",function(t){t.preventDefault(),t.stopPropagation(),Ct(t)});var kt=null;l.videoDiv[o]("mousemove",function(){kt&&window.clearTimeout(kt),f(l.videoDiv,"ABP-HideCursor")&&v(l.videoDiv,"ABP-HideCursor"),kt=window.setTimeout(function(){p(l.videoDiv,"ABP-HideCursor")},3e3)}),l.btnVolume[o]("click",function(){0==l.video.muted?(l.video.muted=!0,this.className="button ABP-Volume icon-volume-mute2",this.tooltip(ABP.Strings.unmute),l.barVolume.style.width="0%"):(l.video.muted=!1,this.className="button ABP-Volume icon-volume-",l.video.volume<.1?this.className+="mute":l.video.volume<.33?this.className+="low":l.video.volume<.67?this.className+="medium":this.className+="high",this.tooltip(ABP.Strings.mute),l.barVolume.style.width=100*l.video.volume+"%")}),l.btnWebFull[o]("click",function(){l.state.fullscreen=f(n,"ABP-FullScreen"),p(n,"ABP-FullScreen"),unsafeWindow&&unsafeWindow.player_fullwin&&unsafeWindow.player_fullwin(!0),l.btnFull.className="button ABP-FullScreen icon-screen-normal",l.btnFull.tooltip(ABP.Strings.exitWebFull),l.state.fullscreen=!0,l.cmManager&&l.cmManager.setBounds(),l.state.allowRescale&&(l.state.fullscreen?l.defaults.w>0&&(l.cmManager.options.scrollScale=n.offsetWidth/l.defaults.w):l.cmManager.options.scrollScale=1)});var _t=!1,Pt=!1;l.btnFont[o]("click",function(t){Pt&&l.btnColor.click(),this.parentNode.classList.toggle("on"),_t=!_t}),l.btnColor[o]("click",function(t){_t&&l.btnFont.click(),this.parentNode.classList.toggle("on"),Pt=!Pt}),l.btnAutoOpacity[o]("click",function(t){this.classList.toggle("on");var e=this.classList.contains("on");l.cmManager.autoOpacity(e),this.tooltip(e?ABP.Strings.autoOpacityOn:ABP.Strings.autoOpacityOff),c.autoOpacity()}),ABP.playerConfig.autoOpacity&&l.btnAutoOpacity.click(),l.btnProp[o]("click",function(t){this.classList.toggle("on");var e=this.classList.contains("on");l.cmManager.useCSS(e),this.tooltip(e?ABP.Strings.usingCSS:ABP.Strings.usingCanvas),c.useCSS()}),ABP.playerConfig.useCSS&&l.btnProp.click();var At=function(){!document.isFullScreen()&&f(n,"ABP-FullScreen")&&(v(n,"ABP-FullScreen"),l.btnFull.className="button ABP-FullScreen icon-screen-full",l.btnFull.tooltip(ABP.Strings.fullScreen),l.state.fullscreen=!!document.isFullScreen())};document[o]("fullscreenchange",At,!1),document[o]("webkitfullscreenchange",At,!1),document[o]("mozfullscreenchange",At,!1),document[o]("MSFullscreenChange",At,!1),l.btnFull[o]("click",function(){l.state.fullscreen=f(n,"ABP-FullScreen"),l.state.fullscreen?(v(n,"ABP-FullScreen"),unsafeWindow&&unsafeWindow.player_fullwin&&unsafeWindow.player_fullwin(!1),this.className="button ABP-FullScreen icon-screen-full",this.tooltip(ABP.Strings.fullScreen),document.exitFullscreen()):(p(n,"ABP-FullScreen"),this.className="button ABP-FullScreen icon-screen-normal",this.tooltip(ABP.Strings.exitFullScreen),n.requestFullScreen()),l.state.fullscreen=!l.state.fullscreen,l.cmManager&&l.cmManager.setBounds(),l.state.allowRescale&&(l.state.fullscreen?l.defaults.w>0&&(l.cmManager.options.scrollScale=n.offsetWidth/l.defaults.w):l.cmManager.options.scrollScale=1)}),l.btnWide[o]("click",function(){l.state.widescreen=f(n,"ABP-WideScreen"),l.state.widescreen?(v(n,"ABP-WideScreen"),this.className="button ABP-WideScreen icon-tv",n.dispatchEvent(new Event("normal")),this.tooltip(ABP.Strings.wideScreen)):(p(n,"ABP-WideScreen"),this.className="button ABP-WideScreen icon-tv on",n.dispatchEvent(new Event("wide")),this.tooltip(ABP.Strings.exitWideScreen)),l.state.widescreen=!l.state.widescreen,l.cmManager&&l.cmManager.setBounds(),l.state.allowRescale&&(l.state.fullscreen?l.defaults.w>0&&(l.cmManager.options.scrollScale=n.offsetWidth/l.defaults.w):l.cmManager.options.scrollScale=1)}),l.btnDm[o]("click",function(){0==l.cmManager.display?(l.cmManager.display=!0,l.cmManager.startTimer(),this.className="button ABP-CommentShow icon-comment on",this.tooltip(ABP.Strings.hideComment)):(l.cmManager.display=!1,l.cmManager.clear(),l.cmManager.stopTimer(),this.className="button ABP-CommentShow icon-comment",this.tooltip(ABP.Strings.showComment)),c.commentVisible()}),l.btnLoop[o]("click",function(){null!=player.flv&&(player.flv.unload(),player.flv.load(),l.video.currentTime=0,l.video.play())});var Bt=l.playerUnit.querySelector(".Context-Menu"),Nt=Bt.querySelector(".Context-Menu-Background"),Mt=Bt.querySelector(".Context-Menu-Body"),Tt=function(t){return Vt?(t.preventDefault(),t.stopPropagation(),Vt=!1,!1):(Bt.style.display="none",void t.preventDefault())},Ft=function(t){for(var e=0,i=-1,e=0,o=l.commentObjArray.length;e<o;e++)if(l.commentObjArray[e].data.originalData.dbid==t){i=e;break}i!=-1&&(l.state.fullscreen&&l.btnFull.click(),l.state.widescreen&&l.btnWide.click(),l.commentListContainer.parentNode.scrollTop=24*i)},Lt=null,Et=null,Ot=0,Ht=null,Dt={},It=function(){if(0!=Ot){if(void 0!=Dt[Ot])return void Mt.dispatchEvent(new CustomEvent("senderInfoFetched",{detail:Dt[Ot]}));var t=s("script",{className:"info_jsonp",src:"//account.bilibili.com/api/member/getCardByMid?type=jsonp&callback=getSenderInfo&mid="+Ot});document.body.appendChild(t)}},Rt=function(t,n,a){Bt.style.display="block";var r,c,d,h,u,m=Mt.querySelectorAll(".dm"),p=l.playerUnit.getBoundingClientRect();for(w=m.length-2;w>=0;w--)m[w].remove();for(r=Mt.firstChild,w=0;w<a.length;w++){if(c=a[w].originalData,d=c.color.toString(16).padStart(6,"0"),h=16777215==c.color,u=s("div",{className:"dm"},[s("div",{className:"content"},[s("text",c.text)]),s("div",{className:"dmMenu"},[s("div",{"data-content":c.text},[s("text",ABP.Strings.copyComment)]),s("div",{"data-dmid":c.dbid},[s("text",ABP.Strings.findComment)]),s("div",{onclick:'shield.addText("'+c.text+'")'},[s("text",ABP.Strings.blockContent+"“"+c.text+"”")]),s("div",{"data-mid":crc_engine(c.hash),onclick:'shield.addUser("'+c.hash+'")'},[s("text",ABP.Strings.blockUser+""+c.hash+"(mid:"+crc_engine(c.hash)+")")]),s("div",h?{}:{onclick:'shield.addColor("'+d+'")'},[s("text",h?ABP.Strings.blockColorWhite:ABP.Strings.blockColor+""),s("div",{className:"color",style:{background:"#"+d}})])])]),c.mode>6){u.childNodes[0].innerHTML="特殊弹幕";var f=u.childNodes[1];f.childNodes[0].style.display="none",f.childNodes[2].style.display="none",f.childNodes[4].style.display="none"}Mt.insertBefore(u,r)}var v=Mt.querySelectorAll(".dmMenu");for(w=0;w<v.length-1;w++)v[w].childNodes[0][o]("click",function(){try{var t=document.createElement("input");t.style.width=0,t.style.height=0,document.body.appendChild(t),t.value=this.getAttribute("data-content"),t.select();var e=document.execCommand("copy");if(document.body.removeChild(t),!e)throw""}catch(t){l.createPopup(ABP.Strings.copyFail,3e3)}}),v[w].childNodes[1][o]("click",function(){Ft(this.getAttribute("data-dmid"))}),v[w].childNodes[3][o]("mouseenter",function(){Ot=this.getAttribute("data-mid"),Ht=this,Lt=e(It,500)}),v[w].childNodes[3][o]("mouseleave",function(){i(Lt),Ot=0,Ht=null,null!=document.getElementById("Sender-Info")&&(i(Et),Et=e(function(){document.body.removeChild(document.getElementById("Sender-Info"))},500))});t-=p.left,n-=p.top,p.width-t<300&&(t=p.width-300),p.height-Mt.offsetHeight-n<0&&(n=p.height-Mt.offsetHeight);var g=Mt.querySelector(".dm:nth-last-of-type(2)>.dmMenu");if(null!=g){g.style.display="block";var y=g.getBoundingClientRect();g.style.display="",p.top+p.height-y.height-n<0&&(n=p.height-y.height)}Mt.style.left=t+"px",Mt.style.top=n+"px"},Wt=null,Vt=!1;Mt.querySelector("#Player-Speed-Control .dmMenu")[o]("click",function(t){var e=t.target.getAttribute("data-speed");void 0!=e&&(l.video.playbackRate=e)}),Mt[o]("senderInfoFetched",function(t){var n=t.detail;if(n.mid==Ot&&null!=Ht){var a=Ht.parentNode.getBoundingClientRect(),l=a.left-150,r=innerHeight-a.bottom,c=s("div",{className:"Context-Menu-Body",id:"Sender-Info",style:{left:l+"px",bottom:r+"px",position:"fixed",fontFamily:"-apple-system,Arial,'PingFang SC','STHeiti Light','Hiragino Kaku Gothic ProN','Microsoft YaHei'",textAlign:"center"}},[s("div",{},[s("img",{style:{height:"130px",width:"130px"},src:n.face.replace(/http\:/,"")})]),s("div",{},[s("text",n.name)]),s("div",{},[s("text",n.mid)]),s("div",{},[s("text","LV"+n.level_info.current_level)])]);document.body.appendChild(c),r+c.offsetHeight>innerHeight&&(c.style.bottom="",c.style.top=a.top+"px"),c[o]("click",function(){window.open("/space/"+n.mid+"/"),document.body.removeChild(c)}),c[o]("mouseenter",function(){i(Et)}),c[o]("mouseleave",function(){i(Et),Et=e(function(){document.body.removeChild(document.getElementById("Sender-Info"))},500)})}}),window.getSenderInfo=function(t){0==t.code&&(Dt[Ot]=t.card,Mt.dispatchEvent(new CustomEvent("senderInfoFetched",{detail:t.card})))},Bt[o]("click",Tt),Nt[o]("contextmenu",Tt),l.videoDiv.parentNode[o]("contextmenu",function(t){t.preventDefault(),t.stopPropagation();var e=l.divComment.getBoundingClientRect(),i=t.clientX,o=t.clientY;Rt(i,o,l.cmManager.getCommentFromPoint(i-e.left,o-e.top))}),l.commentListContainer[o]("contextmenu",function(t){var e=t.target.parentNode.data;return void 0!=e&&(t.preventDefault(),t.stopPropagation(),void Rt(t.clientX,t.clientY,[e]))}),l.videoDiv.parentNode[o]("touchstart",function(t){if(Vt=!1,t.touches.length>1&&null!=Wt)return i(Wt),void(Wt=null);for(var o,n,a,s=[],r=0,c=l.divComment.childNodes.length;r<c;r++)o=l.divComment.childNodes[r].getBoundingClientRect(),n=t.touches[0].clientX-o.left,a=t.touches[0].clientY-o.top,n>=0&&n<=o.width&&a>=0&&a<=o.height&&s.push(l.divComment.childNodes[r]);n=t.touches[0].clientX,a=t.touches[0].clientY,Wt=e(function(){Wt=null,Vt=!0,Rt(n,a,s)},300)}),l.videoDiv.parentNode[o]("touchmove",function(){null!=Wt&&(i(Wt),Wt=null)}),l.videoDiv.parentNode[o]("touchend",function(){null!=Wt&&(i(Wt),Wt=null)}),Mt[o]("touchstart",function(t){var e=Mt.getBoundingClientRect();t.touches[0].clientX-e.left<=e.width&&t.touches[0].clientY-e.top<=e.height&&(Vt=!0)});var zt=function(){l.playerUnit.dispatchEvent(new CustomEvent("saveconfig",{detail:{volume:l.video.volume,opacity:l.cmManager.options.global.opacity,scale:l.commentScale,prop:l.proportionalScale}}))},jt=function(){var t=new Date,i=""+t.getTime()+Math.random();return""!=l.txtText.value&&!l.txtText.disabled&&(l.playerUnit.dispatchEvent(new CustomEvent("sendcomment",{detail:{id:i,message:l.txtText.value,fontsize:l.commentFontSize,color:parseInt("0x"+l.commentColor),date:t.getFullYear()+"-"+r(t.getMonth())+"-"+r(t.getDay())+" "+r(t.getHours())+":"+r(t.getMinutes())+":"+r(t.getSeconds()),playTime:l.video.currentTime,mode:l.commentMode,pool:0}})),l.cmManager.send({text:l.txtText.value,mode:l.commentMode,stime:l.video.currentTime,size:l.commentFontSize,color:parseInt("0x"+l.commentColor),border:!0}),l.commentList[i]={date:parseInt(t.getTime()/1e3),time:1e3*l.video.currentTime,mode:l.commentMode,user:"-",pool:0,content:l.txtText.value},l.txtText.value="",l.txtText.disabled=!0,void e(function(){l.txtText.disabled=!1},l.commentCoolDown))};l.txtText.parentNode[o]("submit",function(t){return t.preventDefault(),jt(),!1}),l.btnSend[o]("click",jt),l.timeLabel[o]("click",function(){l.timeJump=s("input",{className:"time-jump"}),l.timeJump.value=h(l.video.currentTime),l.controlBar.appendChild(l.timeJump),l.timeJump[o]("blur",function(){l.timeJump&&l.timeJump.parentNode.removeChild(l.timeJump),l.timeJump=null}),l.timeJump[o]("keydown",function(t){if(13==t.keyCode){var e=u(l.timeJump.value);e&&e<=l.video.duration&&(l.video.currentTime=e,l.video.paused&&l.btnPlay.click()),l.timeJump.parentNode.removeChild(l.timeJump)}else(t.keyCode<48||t.keyCode>59)&&(t.keyCode<96||t.keyCode>105)&&8!=t.keyCode&&16!=t.keyCode&&37!=t.keyCode&&39!=t.keyCode&&46!=t.keyCode&&t.preventDefault()}),l.timeJump.focus(),l.timeJump.select()}),l.barTime.style.width="0%",l.barFullScreenTime.style.width="0%";var qt=!1;l.barTimeHitArea[o]("mousedown",function(t){qt=!0}),document[o]("mouseup",function(t){if(qt){var e=b(l.video),i=e.end-e.start,o=(t.clientX-l.barTimeHitArea.getBoundingClientRect().left)/l.barTimeHitArea.offsetWidth*i;o+=e.start,o<0&&(o=0),Math.abs(o-l.video.currentTime)>4&&l.cmManager&&l.cmManager.clear(),l.video.currentTime=o}qt=!1});var Ut=function(t){var e=b(l.video),i=e.end-e.start,t=t-e.start;l.barTime.style.width=t/i*100+"%",l.barFullScreenTime.style.width=t/i*100+"%",l.timeLabel.innerHTML=h(t)+"/"+h(i)};document[o]("mousemove",function(t){var e=b(l.video),i=e.end,o=(t.clientX-l.barTimeHitArea.getBoundingClientRect().left)/l.barTimeHitArea.offsetWidth*i;o<0&&(o=0),o>i&&(o=i),l.barTimeHitArea.tooltip(h(o)),qt&&Ut(o)}),m(l.barTimeHitArea,!0,-12);var Xt=!1;l.barVolumeHitArea[o]("mousedown",function(t){Xt=!0});var Yt=null,Jt=function(){Yt&&i(Yt),p(n,"volume-show")},Qt=function(){Yt=e(function(){v(n,"volume-show")},2e3)};l.barVolumeHitArea[o]("mouseenter",Jt),l.btnVolume[o]("mouseenter",Jt),l.barVolumeHitArea[o]("mouseleave",Qt),l.btnVolume[o]("mouseleave",Qt),l.barVolume.style.width=100*l.video.volume+"%";var Gt=function(t){l.barVolume.style.width=100*t+"%",l.video.muted=!1,l.btnVolume.className="button ABP-Volume icon-volume-",t<.1?l.btnVolume.className+="mute":t<.33?l.btnVolume.className+="low":t<.67?l.btnVolume.className+="medium":l.btnVolume.className+="high",l.btnVolume.tooltip(ABP.Strings.mute),l.barVolumeHitArea.tooltip(parseInt(100*t)+"%"),zt()};document[o]("mouseup",function(t){if(Xt){var e=(t.clientX-l.barVolumeHitArea.getBoundingClientRect().left)/l.barVolumeHitArea.offsetWidth;e<0&&(e=0),e>1&&(e=1),l.video.volume=e,Gt(l.video.volume)}Xt=!1}),document[o]("mousemove",function(t){var e=(t.clientX-l.barVolumeHitArea.getBoundingClientRect().left)/l.barVolumeHitArea.offsetWidth;e<0&&(e=0),e>1&&(e=1),Xt?(l.video.volume=e,Gt(l.video.volume)):l.barVolumeHitArea.tooltip(parseInt(100*e)+"%")}),m(l.barVolumeHitArea,!0,-12);var Zt=!1;l.barOpacityHitArea[o]("mousedown",function(t){Zt=!0}),l.barOpacity.style.width=100*l.cmManager.options.global.opacity+"%";var Kt=function(t){l.barOpacity.style.width=100*t+"%",l.barOpacityHitArea.tooltip(parseInt(100*t)+"%"),zt()};document[o]("mouseup",function(t){if(Zt){var e=(t.clientX-l.barOpacityHitArea.getBoundingClientRect().left)/l.barOpacityHitArea.offsetWidth;e<0&&(e=0),e>1&&(e=1),l.cmManager.options.global.opacity=e,Kt(l.cmManager.options.global.opacity),c.opacity()}Zt=!1}),document[o]("mousemove",function(t){var e=(t.clientX-l.barOpacityHitArea.getBoundingClientRect().left)/l.barOpacityHitArea.offsetWidth;e<0&&(e=0),e>1&&(e=1),Zt?(l.cmManager.options.global.opacity=e,Kt(l.cmManager.options.global.opacity)):l.barOpacityHitArea.tooltip(parseInt(100*e)+"%")}),m(l.barOpacityHitArea,!0,-6);var $t=!1;l.barScaleHitArea[o]("mousedown",function(t){$t=!0}),l.barScale.style.width=(l.commentScale-.2)/1.8*100+"%";var te=function(t){l.barScale.style.width=(t-.2)/1.8*100+"%",l.barScaleHitArea.tooltip(parseInt(100*t)+"%"),l.cmManager.setBounds(),zt()};document[o]("mouseup",function(t){if($t){var e=.2+1.8*(t.clientX-l.barScaleHitArea.getBoundingClientRect().left)/l.barScaleHitArea.offsetWidth;e<.2&&(e=.2),e>2&&(e=2),l.commentScale=e,te(l.commentScale),c.scale()}$t=!1}),document[o]("mousemove",function(t){var e=.2+1.8*(t.clientX-l.barScaleHitArea.getBoundingClientRect().left)/l.barScaleHitArea.offsetWidth;e<.2&&(e=.2),e>2&&(e=2),$t?(l.commentScale=e,te(l.commentScale)):l.barScaleHitArea.tooltip(parseInt(100*e)+"%")}),m(l.barScaleHitArea,!0,-6);var ee=!1;l.barSpeedHitArea[o]("mousedown",function(t){ee=!0}),l.barSpeed.style.width=(l.commentSpeed-.5)/1.5*100+"%";var ie=function(t){l.barSpeed.style.width=(t-.5)/1.5*100+"%",l.barSpeedHitArea.tooltip(parseInt(100*t)+"%"),l.cmManager.setBounds(),zt()};document[o]("mouseup",function(t){if(ee){var e=.5+1.5*(t.clientX-l.barSpeedHitArea.getBoundingClientRect().left)/l.barSpeedHitArea.offsetWidth;e<.5&&(e=.5),e>2&&(e=2),l.commentSpeed=e,ie(l.commentSpeed),c.speed()}ee=!1}),document[o]("mousemove",function(t){var e=.5+1.5*(t.clientX-l.barSpeedHitArea.getBoundingClientRect().left)/l.barSpeedHitArea.offsetWidth;e<.5&&(e=.5),e>2&&(e=2),ee?(l.commentSpeed=e,ie(l.commentSpeed)):l.barSpeedHitArea.tooltip(parseInt(100*e)+"%")}),m(l.barSpeedHitArea,!0,-6),l.btnPlay[o]("click",function(){l.video.paused?(l.video.play(),this.className="button ABP-Play ABP-Pause icon-pause",this.tooltip(ABP.Strings.pause)):(l.video.pause(),this.className="button ABP-Play icon-play",this.tooltip(ABP.Strings.play))}),n[o]("keydown",function(t){if(t&&"INPUT"!=document.activeElement.tagName)switch([27,32,37,38,39,40].indexOf(t.keyCode)!=-1&&t.preventDefault(),t.keyCode){case 27:abpinst.state.fullscreen&&abpinst.btnFull.click();break;case 32:l.btnPlay.click();break;case 37:var e=l.video.currentTime-=5*l.video.playbackRate;l.cmManager.clear(),e<b(l.video).start&&(e=b(l.video).start),l.video.currentTime=e.toFixed(3),l.video.paused&&l.btnPlay.click(),Ut(x.currentTime),l.barTimeHitArea.tooltip(h(x.currentTime));break;case 39:var e=l.video.currentTime+=5*l.video.playbackRate;l.cmManager.clear(),e>b(l.video).end&&(e=b(l.video).end-1),l.video.currentTime=e.toFixed(3),l.video.paused&&l.btnPlay.click(),Ut(x.currentTime),l.barTimeHitArea.tooltip(h(x.currentTime));break;case 38:var i=l.video.volume+.1;i>1&&(i=1),l.video.volume=i.toFixed(3),Gt(l.video.volume);break;case 40:var i=l.video.volume-.1;i<0&&(i=0),l.video.volume=i.toFixed(3),Gt(l.video.volume)}}),n[o]("touchmove",function(t){event.preventDefault()});var oe=null;n[o]("touchstart",function(t){f(l.videoDiv,"ABP-HideCursor")&&v(l.videoDiv,"ABP-HideCursor"),t.targetTouches.length>0&&(oe=t.targetTouches[0])}),n[o]("touchend",function(t){if(p(l.videoDiv,"ABP-HideCursor"),t.changedTouches.length>0&&null!=oe){var e=t.changedTouches[0].pageX-oe.pageX,i=t.changedTouches[0].pageY-oe.pageY;if(Math.abs(e)<20&&Math.abs(i)<20)return void(oe=null);Math.abs(e)>3*Math.abs(i)?e>0?l.video.paused&&l.btnPlay.click():l.video.paused||l.btnPlay.click():Math.abs(i)>3*Math.abs(e)&&(i<0?l.video.volume=Math.min(1,l.video.volume+.1):l.video.volume=Math.max(0,l.video.volume-.1)),oe=null}}),n[o]("mouseup",function(){if("INPUT"!=document.activeElement.tagName){var t=window.scrollY;l.videoDiv.focus(),window.scrollTo(window.scrollX,t)}})}if("undefined"!=typeof CommentManager&&l.state.autosize){var ne=function(){if(0!==x.videoHeight&&0!==x.videoWidth){var t=x.videoHeight/x.videoWidth,e=n.offsetWidth,i=n.offsetHeight,o=i/e;o<t?(n.style.width=i/t+"px",n.style.height=i+"px"):(n.style.width=e+"px",n.style.height=e*t+"px"),l.cmManager.setBounds()}};x[o]("loadedmetadata",ne),ne()}return shield.init(l),shield.shield(),dots.init({id:"dots",width:"100%",height:"100%",r:16,thick:4}),l}}}}}}}}}}}}}}}}}}}}}}}}}}})(),function(t){var e=function(){var e='<div class="colpick"><div class="colpick_color"><div class="colpick_color_overlay1"><div class="colpick_color_overlay2"><div class="colpick_selector_outer"><div class="colpick_selector_inner"></div></div></div></div></div><div class="colpick_hue"><div class="colpick_hue_arrs"><div class="colpick_hue_larr"></div><div class="colpick_hue_rarr"></div></div></div><div class="colpick_new_color"></div><div class="colpick_current_color"></div><div class="colpick_hex_field"><div class="colpick_field_letter">#</div><input type="text" maxlength="6" size="6" /></div><div class="colpick_rgb_r colpick_field"><div class="colpick_field_letter">R</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_g colpick_field"><div class="colpick_field_letter">G</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_h colpick_field"><div class="colpick_field_letter">H</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_s colpick_field"><div class="colpick_field_letter">S</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_submit"></div></div>',i={showEvent:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},colorScheme:"light",color:"3289c7",livePreview:!0,flat:!1,layout:"full",submit:1,submitText:"OK",height:156},s=function(e,i){var o=a(e);t(i).data("colpick").fields.eq(1).val(o.r).end().eq(2).val(o.g).end().eq(3).val(o.b).end()},r=function(e,i){t(i).data("colpick").fields.eq(4).val(Math.round(e.h)).end().eq(5).val(Math.round(e.s)).end().eq(6).val(Math.round(e.b)).end()},c=function(e,i){t(i).data("colpick").fields.eq(0).val(l(e))},d=function(e,i){t(i).data("colpick").selector.css("backgroundColor","#"+l({h:e.h,s:100,b:100})),t(i).data("colpick").selectorIndic.css({left:parseInt(t(i).data("colpick").height*e.s/100,10),top:parseInt(t(i).data("colpick").height*(100-e.b)/100,10)})},h=function(e,i){t(i).data("colpick").hue.css("top",parseInt(t(i).data("colpick").height-t(i).data("colpick").height*e.h/360,10))},u=function(e,i){t(i).data("colpick").currentColor.css("backgroundColor","#"+l(e))},m=function(e,i){t(i).data("colpick").newColor.css("backgroundColor","#"+l(e))},p=function(e){var i,u=t(this).parent().parent();this.parentNode.className.indexOf("_hex")>0?(u.data("colpick").color=i=o(F(this.value)),s(i,u.get(0)),r(i,u.get(0))):this.parentNode.className.indexOf("_hsb")>0?(u.data("colpick").color=i=M({h:parseInt(u.data("colpick").fields.eq(4).val(),10),s:parseInt(u.data("colpick").fields.eq(5).val(),10),b:parseInt(u.data("colpick").fields.eq(6).val(),10)}),s(i,u.get(0)),c(i,u.get(0))):(u.data("colpick").color=i=n(T({r:parseInt(u.data("colpick").fields.eq(1).val(),10),g:parseInt(u.data("colpick").fields.eq(2).val(),10),b:parseInt(u.data("colpick").fields.eq(3).val(),10)})),c(i,u.get(0)),r(i,u.get(0))),d(i,u.get(0)),h(i,u.get(0)),m(i,u.get(0)),u.data("colpick").onChange.apply(u.parent(),[i,l(i),a(i),u.data("colpick").el,0])},f=function(e){t(this).parent().removeClass("colpick_focus")},v=function(){t(this).parent().parent().data("colpick").fields.parent().removeClass("colpick_focus"),t(this).parent().addClass("colpick_focus")},g=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var i=t(this).parent().find("input").focus(),o={el:t(this).parent().addClass("colpick_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:e.pageY,field:i,val:parseInt(i.val(),10),preview:t(this).parent().parent().data("colpick").livePreview};t(document).mouseup(o,b),t(document).mousemove(o,y)},y=function(t){return t.data.field.val(Math.max(0,Math.min(t.data.max,parseInt(t.data.val-t.pageY+t.data.y,10)))),t.data.preview&&p.apply(t.data.field.get(0),[!0]),!1},b=function(e){return p.apply(e.data.field.get(0),[!0]),e.data.el.removeClass("colpick_slider").find("input").focus(),t(document).off("mouseup",b),t(document).off("mousemove",y),!1},x=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var i={cal:t(this).parent(),y:t(this).offset().top};t(document).on("mouseup touchend",i,S),t(document).on("mousemove touchmove",i,w);var o="touchstart"==e.type?e.originalEvent.changedTouches[0].pageY:e.pageY;return p.apply(i.cal.data("colpick").fields.eq(4).val(parseInt(360*(i.cal.data("colpick").height-(o-i.y))/i.cal.data("colpick").height,10)).get(0),[i.cal.data("colpick").livePreview]),!1},w=function(t){var e="touchmove"==t.type?t.originalEvent.changedTouches[0].pageY:t.pageY;return p.apply(t.data.cal.data("colpick").fields.eq(4).val(parseInt(360*(t.data.cal.data("colpick").height-Math.max(0,Math.min(t.data.cal.data("colpick").height,e-t.data.y)))/t.data.cal.data("colpick").height,10)).get(0),[t.data.preview]),!1},S=function(e){return s(e.data.cal.data("colpick").color,e.data.cal.get(0)),c(e.data.cal.data("colpick").color,e.data.cal.get(0)),t(document).off("mouseup touchend",S),t(document).off("mousemove touchmove",w),!1},C=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var i={cal:t(this).parent(),pos:t(this).offset()};i.preview=i.cal.data("colpick").livePreview,t(document).on("mouseup touchend",i,_),t(document).on("mousemove touchmove",i,k);var o;return"touchstart"==e.type?(pageX=e.originalEvent.changedTouches[0].pageX,o=e.originalEvent.changedTouches[0].pageY):(pageX=e.pageX,o=e.pageY),p.apply(i.cal.data("colpick").fields.eq(6).val(parseInt(100*(i.cal.data("colpick").height-(o-i.pos.top))/i.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*(pageX-i.pos.left)/i.cal.data("colpick").height,10)).get(0),[i.preview]),!1},k=function(t){var e;return"touchmove"==t.type?(pageX=t.originalEvent.changedTouches[0].pageX,e=t.originalEvent.changedTouches[0].pageY):(pageX=t.pageX,e=t.pageY),p.apply(t.data.cal.data("colpick").fields.eq(6).val(parseInt(100*(t.data.cal.data("colpick").height-Math.max(0,Math.min(t.data.cal.data("colpick").height,e-t.data.pos.top)))/t.data.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(t.data.cal.data("colpick").height,pageX-t.data.pos.left))/t.data.cal.data("colpick").height,10)).get(0),[t.data.preview]),!1},_=function(e){return s(e.data.cal.data("colpick").color,e.data.cal.get(0)),c(e.data.cal.data("colpick").color,e.data.cal.get(0)),t(document).off("mouseup touchend",_),t(document).off("mousemove touchmove",k),!1},P=function(e){var i=t(this).parent(),o=i.data("colpick").color;i.data("colpick").origColor=o,u(o,i.get(0)),i.data("colpick").onSubmit(o,l(o),a(o),i.data("colpick").el)},A=function(e){e.stopPropagation();var i=t("#"+t(this).data("colpickId"));i.data("colpick").onBeforeShow.apply(this,[i.get(0)]);var o=t(this).offset(),n=o.top+this.offsetHeight,a=o.left,s=N(),l=i.width();a+l>s.l+s.w&&(a-=l),i.css({left:a+"px",top:n+"px"}),0!=i.data("colpick").onShow.apply(this,[i.get(0)])&&i.show(),t("html").mousedown({cal:i},B),i.mousedown(function(t){t.stopPropagation()})},B=function(e){0!=e.data.cal.data("colpick").onHide.apply(this,[e.data.cal.get(0)])&&e.data.cal.hide(),t("html").off("mousedown",B)},N=function(){var t="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(t?document.documentElement.scrollLeft:document.body.scrollLeft),w:window.innerWidth||(t?document.documentElement.clientWidth:document.body.clientWidth)}},M=function(t){return{h:Math.min(360,Math.max(0,t.h)),s:Math.min(100,Math.max(0,t.s)),b:Math.min(100,Math.max(0,t.b))}},T=function(t){return{r:Math.min(255,Math.max(0,t.r)),g:Math.min(255,Math.max(0,t.g)),b:Math.min(255,Math.max(0,t.b))}},F=function(t){var e=6-t.length;if(e>0){for(var i=[],o=0;o<e;o++)i.push("0");i.push(t),t=i.join("")}return t},L=function(){var e=t(this).parent(),i=e.data("colpick").origColor;e.data("colpick").color=i,s(i,e.get(0)),c(i,e.get(0)),r(i,e.get(0)),d(i,e.get(0)),h(i,e.get(0)),m(i,e.get(0))};return{init:function(a){if(a=t.extend({},i,a||{}),"string"==typeof a.color)a.color=o(a.color);else if(void 0!=a.color.r&&void 0!=a.color.g&&void 0!=a.color.b)a.color=n(a.color);else{if(void 0==a.color.h||void 0==a.color.s||void 0==a.color.b)return this;a.color=M(a.color)}return this.each(function(){if(!t(this).data("colpickId")){var i=t.extend({},a);i.origColor=a.color;var o="collorpicker_"+parseInt(1e3*Math.random());t(this).data("colpickId",o);var n=t(e).attr("id",o);n.addClass("colpick_"+i.layout+(i.submit?"":" colpick_"+i.layout+"_ns")),"light"!=i.colorScheme&&n.addClass("colpick_"+i.colorScheme),n.find("div.colpick_submit").html(i.submitText).click(P),i.fields=n.find("input").change(p).blur(f).focus(v),n.find("div.colpick_field_arrs").mousedown(g).end().find("div.colpick_current_color").click(L),i.selector=n.find("div.colpick_color").on("mousedown touchstart",C),i.selectorIndic=i.selector.find("div.colpick_selector_outer"),i.el=this,i.hue=n.find("div.colpick_hue_arrs"),huebar=i.hue.parent();var l=navigator.userAgent.toLowerCase(),y="Microsoft Internet Explorer"===navigator.appName,b=y?parseFloat(l.match(/msie ([0-9]{1,}[\.0-9]{0,})/)[1]):0,w=y&&b<10,S=["#ff0000","#ff0080","#ff00ff","#8000ff","#0000ff","#0080ff","#00ffff","#00ff80","#00ff00","#80ff00","#ffff00","#ff8000","#ff0000"];if(w){var k,_;for(k=0;k<=11;k++)_=t("<div></div>").attr("style","height:8.333333%; filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr="+S[k]+", endColorstr="+S[k+1]+'); -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+S[k]+", endColorstr="+S[k+1]+')";'),huebar.append(_)}else stopList=S.join(","),huebar.attr("style","background:-webkit-linear-gradient(top,"+stopList+"); background: -o-linear-gradient(top,"+stopList+"); background: -ms-linear-gradient(top,"+stopList+"); background:-moz-linear-gradient(top,"+stopList+"); -webkit-linear-gradient(top,"+stopList+"); background:linear-gradient(to bottom,"+stopList+"); ");n.find("div.colpick_hue").on("mousedown touchstart",x),i.newColor=n.find("div.colpick_new_color"),i.currentColor=n.find("div.colpick_current_color"),n.data("colpick",i),s(i.color,n.get(0)),r(i.color,n.get(0)),c(i.color,n.get(0)),h(i.color,n.get(0)),d(i.color,n.get(0)),u(i.color,n.get(0)),m(i.color,n.get(0)),i.flat?(n.appendTo(this).show(),n.css({position:"relative",display:"block"})):(n.appendTo(document.body),t(this).on(i.showEvent,A),n.css({position:"absolute"}))}})},showPicker:function(){return this.each(function(){t(this).data("colpickId")&&A.apply(this)})},hidePicker:function(){return this.each(function(){t(this).data("colpickId")&&t("#"+t(this).data("colpickId")).hide()})},setColor:function(e,i){if(i="undefined"==typeof i?1:i,"string"==typeof e)e=o(e);else if(void 0!=e.r&&void 0!=e.g&&void 0!=e.b)e=n(e);else{if(void 0==e.h||void 0==e.s||void 0==e.b)return this;e=M(e)}return this.each(function(){if(t(this).data("colpickId")){var o=t("#"+t(this).data("colpickId"));o.data("colpick").color=e,o.data("colpick").origColor=e,s(e,o.get(0)),r(e,o.get(0)),c(e,o.get(0)),h(e,o.get(0)),d(e,o.get(0)),m(e,o.get(0)),o.data("colpick").onChange.apply(o.parent(),[e,l(e),a(e),o.data("colpick").el,1]),i&&u(e,o.get(0))}})}}}(),i=function(t){
var t=parseInt(t.indexOf("#")>-1?t.substring(1):t,16);return{r:t>>16,g:(65280&t)>>8,b:255&t}},o=function(t){return n(i(t))},n=function(t){var e={h:0,s:0,b:0},i=Math.min(t.r,t.g,t.b),o=Math.max(t.r,t.g,t.b),n=o-i;return e.b=o,e.s=0!=o?255*n/o:0,0!=e.s?t.r==o?e.h=(t.g-t.b)/n:t.g==o?e.h=2+(t.b-t.r)/n:e.h=4+(t.r-t.g)/n:e.h=-1,e.h*=60,e.h<0&&(e.h+=360),e.s*=100/255,e.b*=100/255,e},a=function(t){var e={},i=t.h,o=255*t.s/100,n=255*t.b/100;if(0==o)e.r=e.g=e.b=n;else{var a=n,s=(255-o)*n/255,l=(a-s)*(i%60)/60;360==i&&(i=0),i<60?(e.r=a,e.b=s,e.g=s+l):i<120?(e.g=a,e.b=s,e.r=a-l):i<180?(e.g=a,e.r=s,e.b=s+l):i<240?(e.b=a,e.r=s,e.g=a-l):i<300?(e.b=a,e.g=s,e.r=s+l):i<360?(e.r=a,e.g=s,e.b=a-l):(e.r=0,e.g=0,e.b=0)}return{r:Math.round(e.r),g:Math.round(e.g),b:Math.round(e.b)}},s=function(e){var i=[e.r.toString(16),e.g.toString(16),e.b.toString(16)];return t.each(i,function(t,e){1==e.length&&(i[t]="0"+e)}),i.join("")},l=function(t){return s(a(t))};t.fn.extend({colpick:e.init,colpickHide:e.hidePicker,colpickShow:e.showPicker,colpickSetColor:e.setColor}),t.extend({colpick:{rgbToHex:s,rgbToHsb:n,hsbToHex:l,hsbToRgb:a,hexToHsb:o,hexToRgb:i}})}(jQuery);