/** 
 * Comment Filters Module Simplified (only supports modifiers & types)
 * @license MIT
 * @author Jim Chen
 */
function CommentFilter(){this.modifiers=[],this.runtime=null,this.allowTypes={1:!0,4:!0,5:!0,6:!0,7:!0,8:!0,17:!0},this.doModify=function(e){for(var t=0;t<this.modifiers.length;t++)e=this.modifiers[t](e);return e},this.beforeSend=function(e){return e},this.doValidate=function(e){return this.allowTypes[e.mode]?!0:!1},this.addRule=function(){},this.addModifier=function(e){this.modifiers.push(e)},this.runtimeFilter=function(e){return null==this.runtime?e:this.runtime(e)},this.setRuntimeFilter=function(e){this.runtime=e}}function isMobile(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}var shield=function(){var e,t=!0,i=1,o=null,n=0,a=!1,s=[],l=function(e){return document.querySelectorAll(e)},r=function(e){return document.querySelector(e)},c=null,d={init:function(i){if(t){void 0!=i&&(c=i),t=!1,shield.tab(0),void 0==localStorage.shieldList&&(localStorage.shieldList='{"text":[],"user":[],"color":[],"useReg":false}'),o=JSON.parse(localStorage.shieldList),void 0==o.color&&(o.color=[]),void 0==o.useReg&&(o.useReg=!1),a=o.useReg,e=o.limit,d.render();var s,m,u;for(u=l(".shield_tab"),s=0,m=u.length;m>s;s++)u[s].tabNum=s,u[s].addEventListener("mouseenter",function(){d.tab(this.tabNum)}),u[s].addEventListener("mouseleave",function(e){var t=this.getBoundingClientRect(),i=e.clientX,o=e.clientY;(i-t.left<0||i-t.left>t.width||o-t.top<0||o-t.top>t.height)&&d.tab(n)}),u[s].addEventListener("click",function(){d.switchTab(this.tabNum)});r(".shield-enrty").addEventListener("click",shield.show),r(".shield .close").addEventListener("click",shield.show),r(".shield .add").addEventListener("click",shield.add),r("#useReg").addEventListener("click",function(){a=!a,d.save(),d.render(3)})}},switchTab:function(e){n=e,r(".shield_body_wrapper").style.transform="translateX("+-278*e+"px)",r(".shield_body_wrapper").style.webkitTransform="translateX("+-278*e+"px)"},tab:function(e){var t=r(".shield"),i=t.getBoundingClientRect(),o=r(".shield .shield_tab:nth-of-type("+(e+1)+")>div").getBoundingClientRect(),n=o.left-i.left,a=o.width,s=r(".shield .shield_tab_slash");s.style.left=n+"px",s.style.width=a+"px"},render:function(e){var t=!0,i=0;for(void 0!=e&&(t=!1,i=e);;){switch(i){case 0:var n,s,c,m="";for(n=0,s=o.text.length;s>n;n++)m+='<div class="shield_item"><div class="text">'+o.text[n]+'</div><div class="delete"></div></div>';for(r("#shield_text").innerHTML=m,c=l("#shield_text .shield_item .delete"),n=0,s=c.length;s>n;n++)c[n].onclick=d.del;break;case 1:for(var c,m="",n=0;n<o.user.length;n++)m+='<div class="shield_item"><div class="text">'+o.user[n]+" mid "+crc_engine(o.user[n])+'</div><div class="delete"></div></div>';for(0==n&&(m='<div class="shield_item">'+ABP.Strings.blockUserEmpty+"</div>"),r("#shield_user").innerHTML=m,c=l("#shield_user .shield_item .delete"),n=0,s=c.length;s>n;n++)c[n].onclick=d.delUser;break;case 2:for(var u,c,m="",n=0;n<o.color.length;n++){for(u=o.color[n].toString(16);u.length<6;)u="0"+u;m+='<div class="shield_color"><div class="color" style="background:#'+u+'">'+o.color[n]+'</div><div class="delete"></div></div>'}for(0==n&&(m='<div class="shield_color">'+ABP.Strings.blockColorEmpty+"</div>"),r("#shield_color").innerHTML=m,c=l("#shield_color .shield_color .delete"),n=0,s=c.length;s>n;n++)c[n].onclick=d.delColor;break;case 3:r("#useReg").className="shield_toggle"+(a?" on":"");break;default:return}i++}},save:function(){o.useReg=a,o.limit=e,localStorage.shieldList=JSON.stringify(o),d.shield()},show:function(){i?l(".shield")[0].setAttribute("class","shield"):l(".shield")[0].setAttribute("class","shield hidden"),i^=1},add:function(){d.addText(r(".shield_item .new").value),r(".shield_item .new").value=""},addText:function(e){return""==e||-1!=o.text.indexOf(e)?!1:(o.text.push(e),d.save(),void d.render(0))},addUser:function(e){return-1!=o.user.indexOf(e)?!1:(o.user.push(e),d.save(),void d.render(1))},addColor:function(e){return e=parseInt(e,16),isNaN(e)||-1!=o.color.indexOf(e)?!1:(o.color.push(e),d.save(),void d.render(2))},del:function(e){var t,i=e.target.parentNode.childNodes[0].innerHTML,n=o.text.indexOf(i);return-1==n?!1:(t=o.text.splice(0,n),o.text=t.concat(o.text.splice(1)),d.save(),void d.render(0))},delUser:function(e){var t,i=e.target.parentNode.childNodes[0].innerHTML.split(" ")[0],n=o.user.indexOf(i);return-1==n?!1:(t=o.user.splice(0,n),o.user=t.concat(o.user.splice(1)),d.save(),void d.render(1))},delColor:function(e){var t,i=e.target.parentNode.childNodes[0].innerHTML,n=o.color.indexOf(1*i);return-1==n?!1:(t=o.color.splice(0,n),o.color=t.concat(o.color.splice(1)),d.save(),void d.render(2))},filterChk:function(e){var t;if(-1!=o.color.indexOf(e.color)||-1!=o.user.indexOf(e.hash))return!1;for(t=0;t<s.length;t++)try{if(null!=e.text.match(s[t]))return!1}catch(e){}return!0},filter:function(e){return shield.filterChk(e)?(e.filtered||(e.oriSize=e.size,e.filtered=!0),e.size=e.oriSize*abpinst.commentScale,e):!1},shield:function(){for(s=[],j=0;j<o.text.length;j++)s.push(a?new RegExp(o.text[j]):o.text[j])}};return d}(),BinArray=function(){var e={};return e.bsearch=function(e,t,i){if(0===e.length)return 0;if(i(t,e[0])<0)return 0;if(i(t,e[e.length-1])>=0)return e.length;for(var o=0,n=0,a=0,s=e.length-1;s>=o;){if(n=Math.floor((s+o+1)/2),a++,i(t,e[n-1])>=0&&i(t,e[n])<0)return n;i(t,e[n-1])<0?s=n-1:i(t,e[n])>=0?o=n:console.error("Program Error"),a>1500&&console.error("Too many run cycles.")}return-1},e.binsert=function(t,i,o){var n=e.bsearch(t,i,o);return t.splice(n,0,i),n},e}(),__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},CommentSpaceAllocator=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this._pools=[[]],this.avoid=1,this._width=e,this._height=t}return e.prototype.willCollide=function(e,t){return e.stime+e.ttl>=t.stime+t.ttl/2},e.prototype.pathCheck=function(e,t,i){for(var o=e+t.height,n=t.right,a=0;a<i.length;a++)if(!(i[a].y>o||i[a].bottom<e)){if(!(i[a].right<t.x||i[a].x>n))return!1;if(this.willCollide(i[a],t))return!1}return!0},e.prototype.assign=function(e,t){for(;this._pools.length<=t;)this._pools.push([]);var i=this._pools[t];if(0===i.length)return e.cindex=t,0;if(this.pathCheck(0,e,i))return e.cindex=t,0;for(var o=0,n=0;n<i.length&&(o=i[n].bottom+this.avoid,!(o+e.height>this._height));n++)if(this.pathCheck(o,e,i))return e.cindex=t,o;return this.assign(e,t+1)},e.prototype.add=function(e){e.height>this._height?(e.cindex=-2,e.y=0):(e.y=this.assign(e,0),BinArray.binsert(this._pools[e.cindex],e,function(e,t){return e.bottom<t.bottom?-1:e.bottom>t.bottom?1:0}))},e.prototype.remove=function(e){if(!(e.cindex<0)){if(e.cindex>=this._pools.length)throw new Error("cindex out of bounds");var t=this._pools[e.cindex].indexOf(e);0>t||this._pools[e.cindex].splice(t,1)}},e.prototype.setBounds=function(e,t){this._width=e,this._height=t},e}(),AnchorCommentSpaceAllocator=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.add=function(t){e.prototype.add.call(this,t),t.x=(this._width-t.width)/2},t.prototype.willCollide=function(){return!0},t.prototype.pathCheck=function(e,t,i){for(var o=e+t.height,n=0;n<i.length;n++)if(!(i[n].y>o||i[n].bottom<e))return!1;return!0},t}(CommentSpaceAllocator),CoreComment=function(){function e(t,i){if(void 0===i&&(i={}),this.mode=1,this.stime=0,this.text="",this.ttl=4e3,this.dur=4e3,this.cindex=-1,this.motion=[],this.movable=!0,this._alphaMotion=null,this.absolute=!0,this.align=0,this._alpha=1,this._size=25,this._color=16777215,this._border=!1,this._shadow=!0,this._font="",!t)throw new Error("Comment not bound to comment manager.");if(this.parent=t,i.hasOwnProperty("stime")&&(this.stime=i.stime),this.mode=i.hasOwnProperty("mode")?i.mode:1,i.hasOwnProperty("dur")&&(this.dur=i.dur,this.ttl=this.dur),this.dur*=this.parent.options.global.scale,this.ttl*=this.parent.options.global.scale,(4===this.mode||5===this.mode)&&(this.dur*=.6,this.ttl*=.6),i.hasOwnProperty("text")&&(this.text=i.text),i.hasOwnProperty("motion")){this._motionStart=[],this._motionEnd=[],this.motion=i.motion;for(var o=0,n=0;n<i.motion.length;n++){this._motionStart.push(o);var a=0;for(var s in i.motion[n]){var l=i.motion[n][s];a=Math.max(l.dur,a),(null===l.easing||void 0===l.easing)&&(i.motion[n][s].easing=e.LINEAR)}o+=a,this._motionEnd.push(o)}this._curMotion=0}i.hasOwnProperty("color")&&(this._color=i.color),i.hasOwnProperty("size")&&(this._size=i.size),i.hasOwnProperty("border")&&(this._border=i.border),i.hasOwnProperty("opacity")&&(this._alpha=i.opacity),i.hasOwnProperty("alpha")&&(this._alphaMotion=i.alpha),i.hasOwnProperty("font")&&(this._font=i.font),i.hasOwnProperty("x")&&(this._x=i.x),i.hasOwnProperty("y")&&(this._y=i.y),i.hasOwnProperty("shadow")&&(this._shadow=i.shadow),i.hasOwnProperty("position")&&"relative"===i.position&&(this.absolute=!1,this.mode<7&&console.warn("Using relative position for CSA comment."))}return e.prototype.init=function(e){void 0===e&&(e=null),this.dom=null!==e?e.dom:document.createElement("div"),this.dom.className=this.parent.options.global.className,this.dom.appendChild(document.createTextNode(this.text)),this.dom.textContent=this.text,this.dom.innerText=this.text,this.size=this._size,16777215!=this._color&&(this.color=this._color),this.shadow=this._shadow,this._border&&(this.border=this._border),""!==this._font&&(this.font=this._font),void 0!==this._x&&(this.x=this._x),void 0!==this._y&&(this.y=this._y),(1!==this._alpha||this.parent.options.global.opacity<1)&&(this.alpha=this._alpha),this.motion.length>0&&this.animate()},Object.defineProperty(e.prototype,"x",{get:function(){return(null===this._x||void 0===this._x)&&(this._x=this.align%2===0?this.dom.offsetLeft:this.parent.width-this.dom.offsetLeft-this.width),this.absolute?this._x:this._x/this.parent.width},set:function(e){this._x=e,this.absolute||(this._x*=this.parent.width),this.align%2===0?this.dom.style.left=this._x+"px":this.dom.style.right=this._x+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return(null===this._y||void 0===this._y)&&(this._y=this.align<2?this.dom.offsetTop:this.parent.height-this.dom.offsetTop-this.height),this.absolute?this._y:this._y/this.parent.height},set:function(e){this._y=e,this.absolute||(this._y*=this.parent.height),this.align<2?this.dom.style.top=this._y+"px":this.dom.style.bottom=this._y+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return(null===this._width||void 0===this._width)&&(this._width=this.dom.offsetWidth),this._width},set:function(e){this._width=e,this.dom.style.width=this._width+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return(null===this._height||void 0===this._height)&&(this._height=this.dom.offsetHeight),this._height},set:function(e){this._height=e,this.dom.style.height=this._height+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){this._size=e,this.dom.style.fontSize=this._size+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e;var t=e.toString(16);t=t.length>=6?t:new Array(6-t.length+1).join("0")+t,this.dom.style.color="#"+t,0===this._color&&(this.dom.className=this.parent.options.global.className+" rshadow")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha=e,this.dom.style.opacity=Math.min(this._alpha,this.parent.options.global.opacity)+""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"border",{get:function(){return this._border},set:function(e){this._border=e,this.dom.style.border=this._border?"1px solid #00ffff":"none"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadow",{get:function(){return this._shadow},set:function(e){this._shadow=e,this._shadow||(this.dom.className=this.parent.options.global.className+" noshadow")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){return this._font},set:function(e){this._font=e,this.dom.style.fontFamily=this._font.length>0?this._font:""},enumerable:!0,configurable:!0}),e.prototype.time=function(e){this.ttl-=e,this.ttl<0&&(this.ttl=0),this.movable&&this.update(),this.ttl<=0&&this.finish()},e.prototype.update=function(){this.animate()},e.prototype.invalidate=function(){this._x=null,this._y=null,this._width=null,this._height=null},e.prototype._execMotion=function(e,t){for(var i in e)if(e.hasOwnProperty(i)){var o=e[i];this[i]=o.easing(Math.min(Math.max(t-o.delay,0),o.dur),o.from,o.to-o.from,o.dur)}},e.prototype.animate=function(){if(this._alphaMotion&&(this.alpha=(this.dur-this.ttl)*(this._alphaMotion.to-this._alphaMotion.from)/this.dur+this._alphaMotion.from),0!==this.motion.length){var e=Math.max(this.ttl,0),t=this.dur-e-this._motionStart[this._curMotion];return this._execMotion(this.motion[this._curMotion],t),this.dur-e>this._motionEnd[this._curMotion]?(this._curMotion++,void(this._curMotion>=this.motion.length&&(this._curMotion=this.motion.length-1))):void 0}},e.prototype.stop=function(){},e.prototype.finish=function(){this.parent.finish(this)},e.prototype.toString=function(){return["[",this.stime,"|",this.ttl,"/",this.dur,"]","(",this.mode,")",this.text].join("")},e.LINEAR=function(e,t,i,o){return e*i/o+t},e}(),ScrollComment=function(e){function t(t,i){e.call(this,t,i),this.dur*=this.parent.options.scroll.scale,this.ttl*=this.parent.options.scroll.scale}return __extends(t,e),Object.defineProperty(t.prototype,"alpha",{set:function(e){this._alpha=e,this.dom.style.opacity=Math.min(Math.min(this._alpha,this.parent.options.global.opacity),this.parent.options.scroll.opacity)+""},enumerable:!0,configurable:!0}),t.prototype.init=function(t){void 0===t&&(t=null),e.prototype.init.call(this,t),this.x=this.parent.width,this.parent.options.scroll.opacity<1&&(this.alpha=this._alpha),this.absolute=!0},t.prototype.update=function(){this.x=this.ttl/this.dur*(this.parent.width+this.width)-this.width},t}(CoreComment),CSSCompatLayer=function(){function e(){}return e.transform=function(e,t){e.style.transform=t,e.style.webkitTransform=t,e.style.msTransform=t,e.style.oTransform=t},e}(),CSSScrollComment=function(e){function t(){e.apply(this,arguments),this._dirtyCSS=!0}return __extends(t,e),Object.defineProperty(t.prototype,"x",{get:function(){return this.ttl/this.dur*(this.parent.width+this.width)-this.width},set:function(e){if("number"==typeof this._x){var t=e-this._x;this._x=e,CSSCompatLayer.transform(this.dom,"translateX("+t+"px)")}else this._x=e,this.absolute||(this._x*=this.parent.width),this.align%2===0?this.dom.style.left=this._x+"px":this.dom.style.right=this._x+"px"},enumerable:!0,configurable:!0}),t.prototype.update=function(){this._dirtyCSS&&(this.dom.style.transition="transform "+this.ttl+"ms linear",this.x=-this.width,this._dirtyCSS=!1)},t.prototype.invalidate=function(){e.prototype.invalidate.call(this),this._dirtyCSS=!0},t.prototype.stop=function(){this.dom.style.transition="",this.x=this._x,this._x=null,this.x=this.ttl/this.dur*(this.parent.width+this.width)-this.width,this._dirtyCSS=!0},t}(ScrollComment),CommentManager=function(){function e(e){var t=0;this._listeners={},this._lastPosition=0,this.stage=e,this.options={global:{opacity:1,scale:1,className:"cmt"},scroll:{opacity:1,scale:1},limit:0},this.timeline=[],this.runline=[],this.position=0,this.limiter=0,this.filter=null,this.csa={scroll:new CommentSpaceAllocator(0,0),top:new AnchorCommentSpaceAllocator(0,0),bottom:new AnchorCommentSpaceAllocator(0,0),reverse:new CommentSpaceAllocator(0,0),scrollbtm:new CommentSpaceAllocator(0,0)},this.width=this.stage.offsetWidth,this.height=this.stage.offsetHeight,this.startTimer=function(){if(!(t>0)){var e=(new Date).getTime(),i=this;t=window.setInterval(function(){var t=(new Date).getTime()-e;e=(new Date).getTime(),i.onTimerEvent(t,i)},10)}},this.stopTimer=function(){window.clearInterval(t),t=0}}var t=function(e,t){for(var i=Math.PI/180,o=e*i,n=t*i,a=Math.cos,s=Math.sin,l=[a(o)*a(n),a(o)*s(n),s(o),0,-s(n),a(n),0,0,-s(o)*a(n),-s(o)*s(n),a(o),0,0,0,0,1],r=0;r<l.length;r++)Math.abs(l[r])<1e-6&&(l[r]=0);return"matrix3d("+l.join(",")+")"};return e.prototype.stop=function(){this.stopTimer();for(var e=0;e<this.runline.length;e++)"undefined"!=typeof this.runline[e].stop&&this.runline[e].stop()},e.prototype.start=function(){this.startTimer()},e.prototype.seek=function(e){this.position=BinArray.bsearch(this.timeline,e,function(e,t){return e<t.stime?-1:e>t.stime?1:0})},e.prototype.validate=function(e){return null==e?!1:this.filter.doValidate(e)},e.prototype.load=function(e){this.timeline=e,this.timeline.sort(function(e,t){return e.stime>t.stime?2:e.stime<t.stime?-2:e.date>t.date?1:e.date<t.date?-1:null!=e.dbid&&null!=t.dbid?e.dbid>t.dbid?1:e.dbid<t.dbid?-1:0:0}),this.dispatchEvent("load")},e.prototype.insert=function(e){var t=BinArray.binsert(this.timeline,e,function(e,t){return e.stime>t.stime?2:e.stime<t.stime?-2:e.date>t.date?1:e.date<t.date?-1:null!=e.dbid&&null!=t.dbid?e.dbid>t.dbid?1:e.dbid<t.dbid?-1:0:0});t<=this.position&&this.position++,this.dispatchEvent("insert")},e.prototype.clear=function(){for(;this.runline.length>0;)this.runline[0].finish();this.dispatchEvent("clear")},e.prototype.setBounds=function(){this.width=this.stage.offsetWidth,this.height=this.stage.offsetHeight,this.dispatchEvent("resize");for(var e in this.csa)this.csa[e].setBounds(this.width,this.height);this.stage.style.perspective=this.width*Math.tan(40*Math.PI/180)/2+"px",this.stage.style.webkitPerspective=this.width*Math.tan(40*Math.PI/180)/2+"px"},e.prototype.init=function(){this.setBounds(),null==this.filter&&(this.filter=new CommentFilter)},e.prototype.time=function(e){if(e-=1,this.position>=this.timeline.length||Math.abs(this._lastPosition-e)>=2e3){if(this.seek(e),this._lastPosition=e,this.timeline.length<=this.position)return}else this._lastPosition=e;for(;this.position<this.timeline.length&&this.timeline[this.position].stime<=e;this.position++)this.options.limit>0&&this.runline.length>this.limiter||this.validate(this.timeline[this.position])&&this.send(this.timeline[this.position])},e.prototype.rescale=function(){},e.prototype.send=function(e){if(8===e.mode)return console.log(e),void(this.scripting&&console.log(this.scripting.eval(e.code)));if(null==this.filter||(e=this.filter.doModify(e),null!=e)){if(1===e.mode||2===e.mode||6===e.mode)var i=new CSSScrollComment(this,e);else var i=new CoreComment(this,e);switch(i.mode){case 1:i.align=0;break;case 2:i.align=2;break;case 4:i.align=2;break;case 5:i.align=0;break;case 6:i.align=1}switch(i.init(),this.stage.appendChild(i.dom),i.dom.originalData=e,i.dom.transitionStartTime=(new Date).getTime(),i.mode){default:case 1:this.csa.scroll.add(i);break;case 2:this.csa.scrollbtm.add(i);break;case 4:this.csa.bottom.add(i);break;case 5:this.csa.top.add(i);break;case 6:this.csa.reverse.add(i);break;case 17:case 7:(0!==e.rY||0!==e.rZ)&&(i.dom.style.transform=t(e.rY,e.rZ),i.dom.style.webkitTransform=t(e.rY,e.rZ),i.dom.style.OTransform=t(e.rY,e.rZ),i.dom.style.MozTransform=t(e.rY,e.rZ),i.dom.style.MSTransform=t(e.rY,e.rZ))}i.y=i.y,this.dispatchEvent("enterComment",i),this.runline.push(i)}},e.prototype.sendComment=function(e){console.log("CommentManager.sendComment is deprecated. Please use send instead"),this.send(e)},e.prototype.finish=function(e){this.dispatchEvent("exitComment",e);try{this.stage.removeChild(e.dom)}catch(e){}var t=this.runline.indexOf(e);switch(t>=0&&this.runline.splice(t,1),e.mode){default:case 1:this.csa.scroll.remove(e);break;case 2:this.csa.scrollbtm.remove(e);break;case 4:this.csa.bottom.remove(e);break;case 5:this.csa.top.remove(e);break;case 6:this.csa.reverse.remove(e);break;case 7:}},e.prototype.resumeComment=function(){Array.prototype.slice.call(this.stage.children).forEach(function(e){e.classList.contains("cmt")&&e.classList.contains("paused")&&(e.style.transitionDuration=e.finalDuration+"ms",e.style.transform=e.finalTransform,e.transitionStartTime=(new Date).getTime(),e.classList.remove("paused"))})},e.prototype.pauseComment=function(){Array.prototype.slice.call(this.stage.children).forEach(function(e){e.classList.contains("cmt")&&!e.classList.contains("paused")&&(e.finalTransform=e.style.transform,e.style.transform=window.getComputedStyle(e).getPropertyValue("transform"),e.finalDuration=parseFloat(e.style.transitionDuration)-(new Date).getTime()+e.transitionStartTime,e.style.transitionDuration="10ms",e.classList.add("paused"))})},e.prototype.addEventListener=function(e,t){"undefined"!=typeof this._listeners[e]?this._listeners[e].push(t):this._listeners[e]=[t]},e.prototype.dispatchEvent=function(e,t){if("undefined"!=typeof this._listeners[e])for(var i=0;i<this._listeners[e].length;i++)try{this._listeners[e][i](t)}catch(e){console.err(e.stack)}},e.prototype.onTimerEvent=function(e,t){for(var i=0;i<t.runline.length;i++){var o=t.runline[i];o.hold||o.time(e)}},e}(),ABP={version:"0.8.0",Strings:{statsPlayer:"播放器尺寸：",statsVideo:"视频分辨率：",statsBuffer:"可用缓冲：",statsMozParse:"已解析帧：",statsMozDecode:"已解码帧：",statsMozPaint:"已绘制帧：",statsWebkitDecode:"已解码帧：",statsPresent:"已显示帧：",statsDrop:"已丢弃帧：",statsVideoCodec:"视频编码：",statsAudioCodec:"音频编码：",statsVideoBitrate:"视频码率：",statsAudioBitrate:"音频码率：",statsCurrentBitrate:"本段码率：",statsRealtimeBitrate:"实时码率：",overallBitrate:"总体码率：",statsDownloadSpeed:"下载速度：",sendSmall:"小字号",sendMid:"中字号",sendSize:"弹幕字号",sendMode:"弹幕模式",sendTop:"顶端渐隐",sendScroll:"滚动字幕",sendBottom:"底端渐隐",send:"发送",sendStyle:"弹幕样式",sendColor:"弹幕颜色",commentSpeed:"弹幕速度",commentScale:"弹幕比例",commentOpacity:"弹幕不透明度",commentBlock:"弹幕屏蔽列表",playSpeed:"播放速度",playSpeedReset:"还原正常速度",displayScaleD:"默认",displayScaleF:"全屏",shieldTypeText:"文字",shieldTypeUser:"用户",shieldTypeColor:"颜色",shieldTypeSetting:"设置",shieldAdd:"添加屏蔽……",shieldUseRegex:"启用正则",viewers:" 观众",comments:" 弹幕",commentTime:"时间",commentContent:"评论",commentDate:"发送日期",showStats:"显示统计信息",loadingMeta:"正在加载视频信息",switching:"正在切换",fetchURL:"正在获取视频地址",buffering:"正在缓冲",play:"播放",pause:"暂停",mute:"静音",unmute:"取消静音",fullScreen:"浏览器全屏",exitFullScreen:"退出全屏",webFull:"网页全屏",exitWebFull:"退出网页全屏",wideScreen:"宽屏模式",exitWideScreen:"退出宽屏",sendTooltip:"毁灭地喷射白光!da!",showComment:"显示弹幕",hideComment:"隐藏弹幕",loopOn:"洗脑循环 on",loopOff:"重新载入",copyComment:"复制弹幕",findComment:"定位弹幕",blockContent:"屏蔽内容“",blockUser:"屏蔽发送者",blockColor:"屏蔽颜色",blockColorWhite:"不能屏蔽白色",copyFail:"复制失败，浏览器不支持",blockUserEmpty:"没有屏蔽用户",blockColorEmpty:"没有屏蔽颜色"}};!function(){"use strict";if(ABP){var e=jQuery,t=window.setTimeout,i=window.clearTimeout,o="addEventListener",n="HTML5 Player ver.170303 based on ABPlayer-bilibili-ver",a=function(e){return document.getElementById(e)},s=function(e,t,i,o){var n=null;if("text"===e)return document.createTextNode(t);n=document.createElement(e);for(var a in t)if("style"!==a&&"className"!==a)n.setAttribute(a,t[a]);else if("className"===a)n.className=t[a];else for(var s in t.style)n.style[s]=t.style[s];if(i)for(var l=0;l<i.length;l++)null!=i[l]&&n.appendChild(i[l]);return o&&"function"==typeof o&&o(n),n},l=function(e,t){for(;e;e=e.parentNode)if(f(e.parentNode,t))return e};HTMLElement.prototype.tooltip=function(e){this.tooltipData=e,this.dispatchEvent(new Event("updatetooltip"))},"undefined"==typeof HTMLElement.prototype.requestFullScreen&&(HTMLElement.prototype.requestFullScreen=function(){this.webkitRequestFullscreen?this.webkitRequestFullscreen():this.mozRequestFullScreen?this.mozRequestFullScreen():this.msRequestFullscreen&&this.msRequestFullscreen()}),"undefined"==typeof document.isFullScreen&&(document.isFullScreen=function(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenEnabled}),"undefined"==typeof document.exitFullscreen&&(document.exitFullscreen=function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():window.msExitFullscreen&&msExitFullscreen()});var r=function(e,t){t=t||2;for(var i=""+e;i.length<t;)i="0"+i;return i},c=function(e,t){for(var i="",o=1;o<=t-(e+"").length;o++)i+="0";return i+e},d=function(e,t){if(0==e)return lang.oneDay;var i,o,n,a,s,l,r=new Date(1e3*parseInt(e));return i=String(r.getFullYear()),o=String(r.getMonth()+1),1==o.length&&(o="0"+o),n=String(r.getDate()),1==n.length&&(n="0"+n),a=String(r.getHours()),1==a.length&&(a="0"+a),s=String(r.getMinutes()),1==s.length&&(s="0"+s),l=String(r.getSeconds()),1==l.length&&(l="0"+l),String(t?o+"-"+n+" "+a+":"+s:i+"-"+o+"-"+n+" "+a+":"+s+":"+l)},m=function(e){return isNaN(e)?"00:00":c(parseInt(e/60),2)+":"+c(parseInt(e%60),2)},u=function(e){for(var t=e.split(":"),i=0,o=0;o<t.length;o++){i*=60;var n=parseInt(t[o]);if(isNaN(n)||0>n)return!1;i+=n}return i},h=function(e,t,i){e&&(e[o]("mousemove",function(o){var n,r=a("ABP-Tooltip"),c=e.clientWidth,d=e.clientHeight,m=e.getBoundingClientRect(),u=l(e,"ABP-Unit").getBoundingClientRect(),h=m.top-u.top,p=t?o.clientX-u.left:m.left-u.left,f=p;null==r&&(r=s("div",{id:"ABP-Tooltip"},[s("text",e.tooltipData)]),r.by=e,l(e,"ABP-Unit").appendChild(r),r.style.top=h+d+2+"px",r.style.left=p+c/2-r.clientWidth/2+"px",f+=c/2-r.clientWidth/2),t&&(r.style.left=p-r.clientWidth/2+"px",f-=c/2),n=r.getBoundingClientRect(),n.left<0?r.style.left="0px":n.right>window.innerWidth&&(r.style.left=window.innerWidth-n.width+"px"),i=i||-6,i&&(r.style.top=h-r.clientHeight+2+i+"px")}),e[o]("mouseout",function(){var e=a("ABP-Tooltip");e&&e.parentNode&&e.parentNode.removeChild(e)}),e[o]("updatetooltip",function(t){var i=a("ABP-Tooltip");i&&i.by==t.target&&(i.innerHTML=e.tooltipData)}))},p=function(e,t){if(null!=e){var i=e.className.split(" ");""==i[0]&&(i=[]),i.indexOf(t)<0&&i.push(t),e.className=i.join(" ")}},f=function(e,t){if(null==e)return!1;var i=e.className.split(" ");return""==i[0]&&(i=[]),i.indexOf(t)>=0},v=function(e,t){if(null!=e){var i=e.className.split(" ");""==i[0]&&(i=[]),i.indexOf(t)>=0&&i.splice(i.indexOf(t),1),e.className=i.join(" ")}},g=function(e,t){var i={};for(var o in t)i[o]=e&&"undefined"!=typeof e[o]?e[o]:t[o];return i};ABP.create=function(e,t){var i=e;if(t||(t={}),ABP.playerConfig=t.config?t.config:{},t=g(t,{replaceMode:!0,width:512,height:384,src:""}),"string"==typeof e&&(i=a(e)),f(i,"ABP-Unit"))l=i;else{var l=s("div",{className:"ABP-Unit",style:{width:t.width.toString().indexOf("%")>=0?t.width:t.width+"px",height:t.height.toString().indexOf("%")>=0?t.height:t.height+"px"}});i.appendChild(l)}l.children.length>0&&t.replaceMode&&(l.innerHTML="");var r=[],c=[];if("string"==typeof t.src)t.src=s("video",{autobuffer:"true",dataSetup:"{}"},[s("source",{src:t.src})]),r.push(t.src);else if(t.src.hasOwnProperty("playlist"))for(var d=t.src,m=d.playlist,u=0;u<m.length;u++){if(m[u].hasOwnProperty("sources")){var h=[];for(var p in m[u].sources)h.push(s("source",{src:m[u][p],type:p}));r.push(s("video",{autobuffer:"true",dataSetup:"{}"},h))}else m[u].hasOwnProperty("video")&&r.push(m[u].video);c.push(m[u].comments)}else r.push(t.src);l.appendChild(s("div",{className:"ABP-Player"},[s("div",{className:"ABP-Video",tabindex:"10"},[s("div",{id:"info-box",style:{opacity:1}},[s("div",{className:"text-wrapper"},[s("div",{},[s("text",ABP.Strings.loadingMeta)])]),s("div",{id:"dots"})]),s("div",{className:"ABP-Container"}),r[0],s("div",{className:"Player-Stats"},[s("div",{id:"player-dimension"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsPlayer)]),s("span")]),s("div",{id:"video-dimension"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsVideo)]),s("span")]),s("div",{id:"buffer-health"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsBuffer)]),s("span",{className:"stats-column",id:"buffer-health-column"}),s("span")]),s("br",{className:"flvjs"}),s("div",{className:"flvjs"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsVideoCodec)]),s("span")]),s("div",{className:"flvjs"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsAudioCodec)]),s("span")]),s("div",{className:"flvjs"},[s("span",{className:"stats_name"},[s("text","fps：")]),s("span")]),s("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsVideoBitrate)]),s("span")]),s("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsAudioBitrate)]),s("span")]),s("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsRealtimeBitrate)]),s("span",{className:"stats-column",id:"realtime-bitrate-column",style:{verticalAlign:"top"}}),s("span")]),s("div",{className:"flvjs"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsDownloadSpeed)]),s("span",{className:"stats-column",id:"download-speed-column",style:{verticalAlign:"top"}}),s("span")]),s("br",{className:"hlsjs"}),s("div",{className:"hlsjs"},[s("span",{className:"stats_name"},[s("text","当前分片：")]),s("span",{style:{width:"180px",height:"5px",display:"inline-block",position:"relative",border:"solid #AAA 1px",borderRadius:"4px",verticalAlign:"middle",marginRight:"2px"}},[s("span",{id:"download-progress-hls",style:{position:"absolute",left:"2px",right:"2px",top:"1px",bottom:"1px",background:"#CCC",borderRadius:"3px",transition:"width .3s",width:0}})]),s("span")]),s("div",{className:"hlsjs"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsDownloadSpeed)]),s("span",{className:"stats-column",id:"download-speed-hls-column",style:{verticalAlign:"top"}}),s("span")]),s("br"),s("div",{className:"gecko"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsMozParse)]),s("span",{id:"mozParsedFrames"
})]),s("div",{className:"gecko"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsMozDecode)]),s("span",{id:"mozDecodedFrames"})]),s("div",{className:"gecko"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsMozPaint)]),s("span",{id:"mozPaintedFrames"})]),s("div",{className:"webkit"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsWebkitDecode)]),s("span",{id:"webkitDecodedFrameCount"})]),s("div",{className:"webkit"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsDrop)]),s("span",{id:"webkitDroppedFrameCount"})]),s("div",{className:"videoQuality"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsPresent)]),s("span",{id:"totalVideoFrames"})]),s("div",{className:"videoQuality"},[s("span",{className:"stats_name"},[s("text",ABP.Strings.statsDrop)]),s("span",{id:"droppedVideoFrames"})]),s("br"),s("div",{style:{fontSize:"11px"}},[s("text",n)]),s("div",{style:{fontSize:"11px"}},[s("text","2017©esterTion")]),s("div",{id:"stats-close"},[s("text","×")])])]),s("div",{className:"ABP-FullScreenProgress"}),s("div",{className:"ABP-Bottom"},[s("div",{className:"ABP-Bottom-Extend"}),s("div",{className:"ABP-Text"},[s("div",{className:"ABP-CommentStyle"},[s("div",{className:"button-group ABP-Comment-FontGroup"},[s("div",{className:"button ABP-Comment-Font icon-font-style"}),s("div",{className:"ABP-Comment-FontOption"},[s("p",{className:"style-title"},[s("text",ABP.Strings.sendSize)]),s("div",{className:"style-select",name:"commentFontSize"},[s("div",{className:"style-option",value:18},[s("text",ABP.Strings.sendSmall)]),s("div",{className:"style-option on",value:25},[s("text",ABP.Strings.sendMid)])]),s("p",{className:"style-title"},[s("text",ABP.Strings.sendMode)]),s("div",{className:"style-select",name:"commentMode"},[s("div",{className:"style-option",value:5},[s("text",ABP.Strings.sendTop)]),s("div",{className:"style-option on",value:1},[s("text",ABP.Strings.sendScroll)]),s("div",{className:"style-option",value:4},[s("text",ABP.Strings.sendBottom)])])])]),s("div",{className:"button-group ABP-Comment-ColorGroup"},[s("div",{className:"ABP-Comment-Color-Display"}),s("div",{className:"button ABP-Comment-Color icon-color-mode"}),s("div",{className:"ABP-Comment-ColorOption"},[s("div",{className:"ABP-Comment-ColorPicker"})])])]),s("form",{},[s("input",{className:"ABP-Comment-Input"})]),s("div",{className:"ABP-Comment-Send"},[s("text",ABP.Strings.send)])]),s("div",{className:"ABP-Control"},[s("div",{className:"button ABP-Play icon-play"}),s("div",{className:"progress-bar"},[s("div",{className:"bar"},[s("div",{className:"load"}),s("div",{className:"dark"})])]),s("div",{className:"time-label"},[s("text","00:00")]),s("div",{className:"button ABP-Volume icon-volume-high"}),s("div",{className:"volume-bar"},[s("div",{className:"bar"},[s("div",{className:"load"})])]),s("div",{className:"button-group ABP-CommentGroup"},[s("div",{className:"button ABP-CommentShow icon-comment on"}),s("div",{className:"ABP-CommentOption"},[s("p",{className:"label"},[s("text",ABP.Strings.commentSpeed)]),s("div",{className:"speed-bar"},[s("div",{className:"bar"},[s("div",{className:"load"})])]),s("p",{className:"label"},[s("text",ABP.Strings.commentScale)]),s("div",{className:"scale-bar"},[s("div",{className:"bar"},[s("div",{className:"load"})])]),s("div",{className:"prop-checkbox"}),s("p",{className:"label"},[s("text",ABP.Strings.commentOpacity)]),s("div",{className:"opacity-bar"},[s("div",{className:"bar"},[s("div",{className:"load"})])]),s("div",{className:"shield-enrty"},[s("text",ABP.Strings.commentBlock)])])]),s("div",{className:"button-group ABP-PlaySpeedGroup"},[s("div",{className:"button ABP-Loop icon-loop"})]),s("div",{className:"button ABP-WideScreen icon-tv"}),s("div",{className:"button-group ABP-FullScreenGroup"},[s("div",{className:"button ABP-FullScreen icon-screen-full"}),s("div",{className:"button ABP-Web-FullScreen icon-screen"})])]),s("div",{className:"BiliPlus-Scale-Menu"},[s("div",{className:"Video-Defination"}),s("div",{className:"Video-Scale"},[s("div",{changeTo:"default",className:"on"},[s("text",ABP.Strings.displayScaleD)]),s("div",{changeTo:"16_9"},[s("text","16:9")]),s("div",{changeTo:"4_3"},[s("text","4:3")]),s("div",{changeTo:"full"},[s("text",ABP.Strings.displayScaleF)])])])])])),l.appendChild(s("div",{className:"shield hidden"},[s("div",{className:"shield_top"},[s("text",ABP.Strings.commentBlock),s("span",{className:"close"})]),s("div",{className:"shield_tabs"},[s("div",{className:"shield_tab on"},[s("div",{},[s("text",ABP.Strings.shieldTypeText)])]),s("div",{className:"shield_tab"},[s("div",{},[s("text",ABP.Strings.shieldTypeUser)])]),s("div",{className:"shield_tab"},[s("div",{},[s("text",ABP.Strings.shieldTypeColor)])]),s("div",{className:"shield_tab"},[s("div",{},[s("text",ABP.Strings.shieldTypeSetting)])])]),s("div",{className:"shield_tab_slash"}),s("div",{className:"shield_body"},[s("div",{className:"shield_body_wrapper"},[s("div",{className:"shield_tab_body"},[s("div",{id:"shield_text"}),s("div",{className:"shield_item"},[s("input",{className:"new",type:"text",placeholder:ABP.Strings.shieldAdd}),s("div",{className:"add"})])]),s("div",{className:"shield_tab_body"},[s("div",{id:"shield_user"})]),s("div",{className:"shield_tab_body"},[s("div",{id:"shield_color"})]),s("div",{className:"shield_tab_body"},[s("div",{className:"shield_toggle",id:"useReg"},[s("text",ABP.Strings.shieldUseRegex)])])])])])),l.appendChild(s("div",{className:"ABP-Comment-List"},[s("div",{className:"ABP-Comment-List-Count"},[s("div",{style:{position:"absolute",right:"200px"}},[s("span",{id:"viewer",style:{fontWeight:"bold"}},[s("text","--")]),s("text",ABP.Strings.viewers)]),s("div",{style:{position:"absolute",right:"20px"}},[s("span",{id:"danmaku",style:{fontWeight:"bold"}},[s("text","--")]),s("text",ABP.Strings.comments)])]),s("div",{className:"ABP-Comment-List-Title"},[s("div",{className:"cmt-time",item:"time"},[s("text",ABP.Strings.commentTime)]),s("div",{className:"cmt-content",item:"content"},[s("text",ABP.Strings.commentContent)]),s("div",{className:"cmt-date",item:"date"},[s("text",ABP.Strings.commentDate)])]),s("div",{className:"ABP-Comment-List-Container"},[s("ul",{className:"ABP-Comment-List-Container-Inner"})])])),l.appendChild(s("div",{className:"Context-Menu"},[s("div",{className:"Context-Menu-Background"}),s("div",{className:"Context-Menu-Body"},[s("div",{id:"Player-Stats-Toggle"},[s("text",ABP.Strings.showStats)]),s("div",{className:"about"},[s("text",n)])])]));var v=ABP.bind(l);if(r.length>0){var y=r[0];v.gotoNext=function(){var e=r.indexOf(y)+1;if(e<r.length){y=r[e],y.style.display="";var t=v.video.parentNode;t.removeChild(v.video),t.appendChild(y),v.video.style.display="none",v.video=y,v.swapVideo(y),y[o]("ended",function(){v.gotoNext()})}},y[o]("ended",function(){v.gotoNext()})}return v};var y=function(){var e=3988292384,t=new Array(256),i=function(){var i,o,n;for(o=0;256>o;++o){for(i=o,n=0;8>n;++n)i=0!=(1&i)?e^i>>>1:i>>>1;t[o]=i}},o=function(e,i){for(var o,n=4294967295,a=e.length,s=0;a>s;++s)o=255&(n^e.charCodeAt(s)),n=n>>>8^t[o];return i?o:n},n=function(e){for(var i=0;256>i;i++)if(t[i]>>>24==e)return i;return-1},a="",s=function(e,i){var n=0,s="",l=o(e.toString(),!1);return n=255&l^i[2],57>=n&&n>=48?(s+=n-48,l=t[i[2]]^l>>>8,n=255&l^i[1],57>=n&&n>=48?(s+=n-48,l=t[i[1]]^l>>>8,n=255&l^i[0],57>=n&&n>=48?(s+=n-48,l=t[i[0]]^l>>>8,a=s,1):0):0):0};i();var l=new Array(4);return function(e){var i,r,c,d=4294967295^parseInt(e,16);for(r=1;1001>r;r++)if(d==o(r.toString(),!1))return r;for(r=3;r>=0;r--)l[3-r]=n(d>>>8*r),i=t[l[3-r]],d^=i>>>8*(3-r);for(r=0;1e5>r&&(c=o(r.toString(),!0),c!=l[3]||!s(r,l));r++);return 1e5==r?-1:r+""+a}},b=function(e){for(var t,i,o=0,n=e.currentTime;o<e.buffered.length;o++)if(n>=e.buffered.start(o)&&n<=e.buffered.end(o)){t=e.buffered.start(o),i=e.buffered.end(o);break}return o==e.buffered.length?{start:0,end:0,delta:0}:{start:t,end:i,delta:i-n}};window.crc_engine=new y,ABP.bind=function(n,a){var l={playerUnit:n,btnPlay:null,barTime:null,barFullScreenTime:null,barLoad:null,barTimeHitArea:null,barVolume:null,barVolumeHitArea:null,barOpacity:null,barOpacityHitArea:null,barScale:null,barScaleHitArea:null,barSpeed:null,barSpeedHitArea:null,btnFont:null,btnColor:null,btnSend:null,controlBar:null,timeLabel:null,timeJump:null,divComment:null,btnWide:null,btnFull:null,btnWebFull:null,btnDm:null,btnLoop:null,btnProp:null,videoDiv:null,btnVolume:null,video:null,txtText:null,commentColor:"ffffff",commentFontSize:25,commentMode:1,displayColor:null,cmManager:null,commentList:null,commentListContainer:null,lastSelectedComment:null,commentCoolDown:1e4,commentScale:ABP.playerConfig.scale?ABP.playerConfig.scale:1,commentSpeed:ABP.playerConfig.speed?ABP.playerConfig.speed:1,proportionalScale:ABP.playerConfig.prop,defaults:{w:0,h:0},state:g(a,{fullscreen:!1,commentVisible:!0,allowRescale:!1,autosize:!1,widescreen:!1}),createPopup:function(e,i){if(n.hasPopup===!0)return!1;var o=s("div",{className:"ABP-Popup"},[s("text",e)]);return o.remove=function(){o.isRemoved||(o.isRemoved=!0,n.removeChild(o),n.hasPopup=!1)},n.appendChild(o),n.hasPopup=!0,"number"==typeof i&&t(function(){o.remove()},i),o},removePopup:function(){for(var e=n.getElementsByClassName("ABP-Popup"),t=0;t<e.length;t++)null!=e[t].remove?e[t].remove():e[t].parentNode.removeChild(e[t]);n.hasPopup=!1},loadCommentList:function(e,t){t="asc"==t?-1:1;var i=Object.keys(l.commentList).sort(function(i,o){return l.commentList[i][e]<l.commentList[o][e]?t:l.commentList[i][e]>l.commentList[o][e]?-t:0});l.commentObjArray=[];for(x in i){var n=i[x],a=l.commentList[n];if(a&&a.time){var r=s("li",{}),c=s("span",{className:"cmt-time"},[s("text",m(a.time/1e3))]),u=s("span",{className:"cmt-content"},[s("text",a.content)]),p=s("span",{className:"cmt-date"},[s("text",d(a.date,!0))]);h(u,!1,36),h(p,!1,18),u.tooltip(a.content),p.tooltip(d(a.date)),r.appendChild(c),r.appendChild(u),r.appendChild(p),r.data=a,r.originalData=danmaku,8==a.mode?r.style.background="#ffe100":0!=a.pool&&(r.style.background="#20ff20"),r[o]("dblclick",function(){l.video.currentTime=this.data.time/1e3,qe(w.currentTime)}),l.commentObjArray.push(r)}}l.commentListContainer.style.height=24*l.commentObjArray.length+"px",l.renderCommentList(),l.playerUnit.querySelector(".ABP-Comment-List-Count span#danmaku").innerHTML=l.commentObjArray.length},renderCommentList:function(){var e=l.commentListContainer.parentElement.scrollTop,t=parseInt(e/24);l.commentListContainer.innerHTML="";for(var i=t;t+40>=i&&"undefined"!=typeof l.commentObjArray[i];i++){if(i==t&&i>0){var n=l.commentObjArray[i].cloneNode(!0),a=n.getElementsByClassName("cmt-content")[0],s=n.getElementsByClassName("cmt-date")[0];n[o]("dblclick",function(){l.video.currentTime=l.commentObjArray[i].data.time/1e3,qe(w.currentTime)}),h(a,!1,36),h(s,!1,18),a.tooltip(l.commentObjArray[i].data.content),s.tooltip(d(l.commentObjArray[i].data.date)),n.style.paddingTop=24*t+"px"}else var n=l.commentObjArray[i];l.commentObjArray[i].childNodes[0].className=l.commentObjArray[i].data.originalData.isBlocked?"cmt-time blocked":"cmt-time",l.commentListContainer.appendChild(n)}l.commentListContainer.parentElement.scrollTop=e},commentCallback:function(e){e.result?(l.commentList[e.id]=l.commentList[e.tmp_id],delete l.commentList[e.tmp_id]):(delete l.commentList[e.tmp_id],l.createPopup(e.error,5e3))},swapVideo:null},c=function(e,t){var i=localStorage.html5Settings||"{}";i=JSON.parse(i),i[e]=t,localStorage.html5Settings=JSON.stringify(i)};if(c.scale=function(){c("scale",l.commentScale)},c.opacity=function(){c("opacity",l.cmManager.options.global.opacity)},c.speed=function(){c("speed",l.commentSpeed)},c.commentVisible=function(){c("commentVisible",l.cmManager.display)},l.swapVideo=function(e){var i=function(){if(!Ve){qe(e.currentTime);try{l.barLoad.style.width="100%"}catch(e){return}}};e[o]("timeupdate",i),e[o]("ended",function(){l.btnPlay.className="button ABP-Play icon-play",l.barTime.style.width="0%",l.barFullScreenTime.style.width="0%"}),e[o]("progress",i),e.isBound=!0;var a=0,s=!1;if(l.cmManager){l.cmManager[o]("load",function(){l.commentList={};for(x in l.cmManager.timeline){var e=l.cmManager.timeline[x];8!=e.mode||s||(s=!0,t(function(){var e=new CCLScripting("/js/CommentCoreLibraryScripting.min.js");l.cmManager.scripting=e.getSandbox(l.divComment,l.video)},0)),e.dbid&&e.stime&&(l.commentList[e.dbid]={date:e.date,time:e.stime,mode:e.mode,user:e.hash,pool:e.pool,content:e.text||e.code,originalData:e})}l.loadCommentList("date","asc"),l.commentListContainer.parentElement[o]("scroll",l.renderCommentList)}),l.cmManager.setBounds=function(){n.offsetHeight<=300||n.offsetWidth<=700?p(n,"ABP-Mini"):v(n,"ABP-Mini");{var e=l.videoDiv.offsetWidth,t=l.videoDiv.offsetHeight;l.proportionalScale?t/493*l.commentScale:l.commentScale}this.width=e,this.height=t,this.options.global.scale=this.width/680/l.commentSpeed/l.video.playbackRate,this.dispatchEvent("resize");for(var i in this.csa)this.csa[i].setBounds(this.width,this.height);this.stage.style.width=this.width+"px",this.stage.style.height=this.height+"px",this.stage.style.perspective=this.width*Math.tan(40*Math.PI/180)/2+"px",this.stage.style.webkitPerspective=this.width*Math.tan(40*Math.PI/180)/2+"px",n.querySelector(".BiliPlus-Scale-Menu .Video-Scale div.on").click()},l.cmManager.setBounds(),l.cmManager.clear();var r=0,c=!1,d=!1,m=function(){d=!1,e.removeEventListener("canplay",m),e.paused&&l.btnPlay.click()},u=function(){var t=e.readyState,i=document.getElementById("info-box");if(!e.ended)switch(t){case 1:isMobile()&&e.paused&&l.createPopup("请点击播放器开始播放",3e3);case 2:0==i.style.opacity&&(i.style.opacity=1),dots.running||dots.runTimer();try{var o=b(e);i.childNodes[0].childNodes[0].innerHTML=ABP.Strings.buffering+" "+Math.floor(100*o.delta)/100+"s"}catch(e){i.childNodes[0].childNodes[0].innerHTML=ABP.Strings.buffering}break;case 3:case 4:1==i.style.opacity&&(i.style.opacity=0,dots.stopTimer())}};e[o]("autoplay",function(){e[o]("canplay",m)}),e[o]("loop",function(){c=e.loop}),e[o]("canplay",m),e[o]("canplay",u),e[o]("waiting",u),e[o]("progress",u),e[o]("progress",function(){a==e.currentTime&&h&&(new Date).getTime()-r>=100?e.hasStalled=!0:a!=e.currentTime&&(a=e.currentTime),r=(new Date).getTime()}),window&&window[o]("resize",function(){l.cmManager.setBounds()}),e[o]("timeupdate",function(){l.cmManager.display!==!1&&(e.hasStalled&&(e.hasStalled=!1),l.cmManager.time(Math.floor(1e3*e.currentTime)))}),e[o]("play",function(){l.cmManager.setBounds()}),e[o]("ratechange",function(){1!=this.playbackRate&&(this.playbackRate=1)});var h=!1;e[o]("pause",function(){h=!1}),e[o]("waiting",function(){h=!1}),e[o]("playing",function(){h=!0})}},null!==n&&null!==n.getElementsByClassName){l.defaults.w=n.offsetWidth,l.defaults.h=n.offsetHeight;var y=n.getElementsByClassName("ABP-Video");if(!(y.length<=0)){var w=null;l.videoDiv=y[0];for(var x in y[0].children)if(null!=y[0].children[x].tagName&&"VIDEO"===y[0].children[x].tagName.toUpperCase()){w=y[0].children[x];break}var k=y[0].getElementsByClassName("ABP-Container");if(k.length>0&&(l.divComment=k[0]),null!==w){l.video=w,l.video.seek=function(e){this.currentTime=parseFloat(e)/1e3};var S=n.getElementsByClassName("ABP-Play");if(!(S.length<=0)){l.btnPlay=S[0],l.btnPlay.tooltip(ABP.Strings.play),h(l.btnPlay);var C=n.getElementsByClassName("progress-bar");if(!(C.length<=0)){var _=C[0].getElementsByClassName("bar");l.barTimeHitArea=_[0],l.barLoad=_[0].getElementsByClassName("load")[0],l.barTime=_[0].getElementsByClassName("dark")[0];var P=n.getElementsByClassName("ABP-FullScreenProgress");if(!(P.length<=0)){l.barFullScreenTime=P[0];var B=n.getElementsByClassName("time-label");if(!(B.length<=0)){l.timeLabel=B[0];var A=n.getElementsByClassName("ABP-Volume");if(!(A.length<=0)){l.btnVolume=A[0],l.btnVolume.tooltip(ABP.Strings.mute),h(l.btnVolume);var N=n.getElementsByClassName("volume-bar");if(!(N.length<=0)){var M=N[0].getElementsByClassName("bar");l.barVolumeHitArea=M[0],l.barVolume=M[0].getElementsByClassName("load")[0];var T=n.getElementsByClassName("opacity-bar");if(!(T.length<=0)){var T=T[0].getElementsByClassName("bar");l.barOpacityHitArea=T[0],l.barOpacity=T[0].getElementsByClassName("load")[0];var L=n.getElementsByClassName("scale-bar");if(!(L.length<=0)){var L=L[0].getElementsByClassName("bar");l.barScaleHitArea=L[0],l.barScale=L[0].getElementsByClassName("load")[0];var H=n.getElementsByClassName("speed-bar");if(!(H.length<=0)){var H=H[0].getElementsByClassName("bar");l.barSpeedHitArea=H[0],l.barSpeed=H[0].getElementsByClassName("load")[0];var F=n.getElementsByClassName("prop-checkbox");if(!(F.length<=0)){l.btnProp=F[0],l.btnProp.tooltip("缩放同步"),h(l.btnProp);var E=n.getElementsByClassName("ABP-FullScreen");if(!(E.length<=0)){l.btnFull=E[0],l.btnFull.tooltip(ABP.Strings.fullScreen),h(l.btnFull);var D=n.getElementsByClassName("ABP-Web-FullScreen");if(!(D.length<=0)){l.btnWebFull=D[0],l.btnWebFull.tooltip(ABP.Strings.webFull),h(l.btnWebFull);var O=n.getElementsByClassName("ABP-WideScreen");if(!(O.length<=0)){l.btnWide=O[0],l.btnWide.tooltip(ABP.Strings.wideScreen),h(l.btnWide);var I=n.getElementsByClassName("ABP-Comment-Font");if(!(I.length<=0)){l.btnFont=I[0],l.btnFont.tooltip(ABP.Strings.sendStyle),h(l.btnFont);var j=n.getElementsByClassName("ABP-Comment-Color");if(!(j.length<=0)){l.btnColor=j[0],l.btnColor.tooltip(ABP.Strings.sendColor),h(l.btnColor);var W=n.getElementsByClassName("ABP-Comment-Color-Display");if(!(W.length<=0)){l.displayColor=W[0];var z=n.getElementsByClassName("ABP-Comment-Input");if(!(z.length<=0)){l.txtText=z[0];var R=n.getElementsByClassName("ABP-Comment-List-Container-Inner");if(!(R.length<=0)){l.commentListContainer=R[0];var V=n.getElementsByClassName("ABP-Comment-Send");if(!(V.length<=0)){l.btnSend=V[0],l.btnSend.tooltip(ABP.Strings.sendTooltip),h(l.btnSend);var q=n.getElementsByClassName("ABP-Control");q.length>0&&(l.controlBar=q[0]);var X=n.getElementsByClassName("ABP-CommentShow");if(!(X.length<=0)){l.btnDm=X[0],l.btnDm.tooltip(ABP.Strings.hideComment),h(l.btnDm);var U=n.getElementsByClassName("ABP-Loop");if(!(U.length<=0)){l.btnLoop=U[0],l.btnLoop.tooltip(ABP.Strings.loopOff),h(l.btnLoop);var Y={videoDimension:!0,gecko:!0,webkit:!0,videoQuality:!0,flvjs:!0},J=function(e){return document.querySelector(e)},Q=function(e){return(1*e).toFixed(2)},G=">:last-child",Z=J("#player-dimension"+G),K=J("#video-dimension"+G),$=J("#buffer-health-column"),ee=J("#realtime-bitrate-column"),te=J("#download-speed-column"),ie=J("#download-speed-hls-column"),oe=[],ne=[],ae=[],se=[],le=J("#buffer-health"+G),re='<svg style="width:180px;height:21px"><polyline style="fill:transparent;stroke:#ccc"></polyline><polyline points="1,21 180,21 180,1" style="fill:transparent;stroke:#fff"></polyline></svg>',ce="",de=document.createElement("style"),me=document.createElement("style"),ue=document.createElement("style"),he=document.querySelectorAll(".flvjs>:last-child"),pe=document.querySelectorAll(".hlsjs>:last-child"),x=0,fe=function(e,t){var i,o=0,n=[];t.find(function(e){o=e>o?e:o}),o=o||1;for(i in t)n.push(3*i+","+(20*(1-t[i]/o)+1)+" "+(3*i+3)+","+(20*(1-t[i]/o)+1));e.setAttribute("points",n.join(" "))},ve=!1,ge=J("#Player-Stats-Toggle"),ye=function(e){"stats-close"==e.target.id&&e.stopPropagation(),J(".Player-Stats").style.display=ve?"":"block",ve=!ve},be=-1,we=!1;for(ge[o]("click",ye),J("#stats-close")[o]("click",ye);60>x;x++)oe.push(0),ne.push(0),ae.push(0),se.push(0);if($.innerHTML=re,$=$.querySelector("polyline"),ee.innerHTML=re,ee=ee.querySelector("polyline"),te.innerHTML=re,te=te.querySelector("polyline"),ie.innerHTML=re,ie=ie.querySelector("polyline"),void 0==w.videoWidth&&(Y.videoDimension=!1,ce+="#video-dimension{display:none}"),void 0==w.mozDecodedFrames&&(Y.gecko=!1,ce+=".gecko{display:none}"),void 0==w.webkitDecodedFrameCount&&(Y.webkit=!1,ce+=".webkit{display:none}"),void 0==w.getVideoPlaybackQuality&&(Y.videoQuality=!1,ce+=".videoQuality{display:none}"),de.innerHTML=ce,document.head.appendChild(de),me.innerHTML=".flvjs{display:none}",document.head.appendChild(me),ue.innerHTML=".hlsjs{display:none}",document.head.appendChild(ue),setInterval(function(){we=!we,Z.innerHTML=w.offsetWidth+"x"+w.offsetHeight+" *"+devicePixelRatio,Y.videoDimension&&(K.innerHTML=w.videoWidth+"x"+w.videoHeight);var e={};try{e=b(w)}catch(e){}if(e=e.delta||0,oe.push(e),oe.shift(),le.innerHTML=Q(e)+"s",ve&&fe($,oe),null!=player.flv){me.innerHTML="";var t=0,i=player.flv._mediaInfo,o=player.flv.statisticsInfo;if(he[t++].innerHTML=i.videoCodec,he[t++].innerHTML=i.audioCodec,he[t++].innerHTML=Q(i.fps),he[t++].innerHTML=Q(i.videoDataRate)+" kbps",he[t++].innerHTML=Q(i.audioDataRate)+" kbps",i.bitrateMap){var n,a=w.currentTime,s=0|a,l=0;i.bitrateMap[l]&&(n=i.bitrateMap[l][s]),void 0!=n?we&&be!=(0|w.currentTime)?(be=0|w.currentTime,he[t++].innerHTML=Q(n)+" kbps",ne.push(n),ne.shift(),ve&&fe(ee,ne)):t++:he[t++].innerHTML="N/A"}else he[t++].innerHTML="N/A";we&&(ae.push(o.speed),ae.shift(),ve&&fe(te,ae),he[t++].innerHTML=Q(o.speed)+" KB/s",player.flv._statisticsInfo.speed=0)}else me.innerHTML=".flvjs{display:none}";if(null!=player.hls){ue.innerHTML="";var r,c=0,t=0;if(void 0!=player.hls.fragmentLoader.loaders.main&&(r=player.hls.fragmentLoader.loaders.main,r.stats.total&&(c=r.stats.loaded/r.stats.total*100)),J("#download-progress-hls").style.width=c+"%",pe[t++].innerHTML=Q(c)+"%",we){var d=player.hls.speed||0;se.push(d),se.shift(),ve&&fe(ie,se),pe[t++].innerHTML=Q(d)+" KB/s"}}else ue.innerHTML=".hlsjs{display:none}";if(Y.gecko&&["mozParsedFrames","mozDecodedFrames","mozPaintedFrames"].find(function(e){J("#"+e).innerHTML=w[e]}),Y.webkit&&["webkitDecodedFrameCount","webkitDroppedFrameCount"].find(function(e){J("#"+e).innerHTML=w[e]}),Y.videoQuality){var m=w.getVideoPlaybackQuality();J("#totalVideoFrames").innerHTML=m.totalVideoFrames,J("#droppedVideoFrames").innerHTML=m.droppedVideoFrames}},500),"undefined"!=typeof CommentManager&&(l.cmManager=new CommentManager(l.divComment),l.cmManager.display=!0,l.cmManager.init(),l.cmManager.clear(),l.cmManager.filter.addModifier(shield.filter),l.cmManager.startTimer(),window&&window[o]("resize",function(){l.cmManager.setBounds()})),"object"==typeof ABP.playerConfig&&(ABP.playerConfig.volume&&(l.video.volume=ABP.playerConfig.volume),ABP.playerConfig.opacity&&(l.cmManager.options.global.opacity=ABP.playerConfig.opacity)),e(".ABP-Comment-List-Title *").click(function(){var t=e(this).attr("item"),i=e(this).hasClass("asc")?"desc":"asc";e(".ABP-Comment-List-Title *").removeClass("asc").removeClass("desc"),e(this).addClass(i),l.loadCommentList(t,i)}),e(".ABP-Unit .ABP-CommentStyle .ABP-Comment-FontOption .style-option").click(function(){e(this).closest(".style-select").find(".style-option").removeClass("on"),e(this).addClass("on"),l[e(this).closest(".style-select").attr("name")]=parseInt(e(this).attr("value"))}),e(n).find(".ABP-Comment-ColorPicker").colpick({flat:!0,submit:0,color:"ffffff",onChange:function(e,t){l.commentColor=t,l.displayColor.style.backgroundColor="#"+t}}),w.isBound!==!0){l.swapVideo(w),l.playerUnit.querySelector(".BiliPlus-Scale-Menu .Video-Defination")[o]("click",function(e){if(!e.target.hasAttribute("changeto"))return!1;var t=JSON.parse(e.target.getAttribute("changeto"));changeSrc({target:{value:t[1]}},t[0]),v(e.target.parentNode.querySelector(".on"),"on"),p(e.target,"on")}),l.playerUnit.querySelector(".BiliPlus-Scale-Menu .Video-Scale")[o]("click",function(e){if(!e.target.hasAttribute("changeto"))return!1;switch(e.target.getAttribute("changeto")){case"default":f(l.video,"scale")&&v(l.video,"scale"),l.video.style.width="",l.video.style.height="",l.video.style.paddingTop="",l.video.style.paddingLeft="";break;case"16_9":p(l.video,"scale");var t=l.videoDiv.offsetWidth,i=l.videoDiv.offsetHeight,o="",n="";i/9*16>t?(o=(i-t/16*9)/2+"px",i=t/16*9/i*100+"%",t="100%"):(n=(t-i/9*16)/2+"px",t=i/9*16/t*100+"%",i="100%"),l.video.style.width=t,l.video.style.height=i,l.video.style.paddingTop=o,l.video.style.paddingLeft=n;break;case"4_3":p(l.video,"scale");var t=l.videoDiv.offsetWidth,i=l.videoDiv.offsetHeight,o="",n="";i/3*4>t?(o=(i-t/4*3)/2+"px",i=t/4*3/i*100+"%",t="100%"):(n=(t-i/3*4)/2+"px",t=i/3*4/t*100+"%",i="100%"),l.video.style.width=t,l.video.style.height=i,l.video.style.paddingTop=o,l.video.style.paddingLeft=n;break;case"full":p(l.video,"scale"),l.video.style.width="",l.video.style.height="",l.video.style.paddingTop="",l.video.style.paddingLeft=""}v(e.target.parentNode.querySelector(".on"),"on"),p(e.target,"on")});var xe=0,ke=function(e){var t=Date.now();500>=t-xe?l.btnFull.click():w.paused&&l.btnPlay.click(),xe=t,e.preventDefault()};l.videoDiv[o]("click",ke),l.playerUnit.querySelector(".ABP-Bottom-Extend")[o]("click",function(e){e.preventDefault(),e.stopPropagation(),ke(e)});var Se=null;l.videoDiv[o]("mousemove",function(){Se&&window.clearTimeout(Se),f(l.videoDiv,"ABP-HideCursor")&&v(l.videoDiv,"ABP-HideCursor"),Se=window.setTimeout(function(){p(l.videoDiv,"ABP-HideCursor")},3e3)}),l.btnVolume[o]("click",function(){0==l.video.muted?(l.video.muted=!0,this.className="button ABP-Volume icon-volume-mute2",this.tooltip(ABP.Strings.unmute),l.barVolume.style.width="0%"):(l.video.muted=!1,this.className="button ABP-Volume icon-volume-",this.className+=l.video.volume<.1?"mute":l.video.volume<.33?"low":l.video.volume<.67?"medium":"high",this.tooltip(ABP.Strings.mute),l.barVolume.style.width=100*l.video.volume+"%")}),l.btnWebFull[o]("click",function(){l.state.fullscreen=f(n,"ABP-FullScreen"),p(n,"ABP-FullScreen"),unsafeWindow&&unsafeWindow.player_fullwin&&unsafeWindow.player_fullwin(!0),l.btnFull.className="button ABP-FullScreen icon-screen-normal",l.btnFull.tooltip(ABP.Strings.exitWebFull),l.state.fullscreen=!0,l.cmManager&&l.cmManager.setBounds(),l.state.allowRescale&&(l.state.fullscreen?l.defaults.w>0&&(l.cmManager.options.scrollScale=n.offsetWidth/l.defaults.w):l.cmManager.options.scrollScale=1)});var Ce=!1,_e=!1;l.btnFont[o]("click",function(){_e&&l.btnColor.click(),this.parentNode.classList.toggle("on"),Ce=!Ce}),l.btnColor[o]("click",function(){Ce&&l.btnFont.click(),this.parentNode.classList.toggle("on"),_e=!_e}),l.proportionalScale&&l.btnProp.classList.add("on"),l.btnProp[o]("click",function(){this.classList.toggle("on"),l.proportionalScale=this.classList.contains("on"),l.cmManager.setBounds(),ze()});var Pe=function(){!document.isFullScreen()&&f(n,"ABP-FullScreen")&&(v(n,"ABP-FullScreen"),l.btnFull.className="button ABP-FullScreen icon-screen-full",l.btnFull.tooltip(ABP.Strings.fullScreen),l.state.fullscreen=!!document.isFullScreen())};document[o]("fullscreenchange",Pe,!1),document[o]("webkitfullscreenchange",Pe,!1),document[o]("mozfullscreenchange",Pe,!1),document[o]("MSFullscreenChange",Pe,!1),l.btnFull[o]("click",function(){l.state.fullscreen=f(n,"ABP-FullScreen"),l.state.fullscreen?(v(n,"ABP-FullScreen"),unsafeWindow&&unsafeWindow.player_fullwin&&unsafeWindow.player_fullwin(!1),this.className="button ABP-FullScreen icon-screen-full",this.tooltip(ABP.Strings.fullScreen),document.exitFullscreen()):(p(n,"ABP-FullScreen"),this.className="button ABP-FullScreen icon-screen-normal",this.tooltip(ABP.Strings.exitFullScreen),n.requestFullScreen()),l.state.fullscreen=!l.state.fullscreen,l.cmManager&&l.cmManager.setBounds(),l.state.allowRescale&&(l.state.fullscreen?l.defaults.w>0&&(l.cmManager.options.scrollScale=n.offsetWidth/l.defaults.w):l.cmManager.options.scrollScale=1)}),l.btnWide[o]("click",function(){l.state.widescreen=f(n,"ABP-WideScreen"),l.state.widescreen?(v(n,"ABP-WideScreen"),this.className="button ABP-WideScreen icon-tv",n.dispatchEvent(new Event("normal")),this.tooltip(ABP.Strings.wideScreen)):(p(n,"ABP-WideScreen"),this.className="button ABP-WideScreen icon-tv on",n.dispatchEvent(new Event("wide")),this.tooltip(ABP.Strings.exitWideScreen)),l.state.widescreen=!l.state.widescreen,l.cmManager&&l.cmManager.setBounds(),l.state.allowRescale&&(l.state.fullscreen?l.defaults.w>0&&(l.cmManager.options.scrollScale=n.offsetWidth/l.defaults.w):l.cmManager.options.scrollScale=1)}),l.btnDm[o]("click",function(){0==l.cmManager.display?(l.cmManager.display=!0,l.cmManager.startTimer(),this.className="button ABP-CommentShow icon-comment on",this.tooltip(ABP.Strings.hideComment)):(l.cmManager.display=!1,l.cmManager.clear(),l.cmManager.stopTimer(),this.className="button ABP-CommentShow icon-comment",this.tooltip(ABP.Strings.showComment)),c.commentVisible()}),l.btnLoop[o]("click",function(){null!=player.flv&&(player.flv.unload(),player.flv.load(),l.video.currentTime=0,l.video.play())});var Be=l.playerUnit.querySelector(".Context-Menu"),Ae=Be.querySelector(".Context-Menu-Background"),Ne=Be.querySelector(".Context-Menu-Body"),Me=function(e){return We?(e.preventDefault(),e.stopPropagation(),We=!1,!1):(Be.style.display="none",void e.preventDefault())},Te=function(e){for(var t=0,i=-1,t=0,o=l.commentObjArray.length;o>t;t++)if(l.commentObjArray[t].data.originalData.dbid==e){i=t;break}-1!=i&&(l.state.fullscreen&&l.btnFull.click(),l.state.widescreen&&l.btnWide.click(),l.commentListContainer.parentNode.scrollTop=24*i)},Le=null,He=null,Fe=0,Ee=null,De={},Oe=function(){if(0!=Fe){if(void 0!=De[Fe])return void Ne.dispatchEvent(new CustomEvent("senderInfoFetched",{detail:De[Fe]}));var e=s("script",{className:"info_jsonp",src:"//account.bilibili.com/api/member/getCardByMid?type=jsonp&callback=getSenderInfo&mid="+Fe});document.body.appendChild(e)}},Ie=function(e,n,a){Be.style.display="block";var r,c,d,m,u,h=Ne.querySelectorAll(".dm"),p=l.playerUnit.getBoundingClientRect();for(x=h.length-1;x>=0;x--)Ne.removeChild(h[x]);for(r=Ne.firstChild,x=0;x<a.length;x++){if(c=a[x].originalData,d=c.color.toString(16).padStart(6,"0"),m=16777215==c.color,u=s("div",{className:"dm"},[s("div",{className:"content"},[s("text",c.text)]),s("div",{className:"dmMenu"},[s("div",{"data-content":c.text},[s("text",ABP.Strings.copyComment)]),s("div",{"data-dmid":c.dbid},[s("text",ABP.Strings.findComment)]),s("div",{onclick:'shield.addText("'+c.text+'")'},[s("text",ABP.Strings.blockContent+"“"+c.text+"”")]),s("div",{"data-mid":crc_engine(c.hash),onclick:'shield.addUser("'+c.hash+'")'},[s("text",ABP.Strings.blockUser+""+c.hash+"(mid:"+crc_engine(c.hash)+")")]),s("div",m?{}:{onclick:'shield.addColor("'+d+'")'},[s("text",m?ABP.Strings.blockColorWhite:ABP.Strings.blockColor+""),s("div",{className:"color",style:{background:"#"+d}})])])]),c.mode>6){u.childNodes[0].innerHTML="特殊弹幕";var f=u.childNodes[1];f.childNodes[0].style.display="none",f.childNodes[2].style.display="none",f.childNodes[4].style.display="none"}Ne.insertBefore(u,r)}var v=Ne.querySelectorAll(".dmMenu");for(x=0;x<v.length;x++)v[x].childNodes[0][o]("click",function(){try{var e=document.createElement("input");e.style.width=0,e.style.height=0,document.body.appendChild(e),e.value=this.getAttribute("data-content"),e.select();var t=document.execCommand("copy");if(document.body.removeChild(e),!t)throw""}catch(e){l.createPopup(ABP.Strings.copyFail,3e3)}}),v[x].childNodes[1][o]("click",function(){Te(this.getAttribute("data-dmid"))}),v[x].childNodes[3][o]("mouseenter",function(){Fe=this.getAttribute("data-mid"),Ee=this,Le=t(Oe,500)}),v[x].childNodes[3][o]("mouseleave",function(){i(Le),Fe=0,Ee=null,null!=document.getElementById("Sender-Info")&&(i(He),He=t(function(){document.body.removeChild(document.getElementById("Sender-Info"))},500))});e-=p.left,n-=p.top,p.width-e<300&&(e=p.width-300),p.height-Ne.offsetHeight-n<0&&(n=p.height-Ne.offsetHeight);var g=Ne.querySelector(".dm:nth-last-of-type(2)>.dmMenu");if(null!=g){g.style.display="block";var y=g.getBoundingClientRect();g.style.display="",p.top+p.height-y.height-n<0&&(n=p.height-y.height)}Ne.style.left=e+"px",Ne.style.top=n+"px"},je=null,We=!1;Ne[o]("senderInfoFetched",function(e){var n=e.detail;if(n.mid==Fe&&null!=Ee){var a=Ee.parentNode.getBoundingClientRect(),l=a.left-150,r=innerHeight-a.bottom,c=s("div",{className:"Context-Menu-Body",id:"Sender-Info",style:{left:l+"px",bottom:r+"px",position:"fixed",fontFamily:"-apple-system,Arial,'PingFang SC','STHeiti Light','Hiragino Kaku Gothic ProN','Microsoft YaHei'",
textAlign:"center"}},[s("div",{},[s("img",{style:{height:"130px",width:"130px"},src:n.face.replace(/http\:/,"")})]),s("div",{},[s("text",n.name)]),s("div",{},[s("text",n.mid)]),s("div",{},[s("text","LV"+n.level_info.current_level)])]);document.body.appendChild(c),r+c.offsetHeight>innerHeight&&(c.style.bottom="",c.style.top=a.top+"px"),c[o]("click",function(){window.open("/space/"+n.mid+"/"),document.body.removeChild(c)}),c[o]("mouseenter",function(){i(He)}),c[o]("mouseleave",function(){i(He),He=t(function(){document.body.removeChild(document.getElementById("Sender-Info"))},500)})}}),window.getSenderInfo=function(e){0==e.code&&(De[Fe]=e.card,Ne.dispatchEvent(new CustomEvent("senderInfoFetched",{detail:e.card})))},Be[o]("click",Me),Ae[o]("contextmenu",Me),l.videoDiv.parentNode[o]("contextmenu",function(e){e.preventDefault(),e.stopPropagation();for(var t,i,o,n=[],a=0,s=l.divComment.childNodes.length;s>a;a++)t=l.divComment.childNodes[a].getBoundingClientRect(),i=e.clientX-t.left,o=e.clientY-t.top,i>=0&&i<=t.width&&o>=0&&o<=t.height&&n.push(l.divComment.childNodes[a]);i=e.clientX,o=e.clientY,Ie(i,o,n)}),l.commentListContainer[o]("contextmenu",function(e){var t=e.target.parentNode.data;return void 0==t?!1:(e.preventDefault(),e.stopPropagation(),void Ie(e.clientX,e.clientY,[t]))}),l.videoDiv.parentNode[o]("touchstart",function(e){if(We=!1,e.touches.length>1&&null!=je)return i(je),void(je=null);for(var o,n,a,s=[],r=0,c=l.divComment.childNodes.length;c>r;r++)o=l.divComment.childNodes[r].getBoundingClientRect(),n=e.touches[0].clientX-o.left,a=e.touches[0].clientY-o.top,n>=0&&n<=o.width&&a>=0&&a<=o.height&&s.push(l.divComment.childNodes[r]);n=e.touches[0].clientX,a=e.touches[0].clientY,je=t(function(){je=null,We=!0,Ie(n,a,s)},300)}),l.videoDiv.parentNode[o]("touchmove",function(){null!=je&&(i(je),je=null)}),l.videoDiv.parentNode[o]("touchend",function(){null!=je&&(i(je),je=null)}),Ne[o]("touchstart",function(e){var t=Ne.getBoundingClientRect();e.touches[0].clientX-t.left<=t.width&&e.touches[0].clientY-t.top<=t.height&&(We=!0)});var ze=function(){l.playerUnit.dispatchEvent(new CustomEvent("saveconfig",{detail:{volume:l.video.volume,opacity:l.cmManager.options.global.opacity,scale:l.commentScale,prop:l.proportionalScale}}))},Re=function(){var e=new Date,i=""+e.getTime()+Math.random();return""==l.txtText.value||l.txtText.disabled?!1:(l.playerUnit.dispatchEvent(new CustomEvent("sendcomment",{detail:{id:i,message:l.txtText.value,fontsize:l.commentFontSize,color:parseInt("0x"+l.commentColor),date:e.getFullYear()+"-"+r(e.getMonth())+"-"+r(e.getDay())+" "+r(e.getHours())+":"+r(e.getMinutes())+":"+r(e.getSeconds()),playTime:l.video.currentTime,mode:l.commentMode,pool:0}})),l.cmManager.send({text:l.txtText.value,mode:l.commentMode,stime:l.video.currentTime,size:l.commentFontSize,color:parseInt("0x"+l.commentColor),border:!0}),l.commentList[i]={date:parseInt(e.getTime()/1e3),time:1e3*l.video.currentTime,mode:l.commentMode,user:"-",pool:0,content:l.txtText.value},l.txtText.value="",l.txtText.disabled=!0,void t(function(){l.txtText.disabled=!1},l.commentCoolDown))};l.txtText.parentNode[o]("submit",function(e){return e.preventDefault(),Re(),!1}),l.btnSend[o]("click",Re),l.timeLabel[o]("click",function(){l.timeJump=s("input",{className:"time-jump"}),l.timeJump.value=m(l.video.currentTime),l.controlBar.appendChild(l.timeJump),l.timeJump[o]("blur",function(){l.timeJump&&l.timeJump.parentNode.removeChild(l.timeJump),l.timeJump=null}),l.timeJump[o]("keydown",function(e){if(13==e.keyCode){var t=u(l.timeJump.value);t&&t<=l.video.duration&&(l.video.currentTime=t,l.video.paused&&l.btnPlay.click()),l.timeJump.parentNode.removeChild(l.timeJump)}else(e.keyCode<48||e.keyCode>59)&&(e.keyCode<96||e.keyCode>105)&&8!=e.keyCode&&16!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&46!=e.keyCode&&e.preventDefault()}),l.timeJump.focus(),l.timeJump.select()}),l.barTime.style.width="0%",l.barFullScreenTime.style.width="0%";var Ve=!1;l.barTimeHitArea[o]("mousedown",function(){Ve=!0}),document[o]("mouseup",function(e){if(Ve){var t=b(l.video),i=t.end-t.start,o=(e.clientX-l.barTimeHitArea.getBoundingClientRect().left)/l.barTimeHitArea.offsetWidth*i;o+=t.start,0>o&&(o=0),Math.abs(o-l.video.currentTime)>4&&l.cmManager&&l.cmManager.clear(),l.video.currentTime=o}Ve=!1});var qe=function(e){var t=b(l.video),i=t.end-t.start,e=e-t.start;l.barTime.style.width=e/i*100+"%",l.barFullScreenTime.style.width=e/i*100+"%",l.timeLabel.innerHTML=m(e)+"/"+m(i)};document[o]("mousemove",function(e){var t=b(l.video),i=t.end,o=(e.clientX-l.barTimeHitArea.getBoundingClientRect().left)/l.barTimeHitArea.offsetWidth*i;0>o&&(o=0),o>i&&(o=i),l.barTimeHitArea.tooltip(m(o)),Ve&&qe(o)}),h(l.barTimeHitArea,!0,-12);var Xe=!1;l.barVolumeHitArea[o]("mousedown",function(){Xe=!0}),l.barVolume.style.width=100*l.video.volume+"%";var Ue=function(e){l.barVolume.style.width=100*e+"%",l.video.muted=!1,l.btnVolume.className="button ABP-Volume icon-volume-",l.btnVolume.className+=.1>e?"mute":.33>e?"low":.67>e?"medium":"high",l.btnVolume.tooltip(ABP.Strings.mute),l.barVolumeHitArea.tooltip(parseInt(100*e)+"%"),ze()};document[o]("mouseup",function(e){if(Xe){var t=(e.clientX-l.barVolumeHitArea.getBoundingClientRect().left)/l.barVolumeHitArea.offsetWidth;0>t&&(t=0),t>1&&(t=1),l.video.volume=t,Ue(l.video.volume)}Xe=!1}),document[o]("mousemove",function(e){var t=(e.clientX-l.barVolumeHitArea.getBoundingClientRect().left)/l.barVolumeHitArea.offsetWidth;0>t&&(t=0),t>1&&(t=1),Xe?(l.video.volume=t,Ue(l.video.volume)):l.barVolumeHitArea.tooltip(parseInt(100*t)+"%")}),h(l.barVolumeHitArea,!0,-12);var Ye=!1;l.barOpacityHitArea[o]("mousedown",function(){Ye=!0}),l.barOpacity.style.width=100*l.cmManager.options.global.opacity+"%";var Je=function(e){l.barOpacity.style.width=100*e+"%",l.barOpacityHitArea.tooltip(parseInt(100*e)+"%"),ze()};document[o]("mouseup",function(e){if(Ye){var t=(e.clientX-l.barOpacityHitArea.getBoundingClientRect().left)/l.barOpacityHitArea.offsetWidth;0>t&&(t=0),t>1&&(t=1),l.cmManager.options.global.opacity=t,Je(l.cmManager.options.global.opacity),c.opacity()}Ye=!1}),document[o]("mousemove",function(e){var t=(e.clientX-l.barOpacityHitArea.getBoundingClientRect().left)/l.barOpacityHitArea.offsetWidth;0>t&&(t=0),t>1&&(t=1),Ye?(l.cmManager.options.global.opacity=t,Je(l.cmManager.options.global.opacity)):l.barOpacityHitArea.tooltip(parseInt(100*t)+"%")}),h(l.barOpacityHitArea,!0,-6);var Qe=!1;l.barScaleHitArea[o]("mousedown",function(){Qe=!0}),l.barScale.style.width=(l.commentScale-.2)/1.8*100+"%";var Ge=function(e){l.barScale.style.width=(e-.2)/1.8*100+"%",l.barScaleHitArea.tooltip(parseInt(100*e)+"%"),l.cmManager.setBounds(),ze()};document[o]("mouseup",function(e){if(Qe){var t=.2+1.8*(e.clientX-l.barScaleHitArea.getBoundingClientRect().left)/l.barScaleHitArea.offsetWidth;.2>t&&(t=.2),t>2&&(t=2),l.commentScale=t,Ge(l.commentScale),c.scale()}Qe=!1}),document[o]("mousemove",function(e){var t=.2+1.8*(e.clientX-l.barScaleHitArea.getBoundingClientRect().left)/l.barScaleHitArea.offsetWidth;.2>t&&(t=.2),t>2&&(t=2),Qe?(l.commentScale=t,Ge(l.commentScale)):l.barScaleHitArea.tooltip(parseInt(100*t)+"%")}),h(l.barScaleHitArea,!0,-6);var Ze=!1;l.barSpeedHitArea[o]("mousedown",function(){Ze=!0}),l.barSpeed.style.width=(l.commentSpeed-.5)/1.5*100+"%";var Ke=function(e){l.barSpeed.style.width=(e-.5)/1.5*100+"%",l.barSpeedHitArea.tooltip(parseInt(100*e)+"%"),l.cmManager.setBounds(),ze()};document[o]("mouseup",function(e){if(Ze){var t=.5+1.5*(e.clientX-l.barSpeedHitArea.getBoundingClientRect().left)/l.barSpeedHitArea.offsetWidth;.5>t&&(t=.5),t>2&&(t=2),l.commentSpeed=t,Ke(l.commentSpeed),c.speed()}Ze=!1}),document[o]("mousemove",function(e){var t=.5+1.5*(e.clientX-l.barSpeedHitArea.getBoundingClientRect().left)/l.barSpeedHitArea.offsetWidth;.5>t&&(t=.5),t>2&&(t=2),Ze?(l.commentSpeed=t,Ke(l.commentSpeed)):l.barSpeedHitArea.tooltip(parseInt(100*t)+"%")}),h(l.barSpeedHitArea,!0,-6),l.btnPlay[o]("click",function(){l.video.paused?(l.video.play(),this.className="button ABP-Play ABP-Pause icon-pause",this.tooltip(ABP.Strings.pause)):(l.video.pause(),this.className="button ABP-Play icon-play",this.tooltip(ABP.Strings.play))}),n[o]("keydown",function(e){if(e&&"INPUT"!=document.activeElement.tagName)switch(-1!=[27,32,37,38,39,40].indexOf(e.keyCode)&&e.preventDefault(),e.keyCode){case 27:abpinst.state.fullscreen&&abpinst.btnFull.click();break;case 32:l.btnPlay.click();break;case 37:var t=l.video.currentTime-=5*l.video.playbackRate;l.cmManager.clear(),t<b(l.video).start&&(t=b(l.video).start),l.video.currentTime=t.toFixed(3),l.video.paused&&l.btnPlay.click(),qe(w.currentTime),l.barTimeHitArea.tooltip(m(w.currentTime));break;case 39:var t=l.video.currentTime+=5*l.video.playbackRate;l.cmManager.clear(),t>b(l.video).end&&(t=b(l.video).end-1),l.video.currentTime=t.toFixed(3),l.video.paused&&l.btnPlay.click(),qe(w.currentTime),l.barTimeHitArea.tooltip(m(w.currentTime));break;case 38:var i=l.video.volume+.1;i>1&&(i=1),l.video.volume=i.toFixed(3),Ue(l.video.volume);break;case 40:var i=l.video.volume-.1;0>i&&(i=0),l.video.volume=i.toFixed(3),Ue(l.video.volume)}}),n[o]("touchmove",function(){event.preventDefault()});var $e=null;n[o]("touchstart",function(e){f(l.videoDiv,"ABP-HideCursor")&&v(l.videoDiv,"ABP-HideCursor"),e.targetTouches.length>0&&($e=e.targetTouches[0])}),n[o]("touchend",function(e){if(p(l.videoDiv,"ABP-HideCursor"),e.changedTouches.length>0&&null!=$e){var t=e.changedTouches[0].pageX-$e.pageX,i=e.changedTouches[0].pageY-$e.pageY;if(Math.abs(t)<20&&Math.abs(i)<20)return void($e=null);Math.abs(t)>3*Math.abs(i)?t>0?l.video.paused&&l.btnPlay.click():l.video.paused||l.btnPlay.click():Math.abs(i)>3*Math.abs(t)&&(l.video.volume=0>i?Math.min(1,l.video.volume+.1):Math.max(0,l.video.volume-.1)),$e=null}}),n[o]("mouseup",function(){if("INPUT"!=document.activeElement.tagName){var e=window.scrollY;l.videoDiv.focus(),window.scrollTo(window.scrollX,e)}})}if("undefined"!=typeof CommentManager&&l.state.autosize){var et=function(){if(0!==w.videoHeight&&0!==w.videoWidth){var e=w.videoHeight/w.videoWidth,t=n.offsetWidth,i=n.offsetHeight,o=i/t;e>o?(n.style.width=i/e+"px",n.style.height=i+"px"):(n.style.width=t+"px",n.style.height=t*e+"px"),l.cmManager.setBounds()}};w[o]("loadedmetadata",et),et()}return shield.init(l),shield.shield(),dots.init({id:"dots",width:"100%",height:"100%",r:16,thick:4}),l}}}}}}}}}}}}}}}}}}}}}}}}}}}(),function(e){var t=function(){var t='<div class="colpick"><div class="colpick_color"><div class="colpick_color_overlay1"><div class="colpick_color_overlay2"><div class="colpick_selector_outer"><div class="colpick_selector_inner"></div></div></div></div></div><div class="colpick_hue"><div class="colpick_hue_arrs"><div class="colpick_hue_larr"></div><div class="colpick_hue_rarr"></div></div></div><div class="colpick_new_color"></div><div class="colpick_current_color"></div><div class="colpick_hex_field"><div class="colpick_field_letter">#</div><input type="text" maxlength="6" size="6" /></div><div class="colpick_rgb_r colpick_field"><div class="colpick_field_letter">R</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_g colpick_field"><div class="colpick_field_letter">G</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_h colpick_field"><div class="colpick_field_letter">H</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_s colpick_field"><div class="colpick_field_letter">S</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_submit"></div></div>',i={showEvent:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},colorScheme:"light",color:"3289c7",livePreview:!0,flat:!1,layout:"full",submit:1,submitText:"OK",height:156},s=function(t,i){var o=a(t);e(i).data("colpick").fields.eq(1).val(o.r).end().eq(2).val(o.g).end().eq(3).val(o.b).end()},r=function(t,i){e(i).data("colpick").fields.eq(4).val(Math.round(t.h)).end().eq(5).val(Math.round(t.s)).end().eq(6).val(Math.round(t.b)).end()},c=function(t,i){e(i).data("colpick").fields.eq(0).val(l(t))},d=function(t,i){e(i).data("colpick").selector.css("backgroundColor","#"+l({h:t.h,s:100,b:100})),e(i).data("colpick").selectorIndic.css({left:parseInt(e(i).data("colpick").height*t.s/100,10),top:parseInt(e(i).data("colpick").height*(100-t.b)/100,10)})},m=function(t,i){e(i).data("colpick").hue.css("top",parseInt(e(i).data("colpick").height-e(i).data("colpick").height*t.h/360,10))},u=function(t,i){e(i).data("colpick").currentColor.css("backgroundColor","#"+l(t))},h=function(t,i){e(i).data("colpick").newColor.css("backgroundColor","#"+l(t))},p=function(){var t,i=e(this).parent().parent();this.parentNode.className.indexOf("_hex")>0?(i.data("colpick").color=t=o(L(this.value)),s(t,i.get(0)),r(t,i.get(0))):this.parentNode.className.indexOf("_hsb")>0?(i.data("colpick").color=t=M({h:parseInt(i.data("colpick").fields.eq(4).val(),10),s:parseInt(i.data("colpick").fields.eq(5).val(),10),b:parseInt(i.data("colpick").fields.eq(6).val(),10)}),s(t,i.get(0)),c(t,i.get(0))):(i.data("colpick").color=t=n(T({r:parseInt(i.data("colpick").fields.eq(1).val(),10),g:parseInt(i.data("colpick").fields.eq(2).val(),10),b:parseInt(i.data("colpick").fields.eq(3).val(),10)})),c(t,i.get(0)),r(t,i.get(0))),d(t,i.get(0)),m(t,i.get(0)),h(t,i.get(0)),i.data("colpick").onChange.apply(i.parent(),[t,l(t),a(t),i.data("colpick").el,0])},f=function(){e(this).parent().removeClass("colpick_focus")},v=function(){e(this).parent().parent().data("colpick").fields.parent().removeClass("colpick_focus"),e(this).parent().addClass("colpick_focus")},g=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var i=e(this).parent().find("input").focus(),o={el:e(this).parent().addClass("colpick_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:i,val:parseInt(i.val(),10),preview:e(this).parent().parent().data("colpick").livePreview};e(document).mouseup(o,b),e(document).mousemove(o,y)},y=function(e){return e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val-e.pageY+e.data.y,10)))),e.data.preview&&p.apply(e.data.field.get(0),[!0]),!1},b=function(t){return p.apply(t.data.field.get(0),[!0]),t.data.el.removeClass("colpick_slider").find("input").focus(),e(document).off("mouseup",b),e(document).off("mousemove",y),!1},w=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var i={cal:e(this).parent(),y:e(this).offset().top};e(document).on("mouseup touchend",i,k),e(document).on("mousemove touchmove",i,x);var o="touchstart"==t.type?t.originalEvent.changedTouches[0].pageY:t.pageY;return p.apply(i.cal.data("colpick").fields.eq(4).val(parseInt(360*(i.cal.data("colpick").height-(o-i.y))/i.cal.data("colpick").height,10)).get(0),[i.cal.data("colpick").livePreview]),!1},x=function(e){var t="touchmove"==e.type?e.originalEvent.changedTouches[0].pageY:e.pageY;return p.apply(e.data.cal.data("colpick").fields.eq(4).val(parseInt(360*(e.data.cal.data("colpick").height-Math.max(0,Math.min(e.data.cal.data("colpick").height,t-e.data.y)))/e.data.cal.data("colpick").height,10)).get(0),[e.data.preview]),!1},k=function(t){return s(t.data.cal.data("colpick").color,t.data.cal.get(0)),c(t.data.cal.data("colpick").color,t.data.cal.get(0)),e(document).off("mouseup touchend",k),e(document).off("mousemove touchmove",x),!1},S=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var i={cal:e(this).parent(),pos:e(this).offset()};i.preview=i.cal.data("colpick").livePreview,e(document).on("mouseup touchend",i,_),e(document).on("mousemove touchmove",i,C);var o;return"touchstart"==t.type?(pageX=t.originalEvent.changedTouches[0].pageX,o=t.originalEvent.changedTouches[0].pageY):(pageX=t.pageX,o=t.pageY),p.apply(i.cal.data("colpick").fields.eq(6).val(parseInt(100*(i.cal.data("colpick").height-(o-i.pos.top))/i.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*(pageX-i.pos.left)/i.cal.data("colpick").height,10)).get(0),[i.preview]),!1},C=function(e){var t;return"touchmove"==e.type?(pageX=e.originalEvent.changedTouches[0].pageX,t=e.originalEvent.changedTouches[0].pageY):(pageX=e.pageX,t=e.pageY),p.apply(e.data.cal.data("colpick").fields.eq(6).val(parseInt(100*(e.data.cal.data("colpick").height-Math.max(0,Math.min(e.data.cal.data("colpick").height,t-e.data.pos.top)))/e.data.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(e.data.cal.data("colpick").height,pageX-e.data.pos.left))/e.data.cal.data("colpick").height,10)).get(0),[e.data.preview]),!1},_=function(t){return s(t.data.cal.data("colpick").color,t.data.cal.get(0)),c(t.data.cal.data("colpick").color,t.data.cal.get(0)),e(document).off("mouseup touchend",_),e(document).off("mousemove touchmove",C),!1},P=function(){var t=e(this).parent(),i=t.data("colpick").color;t.data("colpick").origColor=i,u(i,t.get(0)),t.data("colpick").onSubmit(i,l(i),a(i),t.data("colpick").el)},B=function(t){t.stopPropagation();var i=e("#"+e(this).data("colpickId"));i.data("colpick").onBeforeShow.apply(this,[i.get(0)]);var o=e(this).offset(),n=o.top+this.offsetHeight,a=o.left,s=N(),l=i.width();a+l>s.l+s.w&&(a-=l),i.css({left:a+"px",top:n+"px"}),0!=i.data("colpick").onShow.apply(this,[i.get(0)])&&i.show(),e("html").mousedown({cal:i},A),i.mousedown(function(e){e.stopPropagation()})},A=function(t){0!=t.data.cal.data("colpick").onHide.apply(this,[t.data.cal.get(0)])&&t.data.cal.hide(),e("html").off("mousedown",A)},N=function(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth)}},M=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},T=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},L=function(e){var t=6-e.length;if(t>0){for(var i=[],o=0;t>o;o++)i.push("0");i.push(e),e=i.join("")}return e},H=function(){var t=e(this).parent(),i=t.data("colpick").origColor;t.data("colpick").color=i,s(i,t.get(0)),c(i,t.get(0)),r(i,t.get(0)),d(i,t.get(0)),m(i,t.get(0)),h(i,t.get(0))};return{init:function(a){if(a=e.extend({},i,a||{}),"string"==typeof a.color)a.color=o(a.color);else if(void 0!=a.color.r&&void 0!=a.color.g&&void 0!=a.color.b)a.color=n(a.color);else{if(void 0==a.color.h||void 0==a.color.s||void 0==a.color.b)return this;a.color=M(a.color)}return this.each(function(){if(!e(this).data("colpickId")){var i=e.extend({},a);i.origColor=a.color;var o="collorpicker_"+parseInt(1e3*Math.random());e(this).data("colpickId",o);var n=e(t).attr("id",o);n.addClass("colpick_"+i.layout+(i.submit?"":" colpick_"+i.layout+"_ns")),"light"!=i.colorScheme&&n.addClass("colpick_"+i.colorScheme),n.find("div.colpick_submit").html(i.submitText).click(P),i.fields=n.find("input").change(p).blur(f).focus(v),n.find("div.colpick_field_arrs").mousedown(g).end().find("div.colpick_current_color").click(H),i.selector=n.find("div.colpick_color").on("mousedown touchstart",S),i.selectorIndic=i.selector.find("div.colpick_selector_outer"),i.el=this,i.hue=n.find("div.colpick_hue_arrs"),huebar=i.hue.parent();var l=navigator.userAgent.toLowerCase(),y="Microsoft Internet Explorer"===navigator.appName,b=y?parseFloat(l.match(/msie ([0-9]{1,}[\.0-9]{0,})/)[1]):0,x=y&&10>b,k=["#ff0000","#ff0080","#ff00ff","#8000ff","#0000ff","#0080ff","#00ffff","#00ff80","#00ff00","#80ff00","#ffff00","#ff8000","#ff0000"];if(x){var C,_;for(C=0;11>=C;C++)_=e("<div></div>").attr("style","height:8.333333%; filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr="+k[C]+", endColorstr="+k[C+1]+'); -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+k[C]+", endColorstr="+k[C+1]+')";'),huebar.append(_)}else stopList=k.join(","),huebar.attr("style","background:-webkit-linear-gradient(top,"+stopList+"); background: -o-linear-gradient(top,"+stopList+"); background: -ms-linear-gradient(top,"+stopList+"); background:-moz-linear-gradient(top,"+stopList+"); -webkit-linear-gradient(top,"+stopList+"); background:linear-gradient(to bottom,"+stopList+"); ");n.find("div.colpick_hue").on("mousedown touchstart",w),i.newColor=n.find("div.colpick_new_color"),i.currentColor=n.find("div.colpick_current_color"),n.data("colpick",i),s(i.color,n.get(0)),r(i.color,n.get(0)),c(i.color,n.get(0)),m(i.color,n.get(0)),d(i.color,n.get(0)),u(i.color,n.get(0)),h(i.color,n.get(0)),i.flat?(n.appendTo(this).show(),n.css({position:"relative",display:"block"})):(n.appendTo(document.body),e(this).on(i.showEvent,B),n.css({position:"absolute"}))}})},showPicker:function(){return this.each(function(){e(this).data("colpickId")&&B.apply(this)})},hidePicker:function(){return this.each(function(){e(this).data("colpickId")&&e("#"+e(this).data("colpickId")).hide()})},setColor:function(t,i){if(i="undefined"==typeof i?1:i,"string"==typeof t)t=o(t);else if(void 0!=t.r&&void 0!=t.g&&void 0!=t.b)t=n(t);else{if(void 0==t.h||void 0==t.s||void 0==t.b)return this;t=M(t)}return this.each(function(){if(e(this).data("colpickId")){var o=e("#"+e(this).data("colpickId"));o.data("colpick").color=t,o.data("colpick").origColor=t,s(t,o.get(0)),r(t,o.get(0)),c(t,o.get(0)),m(t,o.get(0)),d(t,o.get(0)),h(t,o.get(0)),o.data("colpick").onChange.apply(o.parent(),[t,l(t),a(t),o.data("colpick").el,1]),i&&u(t,o.get(0))}})}}}(),i=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(65280&e)>>8,b:255&e}},o=function(e){return n(i(e))},n=function(e){var t={h:0,s:0,b:0},i=Math.min(e.r,e.g,e.b),o=Math.max(e.r,e.g,e.b),n=o-i;return t.b=o,t.s=0!=o?255*n/o:0,t.h=0!=t.s?e.r==o?(e.g-e.b)/n:e.g==o?2+(e.b-e.r)/n:4+(e.r-e.g)/n:-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},a=function(e){var t={},i=e.h,o=255*e.s/100,n=255*e.b/100;if(0==o)t.r=t.g=t.b=n;else{var a=n,s=(255-o)*n/255,l=(a-s)*(i%60)/60;360==i&&(i=0),60>i?(t.r=a,t.b=s,t.g=s+l):120>i?(t.g=a,t.b=s,t.r=a-l):180>i?(t.g=a,t.r=s,t.b=s+l):240>i?(t.b=a,t.r=s,t.g=a-l):300>i?(t.b=a,t.g=s,t.r=s+l):360>i?(t.r=a,t.g=s,t.b=a-l):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},s=function(t){var i=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return e.each(i,function(e,t){1==t.length&&(i[e]="0"+t)}),i.join("")},l=function(e){return s(a(e))};e.fn.extend({colpick:t.init,colpickHide:t.hidePicker,colpickShow:t.showPicker,colpickSetColor:t.setColor}),e.extend({colpick:{rgbToHex:s,rgbToHsb:n,hsbToHex:l,hsbToRgb:a,hexToHsb:o,hexToRgb:i}})}(jQuery);/*end*/