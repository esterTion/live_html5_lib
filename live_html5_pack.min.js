function CommentFilter(){this.modifiers=[],this.runtime=null,this.allowTypes={1:!0,4:!0,5:!0,6:!0,7:!0,8:!0,17:!0},this.doModify=function(t){for(var e=0;e<this.modifiers.length;e++)t=this.modifiers[e](t);return t},this.beforeSend=function(t){return t},this.doValidate=function(t){return!!this.allowTypes[t.mode]},this.addRule=function(t){},this.addModifier=function(t){this.modifiers.push(t)},this.runtimeFilter=function(t){return null==this.runtime?t:this.runtime(t)},this.setRuntimeFilter=function(t){this.runtime=t}}function isMobile(){var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t}var shield=function(){var t,e=!0,i=1,n=null,o=0,s=!1,a=[],l=function(t){return document.querySelectorAll(t)},r=function(t){return document.querySelector(t)},d=null,c={init:function(i){if(e){void 0!=i&&(d=i),e=!1,shield.tab(0),void 0==localStorage.shieldList&&(localStorage.shieldList='{"text":[],"user":[],"color":[],"useReg":false}'),n=JSON.parse(localStorage.shieldList),void 0==n.color&&(n.color=[]),void 0==n.useReg&&(n.useReg=!1),s=n.useReg,t=n.limit,c.render();var a,m,h;for(h=l(".shield_tab"),a=0,m=h.length;a<m;a++)h[a].tabNum=a,h[a].addEventListener("mouseenter",function(){c.tab(this.tabNum)}),h[a].addEventListener("mouseleave",function(t){var e=this.getBoundingClientRect(),i=t.clientX,n=t.clientY;(i-e.left<0||i-e.left>e.width||n-e.top<0||n-e.top>e.height)&&c.tab(o)}),h[a].addEventListener("click",function(){c.switchTab(this.tabNum)});r(".shield-enrty").addEventListener("click",shield.show),r(".shield .close").addEventListener("click",shield.show),r(".shield .add").addEventListener("click",shield.add),r("#useReg").addEventListener("click",function(){s=!s,c.save(),c.render(3)})}},switchTab:function(t){o=t,r(".shield_body_wrapper").style.transform="translateX("+t*-278+"px)",r(".shield_body_wrapper").style.webkitTransform="translateX("+t*-278+"px)"},tab:function(t){var e=r(".shield"),i=e.getBoundingClientRect(),n=r(".shield .shield_tab:nth-of-type("+(t+1)+")>div").getBoundingClientRect(),o=n.left-i.left,s=n.width,a=r(".shield .shield_tab_slash");a.style.left=o+"px",a.style.width=s+"px"},render:function(t){var e=!0,i=0;for(void 0!=t&&(e=!1,i=t);;){switch(i){case 0:var o,a,d,m="";for(o=0,a=n.text.length;o<a;o++)m+='<div class="shield_item"><div class="text">'+n.text[o]+'</div><div class="delete"></div></div>';for(r("#shield_text").innerHTML=m,d=l("#shield_text .shield_item .delete"),o=0,a=d.length;o<a;o++)d[o].onclick=c.del;break;case 1:for(var d,m="",o=0;o<n.user.length;o++)m+='<div class="shield_item"><div class="text">'+n.user[o]+" mid "+crc_engine(n.user[o])+'</div><div class="delete"></div></div>';for(0==o&&(m='<div class="shield_item">'+ABP.Strings.blockUserEmpty+"</div>"),r("#shield_user").innerHTML=m,d=l("#shield_user .shield_item .delete"),o=0,a=d.length;o<a;o++)d[o].onclick=c.delUser;break;case 2:for(var h,d,m="",o=0;o<n.color.length;o++){for(h=n.color[o].toString(16);h.length<6;)h="0"+h;m+='<div class="shield_color"><div class="color" style="background:#'+h+'">'+n.color[o]+'</div><div class="delete"></div></div>'}for(0==o&&(m='<div class="shield_color">'+ABP.Strings.blockColorEmpty+"</div>"),r("#shield_color").innerHTML=m,d=l("#shield_color .shield_color .delete"),o=0,a=d.length;o<a;o++)d[o].onclick=c.delColor;break;case 3:r("#useReg").className="shield_toggle"+(s?" on":"");break;default:return}i++}},save:function(){n.useReg=s,n.limit=t,localStorage.shieldList=JSON.stringify(n),c.shield()},show:function(){i?l(".shield")[0].setAttribute("class","shield"):l(".shield")[0].setAttribute("class","shield hidden"),i^=1},add:function(){c.addText(r(".shield_item .new").value),r(".shield_item .new").value=""},addText:function(t){return""!=t&&n.text.indexOf(t)==-1&&(n.text.push(t),c.save(),void c.render(0))},addUser:function(t){return n.user.indexOf(t)==-1&&(n.user.push(t),c.save(),void c.render(1))},addColor:function(t){return t=parseInt(t,16),!isNaN(t)&&n.color.indexOf(t)==-1&&(n.color.push(t),c.save(),void c.render(2))},del:function(t){var e,i=t.target.parentNode.childNodes[0].innerHTML,o=n.text.indexOf(i);return o!=-1&&(e=n.text.splice(0,o),n.text=e.concat(n.text.splice(1)),c.save(),void c.render(0))},delUser:function(t){var e,i=t.target.parentNode.childNodes[0].innerHTML.split(" ")[0],o=n.user.indexOf(i);return o!=-1&&(e=n.user.splice(0,o),n.user=e.concat(n.user.splice(1)),c.save(),void c.render(1))},delColor:function(t){var e,i=t.target.parentNode.childNodes[0].innerHTML,o=n.color.indexOf(1*i);return o!=-1&&(e=n.color.splice(0,o),n.color=e.concat(n.color.splice(1)),c.save(),void c.render(2))},filterChk:function(t){var e;if(n.color.indexOf(t.color)!=-1||n.user.indexOf(t.hash)!=-1)return!1;for(e=0;e<a.length;e++)try{if(null!=t.text.match(a[e]))return!1}catch(t){}return!0},filter:function(t){return!!shield.filterChk(t)&&(t.filtered||(t.oriSize=t.size,t.filtered=!0),t.size=t.oriSize*abpinst.commentScale,t)},shield:function(){a=[];var t,e,i,o=d.cmManager.runline;for(e=0;e<n.text.length;e++)a.push(s?new RegExp(n.text[e]):n.text[e]);for(t=0;t<o.length;t++)if(i=o[t],n.color.indexOf(i.color)!=-1||n.user.indexOf(i.originalData.hash)!=-1)i.finish(),t--;else for(e=0;e<a.length;e++)if(null!=i.text.match(e)){i.finish(),t--;break}}};return c}();window.shield=shield,unsafeWindow.shield=shield;var BinArray=function(){var t={};return t.bsearch=function(t,e,i){if(0===t.length)return 0;if(i(e,t[0])<0)return 0;if(i(e,t[t.length-1])>=0)return t.length;for(var n=0,o=0,s=0,a=t.length-1;n<=a;){if(o=Math.floor((a+n+1)/2),s++,i(e,t[o-1])>=0&&i(e,t[o])<0)return o;i(e,t[o-1])<0?a=o-1:i(e,t[o])>=0?n=o:console.error("Program Error"),s>1500&&console.error("Too many run cycles.")}return-1},t.binsert=function(e,i,n){var o=t.bsearch(e,i,n);return e.splice(o,0,i),o},t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},CommentSpaceAllocator=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._pools=[[]],this.avoid=1,this._width=t,this._height=e}return t.prototype.willCollide=function(t,e){return t.stime+t.ttl>=e.stime+e.ttl/2},t.prototype.pathCheck=function(t,e,i){for(var n=t+e.height,o=e.right,s=0;s<i.length;s++)if(!(i[s].y>n||i[s].bottom<t)){if(!(i[s].right<e.x||i[s].x>o))return!1;if(this.willCollide(i[s],e))return!1}return!0},t.prototype.assign=function(t,e){for(;this._pools.length<=e;)this._pools.push([]);var i=this._pools[e];if(0===i.length)return t.cindex=e,0;if(this.pathCheck(0,t,i))return t.cindex=e,0;for(var n=0,o=0;o<i.length&&(n=i[o].bottom+this.avoid,!(n+t.height>this._height));o++)if(this.pathCheck(n,t,i))return t.cindex=e,n;return this.assign(t,e+1)},t.prototype.add=function(t){t.height>this._height?(t.cindex=-2,t.y=0):(t.y=this.assign(t,0),BinArray.binsert(this._pools[t.cindex],t,function(t,e){return t.bottom<e.bottom?-1:t.bottom>e.bottom?1:0}))},t.prototype.remove=function(t){if(!(t.cindex<0)){if(t.cindex>=this._pools.length)throw new Error("cindex out of bounds");var e=this._pools[t.cindex].indexOf(t);e<0||this._pools[t.cindex].splice(e,1)}},t.prototype.setBounds=function(t,e){this._width=t,this._height=e},t}(),AnchorCommentSpaceAllocator=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.add=function(e){t.prototype.add.call(this,e),e.x=(this._width-e.width)/2},e.prototype.willCollide=function(t,e){return!0},e.prototype.pathCheck=function(t,e,i){for(var n=t+e.height,o=0;o<i.length;o++)if(!(i[o].y>n||i[o].bottom<t))return!1;return!0},e}(CommentSpaceAllocator),CoreComment=function(){function t(e,i){if(void 0===i&&(i={}),this.mode=1,this.stime=0,this.text="",this.ttl=4e3,this.dur=4e3,this.cindex=-1,this.motion=[],this.movable=!0,this._alphaMotion=null,this.absolute=!0,this.align=0,this._alpha=1,this._size=25,this._color=16777215,this._border=!1,this._shadow=!0,this._font="",!e)throw new Error("Comment not bound to comment manager.");if(this.parent=e,i.hasOwnProperty("stime")&&(this.stime=i.stime),i.hasOwnProperty("mode")?this.mode=i.mode:this.mode=1,i.hasOwnProperty("dur")&&(this.dur=i.dur,this.ttl=this.dur),this.dur*=this.parent.options.global.scale,this.ttl*=this.parent.options.global.scale,4!==this.mode&&5!==this.mode||(this.dur*=.6,this.ttl*=.6),i.hasOwnProperty("text")&&(this.text=i.text),i.hasOwnProperty("motion")){this._motionStart=[],this._motionEnd=[],this.motion=i.motion;for(var n=0,o=0;o<i.motion.length;o++){this._motionStart.push(n);var s=0;for(var a in i.motion[o]){var l=i.motion[o][a];s=Math.max(l.dur,s),null!==l.easing&&void 0!==l.easing||(i.motion[o][a].easing=t.LINEAR)}n+=s,this._motionEnd.push(n)}this._curMotion=0}i.hasOwnProperty("color")&&(this._color=i.color),i.hasOwnProperty("size")&&(this._size=i.size),i.hasOwnProperty("border")&&(this._border=i.border),i.hasOwnProperty("opacity")&&(this._alpha=i.opacity),i.hasOwnProperty("alpha")&&(this._alphaMotion=i.alpha),i.hasOwnProperty("font")&&(this._font=i.font),i.hasOwnProperty("x")&&(this._x=i.x),i.hasOwnProperty("y")&&(this._y=i.y),i.hasOwnProperty("shadow")&&(this._shadow=i.shadow),i.hasOwnProperty("position")&&"relative"===i.position&&(this.absolute=!1,this.mode<7&&console.warn("Using relative position for CSA comment."))}return t.prototype.init=function(t){void 0===t&&(t=null),null!==t?this.dom=t.dom:this.dom=document.createElement("div"),this.dom.className=this.parent.options.global.className,this.dom.appendChild(document.createTextNode(this.text)),this.dom.textContent=this.text,this.dom.innerText=this.text,this.size=this._size,16777215!=this._color&&(this.color=this._color),this.shadow=this._shadow,this._border&&(this.border=this._border),""!==this._font&&(this.font=this._font),void 0!==this._x&&(this.x=this._x),void 0!==this._y&&(this.y=this._y),(1!==this._alpha||this.parent.options.global.opacity<1)&&(this.alpha=this._alpha),this.motion.length>0&&this.animate()},Object.defineProperty(t.prototype,"x",{get:function(){return null!==this._x&&void 0!==this._x||(this.align%2===0?this._x=this.dom.offsetLeft:this._x=this.parent.width-this.dom.offsetLeft-this.width),this.absolute?this._x:this._x/this.parent.width},set:function(t){this._x=t,this.absolute||(this._x*=this.parent.width),this.align%2===0?this.dom.style.left=this._x+"px":this.dom.style.right=this._x+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return null!==this._y&&void 0!==this._y||(this.align<2?this._y=this.dom.offsetTop:this._y=this.parent.height-this.dom.offsetTop-this.height),this.absolute?this._y:this._y/this.parent.height},set:function(t){this._y=t,this.absolute||(this._y*=this.parent.height),this.align<2?this.dom.style.top=this._y+"px":this.dom.style.bottom=this._y+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return null!==this._width&&void 0!==this._width||(this._width=this.dom.offsetWidth),this._width},set:function(t){this._width=t,this.dom.style.width=this._width+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return null!==this._height&&void 0!==this._height||(this._height=this.dom.offsetHeight),this._height},set:function(t){this._height=t,this.dom.style.height=this._height+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},set:function(t){this._size=t,this.dom.style.fontSize=this._size+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t;var e=t.toString(16);e=e.length>=6?e:new Array(6-e.length+1).join("0")+e,this.dom.style.color="#"+e,0===this._color&&(this.dom.className=this.parent.options.global.className+" rshadow")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t,this.dom.style.opacity=Math.min(this._alpha,this.parent.options.global.opacity)+""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"border",{get:function(){return this._border},set:function(t){this._border=t,this._border?this.dom.style.border="1px solid #00ffff":this.dom.style.border="none"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadow",{get:function(){return this._shadow},set:function(t){this._shadow=t,this._shadow||(this.dom.className=this.parent.options.global.className+" noshadow")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"font",{get:function(){return this._font},set:function(t){this._font=t,this._font.length>0?this.dom.style.fontFamily=this._font:this.dom.style.fontFamily=""},enumerable:!0,configurable:!0}),t.prototype.time=function(t){this.ttl-=t,this.ttl<0&&(this.ttl=0),this.movable&&this.update(),this.ttl<=0&&this.finish()},t.prototype.update=function(){this.animate()},t.prototype.invalidate=function(){this._x=null,this._y=null,this._width=null,this._height=null},t.prototype._execMotion=function(t,e){for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];this[i]=n.easing(Math.min(Math.max(e-n.delay,0),n.dur),n.from,n.to-n.from,n.dur)}},t.prototype.animate=function(){if(this._alphaMotion&&(this.alpha=(this.dur-this.ttl)*(this._alphaMotion.to-this._alphaMotion.from)/this.dur+this._alphaMotion.from),0!==this.motion.length){var t=Math.max(this.ttl,0),e=this.dur-t-this._motionStart[this._curMotion];return this._execMotion(this.motion[this._curMotion],e),this.dur-t>this._motionEnd[this._curMotion]?(this._curMotion++,void(this._curMotion>=this.motion.length&&(this._curMotion=this.motion.length-1))):void 0}},t.prototype.stop=function(){},t.prototype.finish=function(){this.parent.finish(this)},t.prototype.toString=function(){return["[",this.stime,"|",this.ttl,"/",this.dur,"]","(",this.mode,")",this.text].join("")},t.LINEAR=function(t,e,i,n){return t*i/n+e},t}(),ScrollComment=function(t){function e(e,i){t.call(this,e,i),this.dur*=this.parent.options.scroll.scale,this.ttl*=this.parent.options.scroll.scale}return __extends(e,t),Object.defineProperty(e.prototype,"alpha",{set:function(t){this._alpha=t,this.dom.style.opacity=Math.min(Math.min(this._alpha,this.parent.options.global.opacity),this.parent.options.scroll.opacity)+""},enumerable:!0,configurable:!0}),e.prototype.init=function(e){void 0===e&&(e=null),t.prototype.init.call(this,e),this.x=this.parent.width,this.parent.options.scroll.opacity<1&&(this.alpha=this._alpha),this.absolute=!0},e.prototype.update=function(){this.x=this.ttl/this.dur*(this.parent.width+this.width)-this.width},e}(CoreComment),CSSCompatLayer=function(){function t(){}return t.transform=function(t,e){t.style.transform=e,t.style.webkitTransform=e,t.style.msTransform=e,t.style.oTransform=e},t}(),CSSScrollComment=function(t){function e(){t.apply(this,arguments),this._dirtyCSS=!0}return __extends(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this.ttl/this.dur*(this.parent.width+this.width)-this.width},set:function(t){if("number"==typeof this._x){var e=t-this._x;this._x=t,CSSCompatLayer.transform(this.dom,"translateX("+e+"px)")}else this._x=t,this.absolute||(this._x*=this.parent.width),this.align%2===0?this.dom.style.left=this._x+"px":this.dom.style.right=this._x+"px"},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._dirtyCSS&&(this.dom.style.transition="transform "+this.ttl+"ms linear",this.x=-this.width,this._dirtyCSS=!1)},e.prototype.invalidate=function(){t.prototype.invalidate.call(this),this._dirtyCSS=!0},e.prototype.stop=function(){this.dom.style.transition="",this.x=this._x,this._x=null,this.x=this.ttl/this.dur*(this.parent.width+this.width)-this.width,this._dirtyCSS=!0},e}(ScrollComment),CommentManager=function(){function t(t){var e=0,n=this;this._listeners={},this._lastPosition=0,this.stage=t,this.paused=!0,this.pausedTime=0,this.canvas=document.createElement("canvas"),this.canvasFPS=0,n.canvas.style.width="100%",n.canvas.style.height="100%",n.stage.appendChild(n.canvas),this.options={global:{opacity:1,scale:1,className:"cmt",useCSS:!1,autoOpacity:!1,autoOpacityVal:1,density:0,outline:!1,shadow:!0},scroll:{opacity:1,scale:1},limit:0},this.timeline=[],this.runline=[],this.position=0,this.limiter=0,this.filter=null,this.csa={scroll:new CommentSpaceAllocator(0,0),top:new AnchorCommentSpaceAllocator(0,0),bottom:new AnchorCommentSpaceAllocator(0,0),reverse:new CommentSpaceAllocator(0,0),scrollbtm:new CommentSpaceAllocator(0,0)},this.width=this.stage.offsetWidth,this.height=this.stage.offsetHeight;var o=0;this.startTimer=function(){if(!(e>0)){var t=(new Date).getTime(),i=this;e=window.setInterval(function(){var e=(new Date).getTime()-t;t=(new Date).getTime(),i.onTimerEvent(e,i),i.sendQueueLoader()},1e3/60),this.paused=!1,this.pausedTime=Date.now()-o}},this.stopTimer=function(){window.clearInterval(e),e=0,this.paused=!0,o=Date.now()};var s=(this.options.global.opacity,!1),a=0,l=0,r=function(){n.options.global.autoOpacity&&(n.options.global.useCSS?n.stage.style.opacity=i(l):n.options.global.autoOpacityVal=n.options.global.opacity*i(l))};setInterval(function(){n.canvasFPS=a,a=0},1e3),this.addEventListener("enterComment",function(){l++,r()}),this.addEventListener("exitComment",function(){l--,r()}),this.canvasDrawerWrapper=function(t){s||(t||(t=performance.now()),s=!0,a++,n.canvasDrawer(0|t),s=!1)},this.ttlRecalcAll=function(){this.runline.forEach(u)};var d=[];this.send=function(t){d.push(t)},this.sendQueueLoader=function(){performance.now();d.length&&n.sendAsync(d.shift())},this.addEventListener("clear",function(){d=[]}),requestAnimationFrame(this.canvasDrawerWrapper),function(){var t=window.devicePixelRatio;window.addEventListener("resize",function(){var e=window.devicePixelRatio;t!=e&&(n.runline.forEach(function(t){t.textData&&p(t,n.options.global.outline,n.options.global.shadow)}),t=e),n.ttlRecalcAll()})}()}var e=function(t,e){for(var i=Math.PI/180,n=t*i,o=e*i,s=Math.cos,a=Math.sin,l=[s(n)*s(o),s(n)*a(o),a(n),0,-a(o),s(o),0,0,-a(n)*s(o),-a(n)*a(o),s(n),0,0,0,0,1],r=0;r<l.length;r++)Math.abs(l[r])<1e-6&&(l[r]=0);return"matrix3d("+l.join(",")+")"},i=function(t){return-Math.tanh((t-50)/25)/Math.PI*.8+.718},n="-apple-system,Arial,'PingFang SC','STHeiti Light','Hiragino Kaku Gothic ProN','Microsoft YaHei'";t.prototype.stop=function(){this.stopTimer();for(var t=0;t<this.runline.length;t++)"undefined"!=typeof this.runline[t].stop&&this.runline[t].stop()},t.prototype.start=function(){this.startTimer()},t.prototype.seek=function(t){this.position=BinArray.bsearch(this.timeline,t,function(t,e){return t<e.stime?-1:t>e.stime?1:0})},t.prototype.validate=function(t){return null!=t&&this.filter.doValidate(t)},t.prototype.load=function(t){this.timeline=t,this.timeline.sort(function(t,e){return t.stime>e.stime?2:t.stime<e.stime?-2:t.date>e.date?1:t.date<e.date?-1:null!=t.dbid&&null!=e.dbid?t.dbid>e.dbid?1:t.dbid<e.dbid?-1:0:0}),this.dispatchEvent("load")},t.prototype.insert=function(t){var e=BinArray.binsert(this.timeline,t,function(t,e){return t.stime>e.stime?2:t.stime<e.stime?-2:t.date>e.date?1:t.date<e.date?-1:null!=t.dbid&&null!=e.dbid?t.dbid>e.dbid?1:t.dbid<e.dbid?-1:0:0});e<=this.position&&this.position++,this.dispatchEvent("insert")},t.prototype.clear=function(){for(;this.runline.length>0;)this.runline[0].finish();this.dispatchEvent("clear"),this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.setBounds=function(){this.width=this.stage.offsetWidth,this.height=this.stage.offsetHeight,this.dispatchEvent("resize");for(var t in this.csa)this.csa[t].setBounds(this.width,this.height);this.stage.style.perspective=this.width*Math.tan(40*Math.PI/180)/2+"px",this.stage.style.webkitPerspective=this.width*Math.tan(40*Math.PI/180)/2+"px",this.canvasResize()},t.prototype.init=function(){this.setBounds(),null==this.filter&&(this.filter=new CommentFilter)},t.prototype.time=function(t){if(t-=1,this.position>=this.timeline.length||Math.abs(this._lastPosition-t)>=2e3){if(this.seek(t),this._lastPosition=t,this.timeline.length<=this.position)return}else this._lastPosition=t;for(;this.position<this.timeline.length&&this.timeline[this.position].stime<=t;this.position++)this.options.limit>0&&this.runline.length>this.limiter||this.validate(this.timeline[this.position])&&this.send(this.timeline[this.position])},t.prototype.canvasResize=function(){try{var t=(this.width,this.height,window.devicePixelRatio);this.canvas.width=this.canvas.offsetWidth*t,this.canvas.height=this.canvas.offsetHeight*t,this.ttlRecalcAll(),d(this)}catch(t){return console.error("shit happened! forcing CSS! ",t.message),void this.useCSS(!0)}};var o=0,s=0,a=0,l=0,r=0,d=function(t){};t.prototype.canvasDrawer=function(){if(!this.options.global.useCSS){if(this.paused)return void requestAnimationFrame(this.canvasDrawerWrapper);var t,e,i=0|performance.now(),n=window.devicePixelRatio,d=this.pausedTime,c=this.canvas.getContext("2d"),h=this.width,u=this.height;c.globalAlpha=this.options.global.autoOpacity?this.options.global.autoOpacityVal:this.options.global.opacity,c.imageSmoothingEnabled=!1,0!=d&&(this.runline.forEach(function(t){if(t.textData)switch(t.mode){case 1:t.prev+=d;break;case 4:case 5:t.removeTime+=d}}),this.pausedTime=0);var n=window.devicePixelRatio,p=[0];maxBottomMaxWidth=[0],maxBottomHeight=[0],maxTopMaxWidth=[0],maxTopHeight=[0],this.runline.forEach(function(t){1==t.mode?(t.rx+=t.speed*(i-t.prev)/1e3,t.prev=i,p.push(t._y+t._height)):4==t.mode?(maxBottomMaxWidth.push(t._width),maxBottomHeight.push(t._y+t._height)):5==t.mode&&(maxTopMaxWidth.push(t._width),maxTopHeight.push(t._y+t._height))}),p=Math.max.apply(Math,p),maxBottomMaxWidth=Math.max.apply(Math,maxBottomMaxWidth),maxBottomHeight=Math.max.apply(Math,maxBottomHeight),maxTopMaxWidth=Math.max.apply(Math,maxTopMaxWidth),maxTopHeight=Math.max.apply(Math,maxTopHeight),o>0&&c.clearRect(0,0,m(h*n),m(o*n)),r>o&&c.clearRect(m((h-l)/2*n),m(o*n),m((h+l)/2*n),m(r*n)),c.clearRect(m((h-s)/2*n),m(Math.max(u-a,o)*n),m((h+s)/2*n),m(u*n)),o=p,s=maxBottomMaxWidth,a=maxBottomHeight,l=maxTopMaxWidth,r=maxTopHeight;var f=this;c.globalAlpha=f.options.global.autoOpacity?f.options.global.autoOpacityVal:f.options.global.opacity,f.runline.forEach(function(i){if(i.textData){switch(i.mode){case 1:i.x=h-i.rx,t=h-i.rx,e=i.y;break;case 4:i.x=(h-i.width)/2,t=i.x,e=u-i.y-i.height;break;case 5:i.x=(h-i.width)/2,t=i.x,e=i.y;break;default:return}c.drawImage(i.textData,m(t*n),m(e*n))}}),requestAnimationFrame(this.canvasDrawerWrapper)}};var c=Math.ceil,m=Math.round,h=function(t){for(var t=t.toString(16);t.length<6;)t="0"+t;return t},u=function(t){if(t.speed){var e=t.dur-t.ttl;t.dur=(t.parent.width+t.width)/t.speed*1e3,t.ttl=t.dur-e}},p=function(t,e,i){var o=document.createElement("canvas"),s=o.getContext("2d"),a=window.devicePixelRatio;o.width=1,o.height=1,s.font="bold "+t.size*a+"px "+n,s.imageSmoothingEnabled=!1,t.width=c(s.measureText(t.text).width/a)+2,t.height=c(t.size+3)+2,t.oriWidth=c(t.width*a),t.oriHeight=c(t.height*a),o.width=t.oriWidth,o.height=t.oriHeight,s.font="bold "+t.size*a+"px "+n,s.lineWidth=.7*a,s.strokeStyle=0==t._color?"#FFFFFF":"#000000",s.textBaseline="bottom",s.textAlign="left",i&&(s.lineWidth=.25*a,s.shadowBlur=2*a,s.shadowColor=0==t._color?"#FFFFFF":"#000000"),s.fillStyle="#"+h(t.color),s.fillText(t.text,1,o.height-1),e&&s.strokeText(t.text,1,o.height-1),t.border&&(s.lineWidth=m(2*a),s.strokeStyle="#00ffff",s.shadowBlur=0,s.strokeRect(0,0,o.width,o.height)),t.textData=o};return t.prototype.getCommentFromPoint=function(t,e){var i,n,o=[],s=this.height;return this.runline.forEach(function(a){i=t-a.x,n=4==a.mode?e-(s-a.y-a.height):e-a.y,i>=0&&i<=a.width&&n>=0&&n<=a.height&&o.push(a)}),o},t.prototype.useCSS=function(t){this.options.global.useCSS=t,this.clear(),t||(this.stage.style.opacity="",requestAnimationFrame(this.canvasDrawerWrapper))},t.prototype.autoOpacity=function(t){this.options.global.autoOpacity=t},t.prototype.sendAsync=function(t){if(8===t.mode)return void(this.scripting&&this.scripting.eval(t.code));if(this.options.global.density>0&&1==t.mode&&t.border!==!0&&this.csa.scroll.length>=this.options.global.density)return!1;if(null==this.filter||(t=this.filter.doModify(t),null!=t&&t!==!1)){if(this.options.global.useCSS||[1,4,5].indexOf(t.mode)==-1){if(1===t.mode||2===t.mode||6===t.mode)var i=new CSSScrollComment(this,t);else var i=new CoreComment(this,t);switch(i.mode){case 1:i.align=0;break;case 2:i.align=2;break;case 4:i.align=2;break;case 5:i.align=0;break;case 6:i.align=1}switch(i.init(),this.stage.appendChild(i.dom),i.dom.transitionStartTime=(new Date).getTime(),i.mode){default:case 1:this.csa.scroll.add(i);break;case 2:this.csa.scrollbtm.add(i);break;case 4:this.csa.bottom.add(i);break;case 5:this.csa.top.add(i);break;case 6:this.csa.reverse.add(i);break;case 17:case 7:0===t.rY&&0===t.rZ||(i.dom.style.transform=e(t.rY,t.rZ),i.dom.style.webkitTransform=e(t.rY,t.rZ),i.dom.style.OTransform=e(t.rY,t.rZ),i.dom.style.MozTransform=e(t.rY,t.rZ),i.dom.style.MSTransform=e(t.rY,t.rZ))}i.y=i.y}else{var n=performance.now(),i=new CoreComment(this,t);switch(i.dom={style:{}},p(i,this.options.global.outline,this.options.global.shadow),1==t.mode||6==t.mode?(i.rx=0,i.x=this.width,i.prev=n,i.speed=(this.width+i.width)/i.dur*1e3):4!=t.mode&&5!=t.mode||(i.removeTime=n+i.dur),i.mode){default:case 1:this.csa.scroll.add(i);break;case 4:this.csa.bottom.add(i);break;case 5:this.csa.top.add(i)}}i.originalData=t,this.dispatchEvent("enterComment",i),this.runline.push(i)}},t.prototype.finish=function(t){this.dispatchEvent("exitComment",t);try{this.stage.removeChild(t.dom)}catch(t){}var e=this.runline.indexOf(t);switch(e>=0&&this.runline.splice(e,1),t.mode){default:case 1:this.csa.scroll.remove(t);break;case 2:this.csa.scrollbtm.remove(t);break;case 4:this.csa.bottom.remove(t);break;case 5:this.csa.top.remove(t);break;case 6:this.csa.reverse.remove(t);break;case 7:}t.textData&&(t.textData=null)},t.prototype.resumeComment=function(){Array.prototype.slice.call(this.stage.children).forEach(function(t){t.classList.contains("cmt")&&t.classList.contains("paused")&&(t.style.transitionDuration=t.finalDuration+"ms",t.style.transform=t.finalTransform,t.transitionStartTime=(new Date).getTime(),t.classList.remove("paused"))})},t.prototype.pauseComment=function(){Array.prototype.slice.call(this.stage.children).forEach(function(t){t.classList.contains("cmt")&&!t.classList.contains("paused")&&(t.finalTransform=t.style.transform,t.style.transform=window.getComputedStyle(t).getPropertyValue("transform"),t.finalDuration=parseFloat(t.style.transitionDuration)-(new Date).getTime()+t.transitionStartTime,t.style.transitionDuration="10ms",t.classList.add("paused"))})},t.prototype.addEventListener=function(t,e){"undefined"!=typeof this._listeners[t]?this._listeners[t].push(e):this._listeners[t]=[e]},t.prototype.dispatchEvent=function(t,e){if("undefined"!=typeof this._listeners[t])for(var i=0;i<this._listeners[t].length;i++)try{this._listeners[t][i](e)}catch(t){console.err(t.stack)}},t.prototype.onTimerEvent=function(t,e){for(var i=0;i<e.runline.length;i++){var n=e.runline[i];n.hold||n.time(t)}},t}(),ABP={version:"0.8.0",Strings:{statsPlayer:"播放器尺寸：",statsVideo:"视频分辨率：",statsBuffer:"可用缓冲：",statsBufferClip:"缓冲片段：",statsPresent:"期望帧率：",statsDrop:"丢弃帧率：",statsVideoCodec:"视频编码：",statsAudioCodec:"音频编码：",statsVideoBitrate:"视频码率：",statsAudioBitrate:"音频码率：",statsCurrentBitrate:"本段码率：",statsRealtimeBitrate:"实时码率：",overallBitrate:"总体码率：",statsDownloadSpeed:"下载速度：",sendSmall:"小字号",sendMid:"中字号",sendSize:"弹幕字号",sendMode:"弹幕模式",sendTop:"顶端渐隐",sendScroll:"滚动字幕",sendBottom:"底端渐隐",send:"发送",sendStyle:"弹幕样式",sendColor:"弹幕颜色",commentSpeed:"弹幕速度",commentScale:"弹幕比例",commentOpacity:"弹幕不透明度",commentBlock:"弹幕屏蔽列表",playSpeed:"播放速度",playSpeedReset:"还原正常速度",displayScaleD:"默认",displayScaleF:"全屏",shieldTypeText:"文字",shieldTypeUser:"用户",shieldTypeColor:"颜色",shieldTypeSetting:"设置",shieldAdd:"添加屏蔽……",shieldUseRegex:"启用正则",viewers:" 观众",comments:" 弹幕",commentTime:"时间",commentContent:"评论",commentDate:"发送日期",showStats:"显示统计信息",loadingMeta:"正在加载视频信息",switching:"正在切换",fetchURL:"正在获取视频地址",buffering:"正在缓冲",play:"播放",pause:"暂停",mute:"静音",unmute:"取消静音",fullScreen:"浏览器全屏",exitFullScreen:"退出全屏",webFull:"网页全屏",exitWebFull:"退出网页全屏",wideScreen:"宽屏模式",exitWideScreen:"退出宽屏",sendTooltip:"毁灭地喷射白光!da!",showComment:"显示弹幕",hideComment:"隐藏弹幕",loopOn:"洗脑循环 on",loopOff:"重新载入",usingCanvas:"正在使用Canvas",usingCSS:"正在使用CSS",useCSS:"使用CSS绘制弹幕",autoOpacityOn:"关闭自动不透明度",autoOpacityOff:"开启自动不透明度",copyComment:"复制弹幕",findComment:"定位弹幕",blockContent:"屏蔽内容“",blockUser:"屏蔽发送者",blockColor:"屏蔽颜色",blockColorWhite:"不能屏蔽白色",copyFail:"复制失败，浏览器不支持",blockUserEmpty:"没有屏蔽用户",blockColorEmpty:"没有屏蔽颜色"}};(function(){"use strict";if(ABP){var t=(jQuery,"addEventListener"),e="HTML5 Player ver.181106 based on ABPlayer-bilibili-ver",i=function(t){return document.getElementById(t)},n=function(t,e,i,n){var o=null;if("text"===t)return document.createTextNode(e);o=document.createElement(t);for(var s in e)if("style"!==s&&"className"!==s)o.setAttribute(s,e[s]);else if("className"===s)o.className=e[s];else for(var a in e.style)o.style[a]=e.style[a];if(i)for(var l=0;l<i.length;l++)null!=i[l]&&o.appendChild(i[l]);return n&&"function"==typeof n&&n(o),o},o=function(t,e){for(;t;t=t.parentNode)if(u(t.parentNode,e))return t};HTMLElement.prototype.tooltip=function(t){this.tooltipData=t,this.dispatchEvent(new Event("updatetooltip"))},"undefined"==typeof HTMLElement.prototype.requestFullScreen&&(HTMLElement.prototype.requestFullScreen=function(){this.webkitRequestFullscreen?this.webkitRequestFullscreen():this.mozRequestFullScreen?this.mozRequestFullScreen():this.msRequestFullscreen&&this.msRequestFullscreen()});var s=Object.keys(HTMLVideoElement.prototype);s.indexOf("webkitDecodedFrameCount")!=-1&&s.indexOf("getVideoPlaybackQuality")==-1&&(HTMLVideoElement.prototype.getVideoPlaybackQuality=function(){
return{totalVideoFrames:this.webkitDecodedFrameCount,droppedVideoFrames:this.webkitDroppedFrameCount}}),"undefined"==typeof document.isFullScreen&&(document.isFullScreen=function(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenEnabled}),"undefined"==typeof document.exitFullscreen&&(document.exitFullscreen=function(){document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():window.msExitFullscreen&&msExitFullscreen()});var a=function(t,e){e=e||2;for(var i=""+t;i.length<e;)i="0"+i;return i},l=function(t,e){for(var i="",n=1;n<=e-(t+"").length;n++)i+="0";return i+t},r=function(t,e){if(0==t)return lang.oneDay;var i,n,o,s,a,l,r=new Date(1e3*parseInt(t));return i=String(r.getFullYear()),n=String(r.getMonth()+1),1==n.length&&(n="0"+n),o=String(r.getDate()),1==o.length&&(o="0"+o),s=String(r.getHours()),1==s.length&&(s="0"+s),a=String(r.getMinutes()),1==a.length&&(a="0"+a),l=String(r.getSeconds()),1==l.length&&(l="0"+l),e?String(n+"-"+o+" "+s+":"+a):String(i+"-"+n+"-"+o+" "+s+":"+a+":"+l)},d=function(t){return isNaN(t)?"00:00":l(parseInt(t/60),2)+":"+l(parseInt(t%60),2)},c=function(t){for(var e=t.split(":"),i=0,n=0;n<e.length;n++){i*=60;var o=parseInt(e[n]);if(isNaN(o)||o<0)return!1;i+=o}return i},m=function(e,s,a){e&&(e[t]("mousemove",function(t){var l,r=i("ABP-Tooltip"),d=e.clientWidth,c=e.clientHeight,m=e.getBoundingClientRect(),h=o(e,"ABP-Unit").getBoundingClientRect(),u=m.top-h.top,p=s?t.clientX-h.left:m.left-h.left,f=p;null==r&&(r=n("div",{id:"ABP-Tooltip"},[n("text",e.tooltipData)]),r.by=e,o(e,"ABP-Unit").appendChild(r),r.style.top=u+c+2+"px",r.style.left=p+d/2-r.clientWidth/2+"px",f+=d/2-r.clientWidth/2),s&&(r.style.left=p-r.clientWidth/2+"px",f-=d/2),l=r.getBoundingClientRect(),l.left<h.left?r.style.left="0px":l.right>h.right&&(r.style.left=h.width-l.width+"px"),a=a||-6,a&&(r.style.top=u-r.clientHeight+2+a+"px")}),e[t]("mouseout",function(){var t=i("ABP-Tooltip");t&&t.parentNode&&t.parentNode.removeChild(t)}),e[t]("updatetooltip",function(t){var n=i("ABP-Tooltip");n&&n.by==t.target&&(n.innerHTML=e.tooltipData)}))},h=function(t,e){if(null!=t){var i=t.className.split(" ");""==i[0]&&(i=[]),i.indexOf(e)<0&&i.push(e),t.className=i.join(" ")}},u=function(t,e){if(null==t)return!1;var i=t.className.split(" ");return""==i[0]&&(i=[]),i.indexOf(e)>=0},p=function(t,e){if(null!=t){var i=t.className.split(" ");""==i[0]&&(i=[]),i.indexOf(e)>=0&&i.splice(i.indexOf(e),1),t.className=i.join(" ")}},f=function(t,e){var i={};for(var n in e)t&&"undefined"!=typeof t[n]?i[n]=t[n]:i[n]=e[n];return i};ABP.create=function(o,s){var a=o;if(s||(s={}),ABP.playerConfig=s.config?s.config:{},s=f(s,{replaceMode:!0,width:512,height:384,src:""}),"string"==typeof o&&(a=i(o)),u(a,"ABP-Unit"))l=a;else{var l=n("div",{className:"ABP-Unit",theme:"YouTube",style:{width:s.width.toString().indexOf("%")>=0?s.width:s.width+"px",height:s.height.toString().indexOf("%")>=0?s.height:s.height+"px"}});a.appendChild(l)}l.children.length>0&&s.replaceMode&&(l.innerHTML="");var r=[],d=[];if("string"==typeof s.src)s.src=n("video",{autobuffer:"true",dataSetup:"{}"},[n("source",{src:s.src})]),r.push(s.src);else if(s.src.hasOwnProperty("playlist"))for(var c=s.src,m=c.playlist,h=0;h<m.length;h++){if(m[h].hasOwnProperty("sources")){var p=[];for(var v in m[h].sources)p.push(n("source",{src:m[h][v],type:v}));r.push(n("video",{autobuffer:"true",dataSetup:"{}"},p))}else m[h].hasOwnProperty("video")&&r.push(m[h].video);d.push(m[h].comments)}else r.push(s.src);l.appendChild(n("div",{className:"ABP-Player"},[n("div",{className:"ABP-Video",tabindex:"10"},[n("div",{id:"info-box",style:{opacity:1}},[n("div",{className:"text-wrapper"},[n("div",{},[n("text",ABP.Strings.loadingMeta)])]),n("div",{id:"dots"})]),n("div",{className:"ABP-Container"}),r[0],n("div",{className:"Player-Stats"},[n("div",{id:"player-dimension"},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsPlayer)]),n("span")]),n("div",{id:"video-dimension"},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsVideo)]),n("span")]),n("div",{id:"buffer-health"},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsBuffer)]),n("span",{className:"stats-column",id:"buffer-health-column"}),n("span")]),n("br",{className:"flvjs"}),n("div",{className:"flvjs"},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsVideoCodec)]),n("span")]),n("div",{className:"flvjs"},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsAudioCodec)]),n("span")]),n("div",{className:"flvjs"},[n("span",{className:"stats_name"},[n("text","fps：")]),n("span")]),n("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsVideoBitrate)]),n("span")]),n("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsAudioBitrate)]),n("span")]),n("div",{className:"flvjs",title:"1 kbps = 1000 bps"},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsRealtimeBitrate)]),n("span",{className:"stats-column",id:"realtime-bitrate-column",style:{verticalAlign:"top"}}),n("span")]),n("div",{className:"flvjs"},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsDownloadSpeed)]),n("span",{className:"stats-column",id:"download-speed-column",style:{verticalAlign:"top"}}),n("span")]),n("br",{className:"hlsjs"}),n("div",{className:"hlsjs"},[n("span",{className:"stats_name"},[n("text","当前分片：")]),n("span",{style:{width:"180px",height:"5px",display:"inline-block",position:"relative",border:"solid #AAA 1px",borderRadius:"4px",verticalAlign:"middle",marginRight:"2px"}},[n("span",{id:"download-progress-hls",style:{position:"absolute",left:"2px",right:"2px",top:"1px",bottom:"1px",background:"#CCC",borderRadius:"3px",transition:"width .3s",width:0}})]),n("span")]),n("div",{className:"hlsjs",title:"1 kbps = 1000 bps"},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsRealtimeBitrate)]),n("span",{className:"stats-column",id:"realtime-bitrate-column-hls",style:{verticalAlign:"top"}}),n("span")]),n("div",{className:"hlsjs"},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsDownloadSpeed)]),n("span",{className:"stats-column",id:"download-speed-hls-column",style:{verticalAlign:"top"}}),n("span")]),n("br"),n("div",{style:{position:"relative"}},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsBufferClip)]),n("span",{id:"buffer-clips"},[n("span"),n("span",{},[n("div",{style:{width:"1px",height:"400%",top:"-150%",position:"absolute",background:"#FFF",left:0}})])]),n("pre",{style:{position:"absolute",margin:0,left:"210px",width:"90px",fontFamily:"inherit"}})]),n("div",{id:"canvas-fps"},[n("span",{className:"stats_name"},[n("text","Canvas fps：")]),n("span")]),n("div",{className:"videoQuality"},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsPresent)]),,n("span",{className:"stats-column",id:"playback-fps-column"}),n("span")]),n("div",{className:"videoQuality"},[n("span",{className:"stats_name"},[n("text",ABP.Strings.statsDrop)]),,n("span",{className:"stats-column",id:"drop-fps-column"}),n("span")]),n("br"),n("div",{style:{fontSize:"11px"}},[n("text",e)]),n("div",{style:{fontSize:"11px"}},[n("text","2017©esterTion")]),n("div",{id:"stats-close"},[n("text","×")])])]),n("div",{className:"ABP-FullScreenProgress"}),n("div",{className:"ABP-Bottom"},[n("div",{className:"ABP-Bottom-Extend"}),n("div",{className:"ABP-Bottom-Wrapper"},[n("div",{className:"ABP-Text"},[n("div",{className:"ABP-CommentStyle"},[n("div",{className:"button-group ABP-Comment-FontGroup"},[n("div",{className:"button ABP-Comment-Font icon-font-style"}),n("div",{className:"ABP-Comment-FontOption"},[n("p",{className:"style-title"},[n("text",ABP.Strings.sendSize)]),n("div",{className:"style-select",name:"commentFontSize"},[n("div",{className:"style-option",value:18},[n("text",ABP.Strings.sendSmall)]),n("div",{className:"style-option on",value:25},[n("text",ABP.Strings.sendMid)])]),n("p",{className:"style-title"},[n("text",ABP.Strings.sendMode)]),n("div",{className:"style-select",name:"commentMode"},[n("div",{className:"style-option",value:5},[n("text",ABP.Strings.sendTop)]),n("div",{className:"style-option on",value:1},[n("text",ABP.Strings.sendScroll)]),n("div",{className:"style-option",value:4},[n("text",ABP.Strings.sendBottom)])])])]),n("div",{className:"button-group ABP-Comment-ColorGroup"},[n("div",{className:"ABP-Comment-Color-Display"}),n("div",{className:"button ABP-Comment-Color icon-color-mode"}),n("div",{className:"ABP-Comment-ColorOption"},[n("div",{className:"ABP-Comment-ColorPicker"})])])]),n("form",{},[n("input",{className:"ABP-Comment-Input"})]),n("div",{className:"ABP-Comment-Send"},[n("text",ABP.Strings.send)])]),n("div",{className:"ABP-Control"},[n("div",{className:"button ABP-Play icon-play"}),n("div",{className:"progress-bar"},[n("div",{className:"bar"},[n("div",{className:"load"}),n("div",{className:"dark"})])]),n("div",{className:"time-label"},[n("text","00:00")]),n("div",{className:"button ABP-Volume icon-volume-high"}),n("div",{className:"volume-bar"},[n("div",{className:"bar"},[n("div",{className:"load"})])]),n("div",{className:"button-group ABP-CommentGroup"},[n("div",{className:"button ABP-CommentShow icon-comment on"}),n("div",{className:"ABP-CommentOption"},[n("p",{className:"label"},[n("text",ABP.Strings.useCSS),n("div",{className:"prop-checkbox"})]),n("p",{className:"label"},[n("text",ABP.Strings.commentSpeed)]),n("div",{className:"speed-bar"},[n("div",{className:"bar"},[n("div",{className:"load"})])]),n("p",{className:"label"},[n("text",ABP.Strings.commentScale)]),n("div",{className:"scale-bar"},[n("div",{className:"bar"},[n("div",{className:"load"})])]),n("p",{className:"label"},[n("text",ABP.Strings.commentOpacity)]),n("div",{className:"opacity-bar",style:{width:"calc(100% - 25px)"}},[n("div",{className:"bar"},[n("div",{className:"load"})])]),n("div",{className:"prop-checkbox",style:{top:"121px"}}),n("div",{className:"shield-enrty"},[n("text",ABP.Strings.commentBlock)])])]),n("div",{className:"button-group ABP-PlaySpeedGroup"},[n("div",{className:"button ABP-Loop icon-loop"})]),n("div",{className:"button ABP-WideScreen icon-tv"}),n("div",{className:"button-group ABP-FullScreenGroup"},[n("div",{className:"button ABP-FullScreen icon-screen-full"}),n("div",{className:"button ABP-Web-FullScreen icon-screen"})])])]),n("div",{className:"BiliPlus-Scale-Menu"},[n("div",{className:"Video-Defination"}),n("div",{className:"Video-Scale"},[n("div",{changeTo:"default",className:"on"},[n("text",ABP.Strings.displayScaleD)]),n("div",{changeTo:"16_9"},[n("text","16:9")]),n("div",{changeTo:"4_3"},[n("text","4:3")]),n("div",{changeTo:"full"},[n("text",ABP.Strings.displayScaleF)])])])])])),l.appendChild(n("div",{className:"shield hidden"},[n("div",{className:"shield_top"},[n("text",ABP.Strings.commentBlock),n("span",{className:"close"})]),n("div",{className:"shield_tabs"},[n("div",{className:"shield_tab on"},[n("div",{},[n("text",ABP.Strings.shieldTypeText)])]),n("div",{className:"shield_tab"},[n("div",{},[n("text",ABP.Strings.shieldTypeUser)])]),n("div",{className:"shield_tab"},[n("div",{},[n("text",ABP.Strings.shieldTypeColor)])]),n("div",{className:"shield_tab"},[n("div",{},[n("text",ABP.Strings.shieldTypeSetting)])])]),n("div",{className:"shield_tab_slash"}),n("div",{className:"shield_body"},[n("div",{className:"shield_body_wrapper"},[n("div",{className:"shield_tab_body"},[n("div",{id:"shield_text"}),n("div",{className:"shield_item"},[n("input",{className:"new",type:"text",placeholder:ABP.Strings.shieldAdd}),n("div",{className:"add"})])]),n("div",{className:"shield_tab_body"},[n("div",{id:"shield_user"})]),n("div",{className:"shield_tab_body"},[n("div",{id:"shield_color"})]),n("div",{className:"shield_tab_body"},[n("div",{className:"shield_toggle",id:"useReg"},[n("text",ABP.Strings.shieldUseRegex)])])])])])),l.appendChild(n("div",{className:"ABP-Comment-List"},[n("div",{className:"ABP-Comment-List-Count"},[n("div",{style:{position:"absolute",right:"200px"}},[n("span",{id:"viewer",style:{fontWeight:"bold"}},[n("text","--")]),n("text",ABP.Strings.viewers)]),n("div",{style:{position:"absolute",right:"20px"}},[n("span",{id:"danmaku",style:{fontWeight:"bold"}},[n("text","--")]),n("text",ABP.Strings.comments)])]),n("div",{className:"ABP-Comment-List-Title"},[n("div",{className:"cmt-time",item:"time"},[n("text",ABP.Strings.commentTime)]),n("div",{className:"cmt-content",item:"content"},[n("text",ABP.Strings.commentContent)]),n("div",{className:"cmt-date",item:"date"},[n("text",ABP.Strings.commentDate)])]),n("div",{className:"ABP-Comment-List-Container"},[n("ul",{className:"ABP-Comment-List-Container-Inner"})])])),l.appendChild(n("div",{className:"Context-Menu"},[n("div",{className:"Context-Menu-Background"}),n("div",{className:"Context-Menu-Body"},[n("div",{id:"Player-Stats-Toggle"},[n("text",ABP.Strings.showStats)]),n("div",{id:"Player-Speed-Control",className:"dm"},[n("div",{className:"content"},[n("text",ABP.Strings.playSpeed)]),n("div",{className:"dmMenu",style:{top:"-37px"}},[n("div",{"data-speed":.5},[n("text",.5)]),n("div",{"data-speed":1},[n("text",1)]),n("div",{"data-speed":1.25},[n("text",1.25)]),n("div",{"data-speed":1.5},[n("text",1.5)]),n("div",{"data-speed":2},[n("text",2)])])]),n("div",{className:"about"},[n("text",e)])])]));var g=ABP.bind(l);if(r.length>0){var y=r[0];g.gotoNext=function(){var e=r.indexOf(y)+1;if(e<r.length){y=r[e],y.style.display="";var i=g.video.parentNode;i.removeChild(g.video),i.appendChild(y),g.video.style.display="none",g.video=y,g.swapVideo(y),y[t]("ended",function(){g.gotoNext()})}},y[t]("ended",function(){g.gotoNext()})}return g};var v=function(){var t=3988292384,e=new Array(256),i=function(){var i,n,o;for(n=0;n<256;++n){for(i=n,o=0;o<8;++o)i=0!=(1&i)?t^i>>>1:i>>>1;e[n]=i}},n=function(t,i){for(var n,o=4294967295,s=t.length,a=0;a<s;++a)n=255&(o^t.charCodeAt(a)),o=o>>>8^e[n];return i?n:o},o=function(t){for(var i=0;i<256;i++)if(e[i]>>>24==t)return i;return-1},s="",a=function(t,i){var o=0,a="",l=n(t.toString(),!1);return o=255&l^i[2],o<=57&&o>=48?(a+=o-48,l=e[i[2]]^l>>>8,o=255&l^i[1],o<=57&&o>=48?(a+=o-48,l=e[i[1]]^l>>>8,o=255&l^i[0],o<=57&&o>=48?(a+=o-48,l=e[i[0]]^l>>>8,s=a,1):0):0):0};i();var l=new Array(4);return function(t){var i,r,d,c=4294967295^parseInt(t,16);for(r=1;r<1001;r++)if(c==n(r.toString(),!1))return r;for(r=3;r>=0;r--)l[3-r]=o(c>>>8*r),i=e[l[3-r]],c^=i>>>8*(3-r);for(r=0;r<1e5&&(d=n(r.toString(),!0),d!=l[3]||!a(r,l));r++);return 1e5==r?-1:r+""+s}},g=function(t){for(var e,i,n=0,o=t.currentTime;n<t.buffered.length;n++)if(o>=t.buffered.start(n)&&o<=t.buffered.end(n)){e=t.buffered.start(n),i=t.buffered.end(n);break}return n==t.buffered.length?{start:0,end:0,delta:0}:{start:e,end:i,delta:i-o}};window.crc_engine=new v,ABP.bind=function(e,i){var o={playerUnit:e,btnPlay:null,barTime:null,barFullScreenTime:null,barLoad:null,barTimeHitArea:null,barVolume:null,barVolumeHitArea:null,barOpacity:null,barOpacityHitArea:null,barScale:null,barScaleHitArea:null,barSpeed:null,barSpeedHitArea:null,btnFont:null,btnColor:null,btnSend:null,controlBar:null,timeLabel:null,timeJump:null,divComment:null,btnWide:null,btnFull:null,btnWebFull:null,btnDm:null,btnLoop:null,btnProp:null,btnAutoOpacity:null,videoDiv:null,btnVolume:null,video:null,txtText:null,commentColor:"ffffff",commentFontSize:25,commentMode:1,displayColor:null,cmManager:null,commentList:null,commentListContainer:null,lastSelectedComment:null,commentCoolDown:1e4,commentScale:ABP.playerConfig.scale?ABP.playerConfig.scale:1,commentSpeed:ABP.playerConfig.speed?ABP.playerConfig.speed:1,proportionalScale:ABP.playerConfig.prop,defaults:{w:0,h:0},state:f(i,{fullscreen:!1,commentVisible:!0,allowRescale:!1,autosize:!1,widescreen:!1}),createPopup:function(t,i){if(e.hasPopup===!0)return!1;var o=n("div",{className:"ABP-Popup"},[n("text",t)]);return o.remove=function(){o.isRemoved||(o.isRemoved=!0,e.removeChild(o),e.hasPopup=!1)},e.appendChild(o),e.hasPopup=!0,"number"==typeof i&&(i=5e3),setTimeout(function(){o.remove()},i),o},removePopup:function(){for(var t=e.getElementsByClassName("ABP-Popup"),i=0;i<t.length;i++)null!=t[i].remove?t[i].remove():t[i].parentNode.removeChild(t[i]);e.hasPopup=!1},loadCommentList:function(e,i){i="asc"==i?-1:1;var s=Object.keys(o.commentList).sort(function(t,n){return o.commentList[t][e]<o.commentList[n][e]?i:o.commentList[t][e]>o.commentList[n][e]?-i:0});o.commentObjArray=[];for(y in s){var a=s[y],l=o.commentList[a];if(l&&l.time){var c=n("li",{}),h=n("span",{className:"cmt-time"},[n("text",d(l.time/1e3))]),u=n("span",{className:"cmt-content"},[n("text",l.content)]),p=n("span",{className:"cmt-date"},[n("text",r(l.date,!0))]);m(u,!1,36),m(p,!1,18),u.tooltip(l.content),p.tooltip(r(l.date)),c.appendChild(h),c.appendChild(u),c.appendChild(p),c.data=l,c.originalData=danmaku,8==l.mode?c.style.background="#ffe100":0!=l.pool&&(c.style.background="#20ff20"),c[t]("dblclick",function(t){o.video.currentTime=this.data.time/1e3,Qt(v.currentTime)}),o.commentObjArray.push(c)}}o.commentListContainer.style.height=24*o.commentObjArray.length+"px",o.renderCommentList(),o.playerUnit.querySelector(".ABP-Comment-List-Count span#danmaku").innerHTML=o.commentObjArray.length},renderCommentList:function(){var e=o.commentListContainer.parentElement.scrollTop,i=parseInt(e/24);o.commentListContainer.innerHTML="";for(var n=i;n<=i+40&&"undefined"!=typeof o.commentObjArray[n];n++){if(n==i&&n>0){var s=o.commentObjArray[n].cloneNode(!0),a=s.getElementsByClassName("cmt-content")[0],l=s.getElementsByClassName("cmt-date")[0];s[t]("dblclick",function(t){o.video.currentTime=o.commentObjArray[n].data.time/1e3,Qt(v.currentTime)}),m(a,!1,36),m(l,!1,18),a.tooltip(o.commentObjArray[n].data.content),l.tooltip(r(o.commentObjArray[n].data.date)),s.style.paddingTop=24*i+"px"}else var s=o.commentObjArray[n];o.commentObjArray[n].data.originalData.isBlocked?o.commentObjArray[n].childNodes[0].className="cmt-time blocked":o.commentObjArray[n].childNodes[0].className="cmt-time",o.commentListContainer.appendChild(s)}o.commentListContainer.parentElement.scrollTop=e},commentCallback:function(t){t.result?(o.commentList[t.id]=o.commentList[t.tmp_id],delete o.commentList[t.tmp_id]):(delete o.commentList[t.tmp_id],o.createPopup(t.error,5e3))},swapVideo:null},s=function(t,e){var i=localStorage.html5Settings||"{}";i=JSON.parse(i),i[t]=e,localStorage.html5Settings=JSON.stringify(i)};if(s.scale=function(t){s("scale",o.commentScale)},s.opacity=function(t){s("opacity",o.cmManager.options.global.opacity)},s.speed=function(t){s("speed",o.commentSpeed)},s.commentVisible=function(t){s("commentVisible",o.cmManager.display)},s.useCSS=function(t){s("useCSS",o.cmManager.options.global.useCSS)},s.autoOpacity=function(t){s("autoOpacity",o.cmManager.options.global.autoOpacity)},o.swapVideo=function(i){var n=function(){if(!Yt){Qt(i.currentTime);try{o.barLoad.style.width="100%"}catch(t){return}}};i[t]("timeupdate",n),i[t]("ended",function(){o.btnPlay.className="button ABP-Play icon-play",o.barTime.style.width="0%",o.barFullScreenTime.style.width="0%"}),i[t]("progress",n),i.isBound=!0;var s=0,a=!1;if(o.cmManager){o.cmManager[t]("load",function(){o.commentList={};for(y in o.cmManager.timeline){var e=o.cmManager.timeline[y];8!=e.mode||a||(a=!0,setTimeout(function(){var t=new CCLScripting("/js/CommentCoreLibraryScripting.min.js");o.cmManager.scripting=t.getSandbox(o.divComment,o.video)},0)),e.dbid&&e.stime&&(o.commentList[e.dbid]={date:e.date,time:e.stime,mode:e.mode,user:e.hash,pool:e.pool,content:e.text||e.code,originalData:e})}o.loadCommentList("date","asc"),o.commentListContainer.parentElement[t]("scroll",o.renderCommentList)}),o.cmManager.setBounds=function(){e.offsetHeight<=300||e.offsetWidth<=700?h(e,"ABP-Mini"):p(e,"ABP-Mini");var t=o.videoDiv.offsetWidth,i=o.videoDiv.offsetHeight;o.proportionalScale?i/493*o.commentScale:o.commentScale;this.width=t,this.height=i,this.options.global.scale=this.width/680/o.commentSpeed,this.dispatchEvent("resize");for(var n in this.csa)this.csa[n].setBounds(this.width,this.height);this.stage.style.width=this.width+"px",this.stage.style.height=this.height+"px",this.stage.style.perspective=this.width*Math.tan(40*Math.PI/180)/2+"px",this.stage.style.webkitPerspective=this.width*Math.tan(40*Math.PI/180)/2+"px",e.querySelector(".BiliPlus-Scale-Menu .Video-Scale div.on").click(),this.canvasResize()},o.cmManager.setBounds(),o.cmManager.clear();var l=0,r=!1,d=!1,c=function(){d=!1,i.removeEventListener("canplay",c),i.paused&&o.btnPlay.click()},m=function(){var t=i.readyState,e=document.getElementById("info-box");if(!i.ended)switch(t){case 1:isMobile()&&i.paused&&o.createPopup("请点击播放器开始播放",3e3);case 2:0==e.style.opacity&&(e.style.opacity=1),dots.running||dots.runTimer();try{var n=g(i);e.childNodes[0].childNodes[0].innerHTML=ABP.Strings.buffering+" "+Math.floor(100*n.delta)/100+"s"}catch(t){e.childNodes[0].childNodes[0].innerHTML=ABP.Strings.buffering}break;case 3:case 4:1==e.style.opacity&&(e.style.opacity=0,dots.stopTimer())}};i[t]("autoplay",function(){i[t]("canplay",c)}),i[t]("loop",function(){r=i.loop}),i[t]("canplay",c),i[t]("canplay",m),i[t]("waiting",m),i[t]("progress",m),i[t]("progress",function(){s==i.currentTime&&u&&(new Date).getTime()-l>=100?i.hasStalled=!0:s!=i.currentTime&&(s=i.currentTime),l=(new Date).getTime()}),window&&window[t]("resize",function(){o.cmManager.setBounds()}),i[t]("timeupdate",function(){o.cmManager.display!==!1&&(i.hasStalled&&(i.hasStalled=!1),o.cmManager.time(Math.floor(1e3*i.currentTime)))}),i[t]("ratechange",function(){1!=this.playbackRate&&(o.createPopup("检测到播放速度改变，10秒后恢复",3e3),setTimeout(function(){i.playbackRate=1,o.createPopup("播放速度已恢复",1e3)},1e4))});var u=!1;i[t]("pause",function(){u=!1}),i[t]("waiting",function(){u=!1}),i[t]("playing",function(){u=!0})}},null!==e&&null!==e.getElementsByClassName){o.defaults.w=e.offsetWidth,o.defaults.h=e.offsetHeight;var l=e.getElementsByClassName("ABP-Video");if(!(l.length<=0)){var v=null;o.videoDiv=l[0];for(var y in l[0].children)if(null!=l[0].children[y].tagName&&"VIDEO"===l[0].children[y].tagName.toUpperCase()){v=l[0].children[y];break}var b=l[0].getElementsByClassName("ABP-Container");if(b.length>0&&(o.divComment=b[0]),null!==v){o.video=v,o.video.seek=function(t){this.currentTime=parseFloat(t)/1e3};var x=e.getElementsByClassName("ABP-Play");if(!(x.length<=0)){o.btnPlay=x[0],o.btnPlay.tooltip(ABP.Strings.play),m(o.btnPlay);var S=e.getElementsByClassName("progress-bar");if(!(S.length<=0)){var w=S[0].getElementsByClassName("bar");o.barTimeHitArea=w[0],o.barLoad=w[0].getElementsByClassName("load")[0],o.barTime=w[0].getElementsByClassName("dark")[0];var C=e.getElementsByClassName("ABP-FullScreenProgress");if(!(C.length<=0)){o.barFullScreenTime=C[0];var A=e.getElementsByClassName("time-label");if(!(A.length<=0)){o.timeLabel=A[0];var B=e.getElementsByClassName("ABP-Volume");if(!(B.length<=0)){o.btnVolume=B[0],o.btnVolume.tooltip(ABP.Strings.mute),m(o.btnVolume);var P=e.getElementsByClassName("volume-bar");if(!(P.length<=0)){var N=P[0].getElementsByClassName("bar");o.barVolumeHitArea=N[0],o.barVolume=N[0].getElementsByClassName("load")[0];var _=e.getElementsByClassName("opacity-bar");if(!(_.length<=0)){var _=_[0].getElementsByClassName("bar");o.barOpacityHitArea=_[0],o.barOpacity=_[0].getElementsByClassName("load")[0];var k=e.getElementsByClassName("scale-bar");if(!(k.length<=0)){var k=k[0].getElementsByClassName("bar");o.barScaleHitArea=k[0],o.barScale=k[0].getElementsByClassName("load")[0];var T=e.getElementsByClassName("speed-bar");if(!(T.length<=0)){var T=T[0].getElementsByClassName("bar");o.barSpeedHitArea=T[0],o.barSpeed=T[0].getElementsByClassName("load")[0];var M=e.getElementsByClassName("prop-checkbox");if(!(M.length<=0)){o.btnAutoOpacity=M[1],o.btnAutoOpacity.tooltip(ABP.Strings.autoOpacityOn),m(o.btnAutoOpacity),o.btnProp=M[0],o.btnProp.tooltip(ABP.Strings.usingCanvas),m(o.btnProp);var F=e.getElementsByClassName("ABP-FullScreen");if(!(F.length<=0)){o.btnFull=F[0],o.btnFull.tooltip(ABP.Strings.fullScreen),m(o.btnFull);var L=e.getElementsByClassName("ABP-Web-FullScreen");if(!(L.length<=0)){o.btnWebFull=L[0],o.btnWebFull.tooltip(ABP.Strings.webFull),m(o.btnWebFull);var H=e.getElementsByClassName("ABP-WideScreen");if(!(H.length<=0)){o.btnWide=H[0],o.btnWide.tooltip(ABP.Strings.wideScreen),m(o.btnWide);var O=e.getElementsByClassName("ABP-Comment-Font");if(!(O.length<=0)){o.btnFont=O[0],o.btnFont.tooltip(ABP.Strings.sendStyle),m(o.btnFont);var E=e.getElementsByClassName("ABP-Comment-Color");if(!(E.length<=0)){o.btnColor=E[0],o.btnColor.tooltip(ABP.Strings.sendColor),m(o.btnColor);var D=e.getElementsByClassName("ABP-Comment-Color-Display");if(!(D.length<=0)){o.displayColor=D[0];var W=e.getElementsByClassName("ABP-Comment-Input");if(!(W.length<=0)){o.txtText=W[0];var R=e.getElementsByClassName("ABP-Comment-List-Container-Inner");if(!(R.length<=0)){o.commentListContainer=R[0];var V=e.getElementsByClassName("ABP-Comment-Send");if(!(V.length<=0)){o.btnSend=V[0],o.btnSend.tooltip(ABP.Strings.sendTooltip),m(o.btnSend);var j=e.getElementsByClassName("ABP-Control");j.length>0&&(o.controlBar=j[0]);var I=e.getElementsByClassName("ABP-CommentShow");if(!(I.length<=0)){o.btnDm=I[0],o.btnDm.tooltip(ABP.Strings.hideComment),m(o.btnDm);var z=e.getElementsByClassName("ABP-Loop");if(!(z.length<=0)){o.btnLoop=z[0],o.btnLoop.tooltip(ABP.Strings.loopOff),m(o.btnLoop);var q={videoDimension:!0,gecko:!0,webkit:!0,videoQuality:!0,flvjs:!0},U=function(t){return document.querySelector(t)},J=function(t){return(1*t).toFixed(2)},X=">:last-child",Y=U("#player-dimension"+X),Q=U("#video-dimension"+X),G=U("#canvas-fps"+X),Z=U("#buffer-health-column"),K=U("#realtime-bitrate-column"),$=U("#realtime-bitrate-column-hls"),tt=U("#download-speed-column"),et=U("#download-speed-hls-column"),it=U("#playback-fps-column"),nt=it.parentNode.lastChild,ot=U("#drop-fps-column"),st=ot.parentNode.lastChild,at=[],lt=[],rt=[],dt=[],ct=[],mt=[],ht=0,ut=0,pt=U("#buffer-health"+X),ft='<svg style="width:180px;height:21px"><polyline style="fill:transparent;stroke:#ccc"></polyline><polyline points="1,21 180,21 180,1" style="fill:transparent;stroke:#fff"></polyline></svg>',vt="",gt=document.createElement("style"),yt=document.createElement("style"),bt=document.createElement("style"),xt=document.querySelectorAll(".flvjs>:last-child"),St=document.querySelectorAll(".hlsjs>:last-child"),y=0,wt=function(t,e){var i,n=0,o=[];e.forEach(function(t){n=t>n?t:n}),0==n&&(n=1);for(i in e)o.push(3*i+","+(20*(1-e[i]/n)+1)+" "+(3*i+3)+","+(20*(1-e[i]/n)+1));t.setAttribute("points",o.join(" "))},Ct=!1,At=U("#Player-Stats-Toggle"),Bt=function(t){"stats-close"==t.target.id&&t.stopPropagation(),U(".Player-Stats").style.display=Ct?"":"block",Ct=!Ct},Pt=!1;for(At[t]("click",Bt),U("#stats-close")[t]("click",Bt);y<60;y++)at.push(0),lt.push(0),rt.push(0),dt.push(0),ct.push(0),mt.push(0);if(Z.innerHTML=ft,Z=Z.querySelector("polyline"),K.innerHTML=ft,K.firstChild.lastChild.setAttribute("points","1,21 180,21 120,22 120,1"),K=K.querySelector("polyline"),$.innerHTML=ft,$.firstChild.lastChild.setAttribute("points","1,21 180,21 120,22 120,1"),$=$.querySelector("polyline"),tt.innerHTML=ft,tt=tt.querySelector("polyline"),et.innerHTML=ft,et=et.querySelector("polyline"),it.innerHTML=ft,it=it.firstChild.firstChild,ot.innerHTML=ft,ot=ot.firstChild.firstChild,void 0==v.videoWidth&&(q.videoDimension=!1,vt+="#video-dimension{display:none}"),void 0==v.getVideoPlaybackQuality&&(q.videoQuality=!1,vt+=".videoQuality{display:none}"),gt.innerHTML=vt,document.head.appendChild(gt),yt.innerHTML=".flvjs{display:none}",document.head.appendChild(yt),bt.innerHTML=".hlsjs{display:none}",document.head.appendChild(bt),setInterval(function(){Pt=!Pt,Y.innerHTML=v.offsetWidth+"x"+v.offsetHeight+" *"+devicePixelRatio,q.videoDimension&&(Q.innerHTML=v.videoWidth+"x"+v.videoHeight);var t={};try{t=g(v)}catch(t){}if(t=t.delta||0,at.push(t),at.shift(),pt.innerHTML=J(t)+"s",wt(Z,at),Ct){var e=v.buffered,i=U("#buffer-clips>span"),s=0,a=v.duration,l=[];(v.duration==1/0||v.duration>1e3*(e.end(e.length-1)+60))&&(s=e.start(0),a=e.end(e.length-1)-s);for(var r,c,m=0;m<e.length;m++)m>=i.childNodes.length&&i.appendChild(n("span",{className:"buffer-clip"})),r=e.start(m),c=e.end(m)-r,i.childNodes[m].style.left=J((r-s)/a*100)+"%",i.childNodes[m].style.width=J(c/a*100)+"%",l.push(d(0|r)+" - "+d(r+c|0));for(;m<i.childNodes.length;)i.childNodes[m].remove();i.parentNode.parentNode.childNodes[2].innerHTML=l.join("\n"),U("#buffer-clips>span>div").style.left=J(v.currentTime/a*100)+"%"}if(null!=player.flv){yt.textContent="";var h,u,m=0,p=player.flv._mediaInfo,f=player.flv.statisticsInfo,y=v.currentTime,b=player.flv._mediaDataSource.segments,x=0,S=0;for(u=0;u<b.length;u++){if(y<=(x+b[u].duration||1/0)/1e3){x=y-x/1e3|0;break}x+=b[u].duration,S++}if(Ct){for(var w=U("#buffer-clips>span:nth-of-type(2)"),C=w.children;C.length>b.length;)C[b.length].remove();for(;C.length<b.length;)w.appendChild(n("div",{style:{width:"1px",height:"300%",top:"-100%",position:"absolute",background:"#CCC",left:0}}));for(var A=1,B=0;A<b.length;A++)C[A].style.left=J((B+b[A-1].duration)/1e3/a*100)+"%",B+=b[A-1].duration}var P=f.currentSegmentIndex,N=b[P]||{};0|N.filesize,0|N.duration;if(xt[m++].textContent=p.videoCodec||"",xt[m++].textContent=p.audioCodec||"",xt[m++].textContent=J(p.fps),xt[m++].textContent=J(p.videoDataRate)+" kbps",xt[m++].textContent=J(p.audioDataRate)+" kbps",p.bitrateMap){var _=p.bitrateMap;if(_[S]&&(h=_[S][x]),void 0!=h?xt[m++].textContent=J(h)+" kbps":xt[m++].textContent="N/A",Ct){for(var k=[],T=S,M=x-40;M<0;){if(T--,!_[T]){T++;break}M+=_[T].length}for(;k.length<60;)void 0!=_[T]?(k.push(_[T][M]||0),M++,M>=_[T].length&&(T++,M=0)):k.push(0);wt(K,k)}}else xt[m++].textContent="N/A";Pt?("number"==typeof f.speed&&(rt.push(f.speed),rt.shift()),Ct&&wt(tt,rt),xt[m++].textContent=J(f.speed)+" KB/s",player.flv._statisticsInfo.speed=0):m++}else{yt.textContent=".flvjs{display:none}";for(var C=U("#buffer-clips>span:nth-of-type(2)").children;C.length>1;)C[1].remove()}if(null!=player.hls){bt.innerHTML="";var F,L=0,m=0;void 0!=player.hls.fragmentLoader.loaders.main&&(F=player.hls.fragmentLoader.loaders.main,F.stats.total&&(L=F.stats.loaded/F.stats.total*100)),U("#download-progress-hls").style.width=L+"%",St[m++].innerHTML=J(L)+"%";var _=hlsBitrateMonitor.levels.current.bitrateMap,h=_[0|v.currentTime];if(void 0!=h?St[m++].textContent=J(h)+" kbps":St[m++].textContent="N/A",Ct){for(var k=[],M=(0|v.currentTime)-40;k.length<60;)k.push(_[M]||0),M++;wt(K,k)}if(Pt){var H=player.hls.speed||0;dt.push(H),dt.shift(),Ct&&wt(et,dt),St[m++].innerHTML=J(H)+" KB/s"}}else bt.innerHTML=".hlsjs{display:none}";if(Pt&&(G.innerHTML=o.cmManager.canvasFPS),Pt&&q.videoQuality){var O=v.getVideoPlaybackQuality();ht>O.totalVideoFrames&&(ht=0),ut>O.droppedVideoFrames&&(ut=0);var E=O.totalVideoFrames-ht,D=O.droppedVideoFrames-ut;ht=O.totalVideoFrames,ut=O.droppedVideoFrames,ct.push(E),ct.shift(),mt.push(D),mt.shift(),Ct&&(wt(it,ct),wt(ot,mt)),nt.textContent=E+" fps",st.textContent=D+" fps "+(D/E*100).toFixed(2)+"%"}},500),"undefined"!=typeof CommentManager&&(o.cmManager=new CommentManager(o.divComment),o.cmManager.display=!0,o.cmManager.init(),o.cmManager.clear(),o.cmManager.filter.addModifier(shield.filter),o.cmManager.startTimer(),window&&window[t]("resize",function(){o.cmManager.setBounds()})),"object"==typeof ABP.playerConfig&&(ABP.playerConfig.volume&&(o.video.volume=ABP.playerConfig.volume),ABP.playerConfig.opacity&&(o.cmManager.options.global.opacity=ABP.playerConfig.opacity)),v.isBound!==!0){o.swapVideo(v),o.playerUnit.querySelector(".BiliPlus-Scale-Menu .Video-Defination")[t]("click",function(t){if(!t.target.hasAttribute("changeto"))return!1;var e=JSON.parse(t.target.getAttribute("changeto"));changeSrc({target:{value:e[1]}},e[0]),p(t.target.parentNode.querySelector(".on"),"on"),h(t.target,"on")}),o.playerUnit.querySelector(".BiliPlus-Scale-Menu .Video-Scale")[t]("click",function(t){
if(!t.target.hasAttribute("changeto"))return!1;switch(t.target.getAttribute("changeto")){case"default":u(o.video,"scale")&&p(o.video,"scale"),o.video.style.width="",o.video.style.height="",o.video.style.paddingTop="",o.video.style.paddingLeft="";break;case"16_9":h(o.video,"scale");var e=o.videoDiv.offsetWidth,i=o.videoDiv.offsetHeight,n="",s="";e<i/9*16?(n=(i-e/16*9)/2+"px",i=e/16*9/i*100+"%",e="100%"):(s=(e-i/9*16)/2+"px",e=i/9*16/e*100+"%",i="100%"),o.video.style.width=e,o.video.style.height=i,o.video.style.paddingTop=n,o.video.style.paddingLeft=s;break;case"4_3":h(o.video,"scale");var e=o.videoDiv.offsetWidth,i=o.videoDiv.offsetHeight,n="",s="";e<i/3*4?(n=(i-e/4*3)/2+"px",i=e/4*3/i*100+"%",e="100%"):(s=(e-i/3*4)/2+"px",e=i/3*4/e*100+"%",i="100%"),o.video.style.width=e,o.video.style.height=i,o.video.style.paddingTop=n,o.video.style.paddingLeft=s;break;case"full":h(o.video,"scale"),o.video.style.width="",o.video.style.height="",o.video.style.paddingTop="",o.video.style.paddingLeft=""}p(t.target.parentNode.querySelector(".on"),"on"),h(t.target,"on")});var Nt=0,_t=function(t){var e=Date.now();e-Nt<=500?o.btnFull.click():v.paused&&o.btnPlay.click(),Nt=e,t.preventDefault()};o.videoDiv[t]("click",_t),o.playerUnit.querySelector(".ABP-Bottom-Extend")[t]("click",function(t){t.preventDefault(),t.stopPropagation(),_t(t)});var kt=null;o.videoDiv[t]("mousemove",function(){kt&&window.clearTimeout(kt),u(o.videoDiv,"ABP-HideCursor")&&p(o.videoDiv,"ABP-HideCursor"),kt=window.setTimeout(function(){h(o.videoDiv,"ABP-HideCursor")},3e3)}),o.btnVolume[t]("click",function(){0==o.video.muted?(o.video.muted=!0,this.className="button ABP-Volume icon-volume-mute2",this.tooltip(ABP.Strings.unmute),o.barVolume.style.width="0%"):(o.video.muted=!1,this.className="button ABP-Volume icon-volume-",o.video.volume<.1?this.className+="mute":o.video.volume<.33?this.className+="low":o.video.volume<.67?this.className+="medium":this.className+="high",this.tooltip(ABP.Strings.mute),o.barVolume.style.width=100*o.video.volume+"%")}),o.btnWebFull[t]("click",function(){o.state.fullscreen=u(e,"ABP-FullScreen"),h(e,"ABP-FullScreen"),unsafeWindow&&unsafeWindow.player_fullwin&&unsafeWindow.player_fullwin(!0),o.btnFull.className="button ABP-FullScreen icon-screen-normal",o.btnFull.tooltip(ABP.Strings.exitWebFull),o.state.fullscreen=!0,o.cmManager&&o.cmManager.setBounds(),o.state.allowRescale&&(o.state.fullscreen?o.defaults.w>0&&(o.cmManager.options.scrollScale=e.offsetWidth/o.defaults.w):o.cmManager.options.scrollScale=1)});var Tt=!1,Mt=!1;o.btnFont[t]("click",function(t){Mt&&o.btnColor.click(),this.parentNode.classList.toggle("on"),Tt=!Tt}),o.btnColor[t]("click",function(t){Tt&&o.btnFont.click(),this.parentNode.classList.toggle("on"),Mt=!Mt}),o.btnAutoOpacity[t]("click",function(t){this.classList.toggle("on");var e=this.classList.contains("on");o.cmManager.autoOpacity(e),this.tooltip(e?ABP.Strings.autoOpacityOn:ABP.Strings.autoOpacityOff),s.autoOpacity()}),ABP.playerConfig.autoOpacity&&o.btnAutoOpacity.click(),o.btnProp[t]("click",function(t){this.classList.toggle("on");var e=this.classList.contains("on");o.cmManager.useCSS(e),this.tooltip(e?ABP.Strings.usingCSS:ABP.Strings.usingCanvas),s.useCSS()}),ABP.playerConfig.useCSS&&o.btnProp.click();var Ft=function(){!document.isFullScreen()&&u(e,"ABP-FullScreen")&&(p(e,"ABP-FullScreen"),o.btnFull.className="button ABP-FullScreen icon-screen-full",o.btnFull.tooltip(ABP.Strings.fullScreen),o.state.fullscreen=!!document.isFullScreen())};document[t]("fullscreenchange",Ft,!1),document[t]("webkitfullscreenchange",Ft,!1),document[t]("mozfullscreenchange",Ft,!1),document[t]("MSFullscreenChange",Ft,!1),o.btnFull[t]("click",function(){o.state.fullscreen=u(e,"ABP-FullScreen"),o.state.fullscreen?(p(e,"ABP-FullScreen"),unsafeWindow&&unsafeWindow.player_fullwin&&unsafeWindow.player_fullwin(!1),this.className="button ABP-FullScreen icon-screen-full",this.tooltip(ABP.Strings.fullScreen),document.exitFullscreen()):(h(e,"ABP-FullScreen"),this.className="button ABP-FullScreen icon-screen-normal",this.tooltip(ABP.Strings.exitFullScreen),e.requestFullScreen()),o.state.fullscreen=!o.state.fullscreen,o.cmManager&&o.cmManager.setBounds(),o.state.allowRescale&&(o.state.fullscreen?o.defaults.w>0&&(o.cmManager.options.scrollScale=e.offsetWidth/o.defaults.w):o.cmManager.options.scrollScale=1)}),o.btnWide[t]("click",function(){o.state.widescreen=u(e,"ABP-WideScreen"),o.state.widescreen?(p(e,"ABP-WideScreen"),this.className="button ABP-WideScreen icon-tv",e.dispatchEvent(new Event("normal")),this.tooltip(ABP.Strings.wideScreen)):(h(e,"ABP-WideScreen"),this.className="button ABP-WideScreen icon-tv on",e.dispatchEvent(new Event("wide")),this.tooltip(ABP.Strings.exitWideScreen)),o.state.widescreen=!o.state.widescreen,o.cmManager&&o.cmManager.setBounds(),o.state.allowRescale&&(o.state.fullscreen?o.defaults.w>0&&(o.cmManager.options.scrollScale=e.offsetWidth/o.defaults.w):o.cmManager.options.scrollScale=1)}),o.btnDm[t]("click",function(){0==o.cmManager.display?(o.cmManager.display=!0,o.cmManager.startTimer(),this.className="button ABP-CommentShow icon-comment on",this.tooltip(ABP.Strings.hideComment)):(o.cmManager.display=!1,o.cmManager.clear(),o.cmManager.stopTimer(),this.className="button ABP-CommentShow icon-comment",this.tooltip(ABP.Strings.showComment)),s.commentVisible()}),o.btnLoop[t]("click",function(){null!=player.flv&&(player.flv.unload(),player.flv.load(),o.video.currentTime=0,o.video.play())});var Lt=o.playerUnit.querySelector(".Context-Menu"),Ht=Lt.querySelector(".Context-Menu-Background"),Ot=Lt.querySelector(".Context-Menu-Body"),Et=function(t){return Ut?(t.preventDefault(),t.stopPropagation(),Ut=!1,!1):(Lt.style.display="none",void t.preventDefault())},Dt=function(t){for(var e=0,i=-1,e=0,n=o.commentObjArray.length;e<n;e++)if(o.commentObjArray[e].data.originalData.dbid==t){i=e;break}i!=-1&&(o.state.fullscreen&&o.btnFull.click(),o.state.widescreen&&o.btnWide.click(),o.commentListContainer.parentNode.scrollTop=24*i)},Wt=null,Rt=null,Vt=0,jt=null,It={},zt=function(){if(0!=Vt){if(void 0!=It[Vt])return void Ot.dispatchEvent(new CustomEvent("senderInfoFetched",{detail:It[Vt]}));var t=n("script",{className:"info_jsonp",src:"//account.bilibili.com/api/member/getCardByMid?type=jsonp&callback=getSenderInfo&mid="+Vt});document.body.appendChild(t)}},qt=function(e,i,s){Lt.style.display="block";var a,l,r,d,c,m=Ot.querySelectorAll(".dm"),h=o.playerUnit.getBoundingClientRect();for(y=m.length-2;y>=0;y--)m[y].remove();for(a=Ot.firstChild,y=0;y<s.length;y++){if(l=s[y].originalData,r=l.color.toString(16).padStart(6,"0"),d=16777215==l.color,c=n("div",{className:"dm"},[n("div",{className:"content"},[n("text",l.text)]),n("div",{className:"dmMenu"},[n("div",{"data-content":l.text},[n("text",ABP.Strings.copyComment)]),n("div",{"data-dmid":l.dbid},[n("text",ABP.Strings.findComment)]),n("div",{onclick:'shield.addText("'+l.text+'")'},[n("text",ABP.Strings.blockContent+"“"+l.text+"”")]),n("div",{"data-mid":crc_engine(l.hash),onclick:'shield.addUser("'+l.hash+'")'},[n("text",ABP.Strings.blockUser+""+l.hash+"(mid:"+crc_engine(l.hash)+")")]),n("div",d?{}:{onclick:'shield.addColor("'+r+'")'},[n("text",d?ABP.Strings.blockColorWhite:ABP.Strings.blockColor+""),n("div",{className:"color",style:{background:"#"+r}})])])]),l.mode>6){c.childNodes[0].innerHTML="特殊弹幕";var u=c.childNodes[1];u.childNodes[0].style.display="none",u.childNodes[2].style.display="none",u.childNodes[4].style.display="none"}Ot.insertBefore(c,a)}var p=Ot.querySelectorAll(".dmMenu");for(y=0;y<p.length-1;y++)p[y].childNodes[0][t]("click",function(){try{var t=document.createElement("input");t.style.width=0,t.style.height=0,document.body.appendChild(t),t.value=this.getAttribute("data-content"),t.select();var e=document.execCommand("copy");if(document.body.removeChild(t),!e)throw""}catch(t){o.createPopup(ABP.Strings.copyFail,3e3)}}),p[y].childNodes[1][t]("click",function(){Dt(this.getAttribute("data-dmid"))}),p[y].childNodes[3][t]("mouseenter",function(){Vt=this.getAttribute("data-mid"),jt=this,Wt=setTimeout(zt,500)}),p[y].childNodes[3][t]("mouseleave",function(){clearTimeout(Wt),Vt=0,jt=null,null!=document.getElementById("Sender-Info")&&(clearTimeout(Rt),Rt=setTimeout(function(){document.body.removeChild(document.getElementById("Sender-Info"))},500))});e-=h.left,i-=h.top,h.width-e<300&&(e=h.width-300),h.height-Ot.offsetHeight-i<0&&(i=h.height-Ot.offsetHeight);var f=Ot.querySelector(".dm:nth-last-of-type(2)>.dmMenu");if(null!=f){f.style.display="block";var v=f.getBoundingClientRect();f.style.display="",h.top+h.height-v.height-i<0&&(i=h.height-v.height)}Ot.style.left=e+"px",Ot.style.top=i+"px"},Ut=!1;Ot.querySelector("#Player-Speed-Control .dmMenu")[t]("click",function(t){var e=t.target.getAttribute("data-speed");void 0!=e&&(o.video.playbackRate=e)}),Ot[t]("senderInfoFetched",function(e){var i=e.detail;if(i.mid==Vt&&null!=jt){var o=jt.parentNode.getBoundingClientRect(),s=o.left-150,a=innerHeight-o.bottom,l=n("div",{className:"Context-Menu-Body",id:"Sender-Info",style:{left:s+"px",bottom:a+"px",position:"fixed",fontFamily:"-apple-system,Arial,'PingFang SC','STHeiti Light','Hiragino Kaku Gothic ProN','Microsoft YaHei'",textAlign:"center"}},[n("div",{},[n("img",{style:{height:"130px",width:"130px"},src:i.face.replace(/http\:/,"")})]),n("div",{},[n("text",i.name)]),n("div",{},[n("text",i.mid)]),n("div",{},[n("text","LV"+i.level_info.current_level)])]);document.body.appendChild(l),a+l.offsetHeight>innerHeight&&(l.style.bottom="",l.style.top=o.top+"px"),l[t]("click",function(){window.open("/space/"+i.mid+"/"),document.body.removeChild(l)}),l[t]("mouseenter",function(){clearTimeout(Rt)}),l[t]("mouseleave",function(){clearTimeout(Rt),Rt=setTimeout(function(){document.body.removeChild(document.getElementById("Sender-Info"))},500)})}}),window.getSenderInfo=function(t){0==t.code&&(It[Vt]=t.card,Ot.dispatchEvent(new CustomEvent("senderInfoFetched",{detail:t.card})))},Lt[t]("click",Et),Ht[t]("contextmenu",Et),o.videoDiv.parentNode[t]("contextmenu",function(t){t.preventDefault(),t.stopPropagation();var e=o.divComment.getBoundingClientRect(),i=t.clientX,n=t.clientY;qt(i,n,o.cmManager.getCommentFromPoint(i-e.left,n-e.top))}),o.commentListContainer[t]("contextmenu",function(t){var e=t.target.parentNode.data;return void 0!=e&&(t.preventDefault(),t.stopPropagation(),void qt(t.clientX,t.clientY,[e]))});var Jt=function(){o.playerUnit.dispatchEvent(new CustomEvent("saveconfig",{detail:{volume:o.video.volume,opacity:o.cmManager.options.global.opacity,scale:o.commentScale,prop:o.proportionalScale}}))},Xt=function(){var t=new Date,e=""+t.getTime()+Math.random();return""!=o.txtText.value&&!o.txtText.disabled&&(o.playerUnit.dispatchEvent(new CustomEvent("sendcomment",{detail:{id:e,message:o.txtText.value,fontsize:o.commentFontSize,color:parseInt("0x"+o.commentColor),date:t.getFullYear()+"-"+a(t.getMonth())+"-"+a(t.getDay())+" "+a(t.getHours())+":"+a(t.getMinutes())+":"+a(t.getSeconds()),playTime:o.video.currentTime,mode:o.commentMode,pool:0}})),o.cmManager.send({text:o.txtText.value,mode:o.commentMode,stime:o.video.currentTime,size:o.commentFontSize,color:parseInt("0x"+o.commentColor),border:!0}),o.commentList[e]={date:parseInt(t.getTime()/1e3),time:1e3*o.video.currentTime,mode:o.commentMode,user:"-",pool:0,content:o.txtText.value},o.txtText.value="",o.txtText.disabled=!0,void setTimeout(function(){o.txtText.disabled=!1},o.commentCoolDown))};o.txtText.parentNode[t]("submit",function(t){return t.preventDefault(),Xt(),!1}),o.btnSend[t]("click",Xt),o.timeLabel[t]("click",function(){o.timeJump=n("input",{className:"time-jump"}),o.timeJump.value=d(o.video.currentTime),o.controlBar.appendChild(o.timeJump),o.timeJump[t]("blur",function(){o.timeJump&&o.timeJump.parentNode.removeChild(o.timeJump),o.timeJump=null}),o.timeJump[t]("keydown",function(t){if(13==t.keyCode){var e=c(o.timeJump.value);e&&e<=o.video.duration&&(o.video.currentTime=e,o.video.paused&&o.btnPlay.click()),o.timeJump.parentNode.removeChild(o.timeJump)}else(t.keyCode<48||t.keyCode>59)&&(t.keyCode<96||t.keyCode>105)&&8!=t.keyCode&&16!=t.keyCode&&37!=t.keyCode&&39!=t.keyCode&&46!=t.keyCode&&t.preventDefault()}),o.timeJump.focus(),o.timeJump.select()}),o.barTime.style.width="0%",o.barFullScreenTime.style.width="0%";var Yt=!1;o.barTimeHitArea[t]("mousedown",function(t){Yt=!0}),document[t]("mouseup",function(t){if(Yt){var e=g(o.video),i=e.end-e.start,n=(t.clientX-o.barTimeHitArea.getBoundingClientRect().left)/o.barTimeHitArea.offsetWidth*i;n+=e.start,n<0&&(n=0),Math.abs(n-o.video.currentTime)>4&&o.cmManager&&o.cmManager.clear(),o.video.currentTime=n}Yt=!1});var Qt=function(t){var e=g(o.video),i=e.end-e.start,t=t-e.start;o.barTime.style.width=t/i*100+"%",o.barFullScreenTime.style.width=t/i*100+"%",o.timeLabel.innerHTML=d(t)+"/"+d(i)};document[t]("mousemove",function(t){var e=g(o.video),i=e.end,n=(t.clientX-o.barTimeHitArea.getBoundingClientRect().left)/o.barTimeHitArea.offsetWidth*i;n<0&&(n=0),n>i&&(n=i),o.barTimeHitArea.tooltip(d(n)),Yt&&Qt(n)}),m(o.barTimeHitArea,!0,-12);var Gt=!1;o.barVolumeHitArea[t]("mousedown",function(t){Gt=!0});var Zt=null,Kt=function(){Zt&&clearTimeout(Zt),h(e,"volume-show")},$t=function(){Zt=setTimeout(function(){p(e,"volume-show")},2e3)};o.barVolumeHitArea[t]("mouseenter",Kt),o.btnVolume[t]("mouseenter",Kt),o.barVolumeHitArea[t]("mouseleave",$t),o.btnVolume[t]("mouseleave",$t),o.barVolume.style.width=100*o.video.volume+"%";var te=function(t){o.barVolume.style.width=100*t+"%",o.video.muted=!1,o.btnVolume.className="button ABP-Volume icon-volume-",t<.1?o.btnVolume.className+="mute":t<.33?o.btnVolume.className+="low":t<.67?o.btnVolume.className+="medium":o.btnVolume.className+="high",o.btnVolume.tooltip(ABP.Strings.mute),o.barVolumeHitArea.tooltip(parseInt(100*t)+"%"),Jt()};document[t]("mouseup",function(t){if(Gt){var e=(t.clientX-o.barVolumeHitArea.getBoundingClientRect().left)/o.barVolumeHitArea.offsetWidth;e<0&&(e=0),e>1&&(e=1),o.video.volume=e,te(o.video.volume)}Gt=!1}),document[t]("mousemove",function(t){var e=(t.clientX-o.barVolumeHitArea.getBoundingClientRect().left)/o.barVolumeHitArea.offsetWidth;e<0&&(e=0),e>1&&(e=1),Gt?(o.video.volume=e,te(o.video.volume)):o.barVolumeHitArea.tooltip(parseInt(100*e)+"%")}),m(o.barVolumeHitArea,!0,-12);var ee=!1;o.barOpacityHitArea[t]("mousedown",function(t){ee=!0}),o.barOpacity.style.width=100*o.cmManager.options.global.opacity+"%";var ie=function(t){o.barOpacity.style.width=100*t+"%",o.barOpacityHitArea.tooltip(parseInt(100*t)+"%"),Jt()};document[t]("mouseup",function(t){if(ee){var e=(t.clientX-o.barOpacityHitArea.getBoundingClientRect().left)/o.barOpacityHitArea.offsetWidth;e<0&&(e=0),e>1&&(e=1),o.cmManager.options.global.opacity=e,ie(o.cmManager.options.global.opacity),s.opacity()}ee=!1}),document[t]("mousemove",function(t){var e=(t.clientX-o.barOpacityHitArea.getBoundingClientRect().left)/o.barOpacityHitArea.offsetWidth;e<0&&(e=0),e>1&&(e=1),ee?(o.cmManager.options.global.opacity=e,ie(o.cmManager.options.global.opacity)):o.barOpacityHitArea.tooltip(parseInt(100*e)+"%")}),m(o.barOpacityHitArea,!0,-6);var ne=!1;o.barScaleHitArea[t]("mousedown",function(t){ne=!0}),o.barScale.style.width=(o.commentScale-.2)/1.8*100+"%";var oe=function(t){o.barScale.style.width=(t-.2)/1.8*100+"%",o.barScaleHitArea.tooltip(parseInt(100*t)+"%"),o.cmManager.setBounds(),Jt()};document[t]("mouseup",function(t){if(ne){var e=.2+1.8*(t.clientX-o.barScaleHitArea.getBoundingClientRect().left)/o.barScaleHitArea.offsetWidth;e<.2&&(e=.2),e>2&&(e=2),o.commentScale=e,oe(o.commentScale),s.scale()}ne=!1}),document[t]("mousemove",function(t){var e=.2+1.8*(t.clientX-o.barScaleHitArea.getBoundingClientRect().left)/o.barScaleHitArea.offsetWidth;e<.2&&(e=.2),e>2&&(e=2),ne?(o.commentScale=e,oe(o.commentScale)):o.barScaleHitArea.tooltip(parseInt(100*e)+"%")}),m(o.barScaleHitArea,!0,-6);var se=!1;o.barSpeedHitArea[t]("mousedown",function(t){se=!0}),o.barSpeed.style.width=(o.commentSpeed-.5)/1.5*100+"%";var ae=function(t){o.barSpeed.style.width=(t-.5)/1.5*100+"%",o.barSpeedHitArea.tooltip(parseInt(100*t)+"%"),o.cmManager.setBounds(),Jt()};document[t]("mouseup",function(t){if(se){var e=.5+1.5*(t.clientX-o.barSpeedHitArea.getBoundingClientRect().left)/o.barSpeedHitArea.offsetWidth;e<.5&&(e=.5),e>2&&(e=2),o.commentSpeed=e,ae(o.commentSpeed),s.speed()}se=!1}),document[t]("mousemove",function(t){var e=.5+1.5*(t.clientX-o.barSpeedHitArea.getBoundingClientRect().left)/o.barSpeedHitArea.offsetWidth;e<.5&&(e=.5),e>2&&(e=2),se?(o.commentSpeed=e,ae(o.commentSpeed)):o.barSpeedHitArea.tooltip(parseInt(100*e)+"%")}),m(o.barSpeedHitArea,!0,-6),o.btnPlay[t]("click",function(){o.video.paused?(o.video.play(),this.className="button ABP-Play ABP-Pause icon-pause",this.tooltip(ABP.Strings.pause)):(o.video.pause(),this.className="button ABP-Play icon-play",this.tooltip(ABP.Strings.play))}),e[t]("keydown",function(t){if(t&&"INPUT"!=document.activeElement.tagName)switch([27,32,37,38,39,40].indexOf(t.keyCode)!=-1&&t.preventDefault(),t.keyCode){case 27:abpinst.state.fullscreen&&abpinst.btnFull.click();break;case 32:o.btnPlay.click();break;case 37:var e=o.video.currentTime-=5*o.video.playbackRate;o.cmManager.clear(),e<g(o.video).start&&(e=g(o.video).start),o.video.currentTime=e.toFixed(3),o.video.paused&&o.btnPlay.click(),Qt(v.currentTime),o.barTimeHitArea.tooltip(d(v.currentTime));break;case 39:var e=o.video.currentTime+=5*o.video.playbackRate;o.cmManager.clear(),e>g(o.video).end&&(e=g(o.video).end-1),o.video.currentTime=e.toFixed(3),o.video.paused&&o.btnPlay.click(),Qt(v.currentTime),o.barTimeHitArea.tooltip(d(v.currentTime));break;case 38:var i=o.video.volume+.1;i>1&&(i=1),o.video.volume=i.toFixed(3),te(o.video.volume);break;case 40:var i=o.video.volume-.1;i<0&&(i=0),o.video.volume=i.toFixed(3),te(o.video.volume)}}),e[t]("mouseup",function(){if("INPUT"!=document.activeElement.tagName){var t=window.scrollY;o.videoDiv.focus(),window.scrollTo(window.scrollX,t)}})}if("undefined"!=typeof CommentManager&&o.state.autosize){var le=function(){if(0!==v.videoHeight&&0!==v.videoWidth){var t=v.videoHeight/v.videoWidth,i=e.offsetWidth,n=e.offsetHeight,s=n/i;s<t?(e.style.width=n/t+"px",e.style.height=n+"px"):(e.style.width=i+"px",e.style.height=i*t+"px"),o.cmManager.setBounds()}};v[t]("loadedmetadata",le),le()}return shield.init(o),shield.shield(),dots.init({id:"dots",width:"100%",height:"100%",r:16,thick:4}),o}}}}}}}}}}}}}}}}}}}}}}}}}}})();