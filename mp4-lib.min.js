/**
 * MP4 Parser
 * @author esterTion
 * https://github.com/esterTion/flv.js/blob/master/src/demux/mp4-demuxer.js
 * 
 */
/**
 * avl v1.4.4
 * Fast AVL tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function ReadBig16(e,r){return e[r]<<8|e[r+1]}function ReadBig32(e,r){return 65536*ReadBig16(e,r)+ReadBig16(e,r+2)}function ReadBig64(e,r){return 4294967296*ReadBig32(e,r)+ReadBig32(e,r+4)}function ReadString(e,r,t){for(var a=[],i=0;i<t;i++)a.push(e[r+i]);try{return decodeURIComponent(escape(String.fromCharCode.apply(null,a)))}catch(e){return""}}function esdsParse(e,r,t){for(var a=r[t],i=1,n=0,o=r[t+i];128&o;)n=(127&o)<<7,i++,o=r[t+i];switch(n+=127&o,i++,a){case 3:var s=ReadBig16(r,t+i);r[t+i+2];i+=3,e[esdsIDs[a]]={size:n,trackID:s},esdsParse(e[esdsIDs[a]],r,t+i);break;case 4:var f=r[t+i],l=r[t+i+1],u=16777215&ReadBig32(r,t+i+1),c=ReadBig32(r,t+i+5),d=ReadBig32(r,t+i+9);e[esdsIDs[a]]={oti:f,streamType:l,bufferSize:u,maxBitrate:c,avgBitrate:d},esdsParse(e[esdsIDs[a]],r,t+i+13);break;case 5:var h=Array.from(new Uint8Array(r.buffer,r.byteOffset+t+i,n)),p=h[0]>>>3,g=(7&h[0])<<1|h[1]>>>7,y=(120&h[1])>>>3;e[esdsIDs[a]]={data:h,originalAudioObjectType:p,samplingIndex:g,channelConfig:y}}}function parseMoov(e,r,t,a){for(var i=0;i<a;){var n=boxInfo(r,t+i);if(containerBox.indexOf(n.name)!==-1)e[n.name]=e[n.name]||[],e[n.name].push({}),parseMoov(e[n.name][e[n.name].length-1],r,t+i+8,n.size-8);else{var o=void 0;switch(n.name){case"mvhd":o=new Uint8Array(r.buffer,r.byteOffset+t+i+8,n.size-8);var s=o[0],f=ReadBig32(o,1==s?20:12),l=1==s?ReadBig64(o,24):ReadBig32(o,16);e[n.name]={version:s,timeScale:f,duration:l};break;case"tkhd":o=new Uint8Array(r.buffer,r.byteOffset+t+i+8,n.size-8);var u={trackEnbaled:1&o[3],trackInMovie:(2&o[3])>>1,trackInPreview:(4&o[3])>>2,trackInPoster:(8&o[3])>>3},c=ReadBig32(o,12),d=ReadBig32(o,20),h=ReadBig16(o,34),p=parseFloat(ReadBig16(o,72)+"."+ReadBig16(o,74)),g=parseFloat(ReadBig16(o,76)+"."+ReadBig16(o,78));e[n.name]={flags:u,trackID:c,duration:d,group:h,trackWidth:p,trackHeight:g};break;case"mdhd":o=new Uint8Array(r.buffer,r.byteOffset+t+i+8,n.size-8);var y=o[0],b=1==y?24:16,_=(1==y?ReadBig64:ReadBig32)(o,b);b+=1==y?8:4;var v=ReadBig16(o,b);e[n.name]={version:y,duration:_,language:v};break;case"stsd":e[n.name]=e[n.name]||[],e[n.name].push({}),parseMoov(e[n.name][e[n.name].length-1],r,t+i+16,n.size-16);break;case"avc1":o=new Uint8Array(r.buffer,r.byteOffset+t+i+8,n.size-8);var B=ReadBig32(o,4),m=ReadBig16(o,8),k=ReadBig16(o,10),R=ReadBig32(o,12),w=ReadBig32(o,16),U=ReadBig32(o,20),z=ReadBig16(o,24),S=ReadBig16(o,26),F=parseFloat(ReadBig16(o,28)+"."+ReadBig16(o,30)),x=parseFloat(ReadBig16(o,32)+"."+ReadBig16(o,34)),E=ReadBig32(o,36),A=ReadBig16(o,40),G=ReadString(o,42,32),C=ReadBig16(o,74),O=ReadBig16(o,76);e[n.name]={dataReferenceIndex:B,version:m,revisionLevel:k,vendor:R,temporalQuality:w,spatialQuality:U,width:z,height:S,horizontalResolution:F,verticalResolution:x,dataSize:E,frameCount:A,compressorName:G,depth:C,colorTableID:O,extensions:{}},parseMoov(e[n.name].extensions,r,t+i+86,n.size-86);break;case"avcC":o=new Uint8Array(r.buffer,r.byteOffset+t+i+8,n.size-8);for(var I=o[0],D=o[1],P=o[2],L=o[3],M=3&o[4],T=31&o[5],j=new Array(T),H=void 0,W=6,V=0;V<T;V++){H=ReadBig16(o,W),W+=2,j[V]=SPSParser.parseSPS(new Uint8Array(r.buffer,r.byteOffset+t+i+8+W,H));for(var N="avc1.",Z=o.subarray(W+1,W+4),Q=0;Q<3;Q++){var q=Z[Q].toString(16);q.length<2&&(q="0"+q),N+=q}j[V].codecString=N,W+=H}T=o[W];new Array(T);W++;for(var J=0;J<T;J++)H=ReadBig16(o,i),W+=2,W+=H;e[n.name]={configurationVersion:I,avcProfileIndication:D,profile_compatibility:P,AVCLevelIndication:L,lengthSizeMinusOne:M,SPS:j,data:o};break;case"mp4a":o=new Uint8Array(r.buffer,r.byteOffset+t+i+8,n.size-8);var K=ReadBig32(o,4),X=ReadBig16(o,8),Y=ReadBig16(o,10),$=ReadBig32(o,12),ee=ReadBig16(o,16),re=ReadBig16(o,18),te=ReadBig16(o,20),ae=ReadBig16(o,22),ie=ReadBig16(o,24);e[n.name]={dataReferenceIndex:K,version:X,revisionLevel:Y,vendor:$,channels:ee,sampleSize:re,compressionID:te,packetSize:ae,sampleRate:ie,extensions:{}},parseMoov(e[n.name].extensions,r,t+i+36,n.size-36);break;case"esds":o=new Uint8Array(r.buffer,r.byteOffset+t+i+8,n.size-8);var ne={};esdsParse(ne,o,4),e[n.name]=ne;break;case"stts":o=new Uint8Array(r.buffer,r.byteOffset+t+i+12,n.size-12);for(var oe=ReadBig32(o,0),se=[],fe=4,le=0;le<oe;le++){var ue=ReadBig32(o,fe),ce=ReadBig32(o,fe+4);se.push({sampleCount:ue,sampleDuration:ce}),fe+=8}e[n.name]=se;break;case"ctts":o=new Uint8Array(r.buffer,r.byteOffset+t+i+12,n.size-12);for(var de=ReadBig32(o,0),he=[],pe=4,ge=0;ge<de;ge++){var ye=ReadBig32(o,pe),be=ReadBig32(o,pe+4);he.push({sampleCount:ye,compositionOffset:be}),pe+=8}e[n.name]=he;break;case"stss":o=new Uint8Array(r.buffer,r.byteOffset+t+i+12,n.size-12);for(var _e=ReadBig32(o,0),ve=new Uint32Array(_e),Be=4,me=0;me<_e;me++)ve[me]=ReadBig32(o,Be),Be+=4;e[n.name]=ve;break;case"stsc":o=new Uint8Array(r.buffer,r.byteOffset+t+i+12,n.size-12);for(var ke=ReadBig32(o,0),Re=[],we=4,Ue=0;Ue<ke;Ue++){var ze=ReadBig32(o,we),Se=ReadBig32(o,we+4),Fe=ReadBig32(o,we+8);Re.push({firstChunk:ze,samplesPerChunk:Se,sampleDescID:Fe}),we+=12}e[n.name]=Re;break;case"stsz":o=new Uint8Array(r.buffer,r.byteOffset+t+i+12,n.size-12);for(var xe=ReadBig32(o,0),Ee=ReadBig32(o,4),Ae=new Uint32Array(Ee),Ge=8,Ce=0;Ce<Ee;Ce++)Ae[Ce]=ReadBig32(o,Ge),Ge+=4;e[n.name]={sampleSize:xe,sampleTable:Ae};break;case"stco":o=new Uint8Array(r.buffer,r.byteOffset+t+i+12,n.size-12);for(var Oe=ReadBig32(o,0),Ie=new Uint32Array(Oe),De=4,Pe=0;Pe<Oe;Pe++)Ie[Pe]=ReadBig32(o,De),De+=4;e[n.name]=Ie;break;case"co64":o=new Uint8Array(r.buffer,r.byteOffset+t+i+12,n.size-12);for(var Le=ReadBig32(o,0),Me=new Float64Array(Le),Te=4,je=0;je<Le;je++)Me[je]=ReadBig64(o,Te),Te+=8;e.stco=Me;break;case"hdlr":o=new Uint8Array(r.buffer,r.byteOffset+t+i+12,n.size-12);var He=ReadString(o,4,4);e[n.name]={handler:He};break;case"tfdt":o=new Uint8Array(r.buffer,r.byteOffset+t+i+8,n.size-8);var We=o[0],Ve=(1==We?ReadBig64:ReadBig32)(o,4);e.tfdt={baseMediaDecodeTime:Ve};break;case"trun":o=new Uint8Array(r.buffer,r.byteOffset+t+i+12,n.size-12);for(var Ne=ReadBig32(o,0),Ze=new Uint32Array(Ne),Qe=new Uint32Array(Ne),qe=8,Je=0;Je<Ne;Je++)Ze[Je]=ReadBig32(o,qe),Qe[Je]=ReadBig32(o,qe+4),qe+=16;e.trun={sampleCount:Ne,durations:Ze,sizes:Qe}}}i+=n.size}}function boxInfo(e,r){var t=ReadBig32(e,r),a=ReadString(e,r+4,4),i=8;1==t&&(t=ReadBig64(e,r+8),i=16);var n=e.length>=r+t;return 0==t?{size:8,headSize:i,name:"",fullyLoaded:!0}:{size:t,headSize:i,name:a,fullyLoaded:n}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,t,a){return t&&e(r.prototype,t),a&&e(r,a),r}}(),esdsIDs={3:"esDescription",4:"decConfigDescription",5:"decSpecificDescription"},SPSParser=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var r=e,t=r.byteLength,a=new Uint8Array(t),i=0,n=0;n<t;n++)n>=2&&3===r[n]&&0===r[n-1]&&0===r[n-2]||(a[i]=r[n],i++);return new Uint8Array(a.buffer,0,i)}},{key:"parseSPS",value:function(r){var t=e._ebsp2rbsp(r),a=new ExpGolomb(t);a.readByte();var i=a.readByte();a.readByte();var n=a.readByte();a.readUEG();var o=e.getProfileString(i),s=e.getLevelString(n),f=1,l=420,u=[0,420,422,444],c=8;if((100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||144===i)&&(f=a.readUEG(),3===f&&a.readBits(1),f<=3&&(l=u[f]),c=a.readUEG()+8,a.readUEG(),a.readBits(1),a.readBool()))for(var d=3!==f?8:12,h=0;h<d;h++)a.readBool()&&(h<6?e._skipScalingList(a,16):e._skipScalingList(a,64));a.readUEG();var p=a.readUEG();if(0===p)a.readUEG();else if(1===p){a.readBits(1),a.readSEG(),a.readSEG();for(var g=a.readUEG(),y=0;y<g;y++)a.readSEG()}a.readUEG(),a.readBits(1);var b=a.readUEG(),_=a.readUEG(),v=a.readBits(1);0===v&&a.readBits(1),a.readBits(1);var B=0,m=0,k=0,R=0,w=a.readBool();w&&(B=a.readUEG(),m=a.readUEG(),k=a.readUEG(),R=a.readUEG());var U=1,z=1,S=0,F=!0,x=0,E=0,A=a.readBool();if(A){if(a.readBool()){var G=a.readByte(),C=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],O=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];G>0&&G<16?(U=C[G-1],z=O[G-1]):255===G&&(U=a.readByte()<<8|a.readByte(),z=a.readByte()<<8|a.readByte())}if(a.readBool()&&a.readBool(),a.readBool()&&(a.readBits(4),a.readBool()&&a.readBits(24)),a.readBool()&&(a.readUEG(),a.readUEG()),a.readBool()){var I=a.readBits(32),D=a.readBits(32);F=a.readBool(),x=D,E=2*I,S=x/E}}var P=1;1===U&&1===z||(P=U/z);var L=0,M=0;if(0===f)L=1,M=2-v;else{var T=3===f?1:2,j=1===f?2:1;L=T,M=j*(2-v)}var H=16*(b+1),W=(2-v)*(16*(_+1));H-=(B+m)*L,W-=(k+R)*M;var V=Math.ceil(H*P);return a.destroy(),a=null,{profile_string:o,level_string:s,bit_depth:c,chroma_format:l,chroma_format_string:e.getChromaFormatString(l),frame_rate:{fixed:F,fps:S,fps_den:E,fps_num:x},sar_ratio:{width:U,height:z},codec_size:{width:H,height:W},present_size:{width:V,height:W}}}},{key:"_skipScalingList",value:function(e,r){for(var t=8,a=8,i=0,n=0;n<r;n++)0!==a&&(i=e.readSEG(),a=(t+i+256)%256),t=0===a?t:a}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),e}(),ExpGolomb=function(){function e(r){_classCallCheck(this,e),this.TAG="ExpGolomb",this._buffer=r,this._buffer_index=0,this._total_bytes=r.byteLength,this._total_bits=8*r.byteLength,this._current_word=0,this._current_word_bits_left=0}return _createClass(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var r=Math.min(4,e),t=new Uint8Array(4);t.set(this._buffer.subarray(this._buffer_index,this._buffer_index+r)),this._current_word=new DataView(t.buffer).getUint32(0,!1),this._buffer_index+=r,this._current_word_bits_left=8*r}},{key:"readBits",value:function(e){if(e>32)throw new InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var r=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,r}var t=this._current_word_bits_left?this._current_word:0;t>>>=32-this._current_word_bits_left;var a=e-this._current_word_bits_left;this._fillCurrentWord();var i=Math.min(a,this._current_word_bits_left),n=this._current_word>>>32-i;return this._current_word<<=i,this._current_word_bits_left-=i,t=t<<i|n}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._current_word_bits_left;e++)if(0!==(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}(),containerBox=["moov","trak","mdia","minf","stbl","moof","traf"];(function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.AVLTree=r()})(this,function(){function e(e,t){void 0===t&&(t=function(e){return e.key});var a=[];return r(e,"",!0,function(e){return a.push(e)},t),a.join("")}function r(e,t,a,i,n){if(e){i(""+t+(a?"└── ":"├── ")+n(e)+"\n");var o=t+(a?"    ":"│   ");e.left&&r(e.left,o,!1,i,n),e.right&&r(e.right,o,!0,i,n)}}function t(e){if(null===e)return!0;var r=a(e.left),i=a(e.right);return!!(Math.abs(r-i)<=1&&t(e.left)&&t(e.right))}function a(e){return e?1+Math.max(a(e.left),a(e.right)):0}function i(e,r,t,a,n){var o=n-a;if(o>0){var s=a+Math.floor(o/2),f=r[s],l=t[s],u={key:f,data:l,parent:e};return u.left=i(u,r,t,a,s),u.right=i(u,r,t,s+1,n),u}return null}function n(e){if(null===e)return 0;var r=n(e.left),t=n(e.right);return e.balanceFactor=r-t,Math.max(r,t)+1}function o(e,r,t,a,i){if(!(t>=a)){for(var n=e[t+a>>1],s=t-1,f=a+1;;){do s++;while(i(e[s],n)<0);do f--;while(i(e[f],n)>0);if(s>=f)break;var l=e[s];e[s]=e[f],e[f]=l,l=r[s],r[s]=r[f],r[f]=l}o(e,r,t,f,i),o(e,r,f+1,a,i)}}function s(e,r){return e>r?1:e<r?-1:0}function f(e){var r=e.right;return e.right=r.left,r.left&&(r.left.parent=e),r.parent=e.parent,r.parent&&(r.parent.left===e?r.parent.left=r:r.parent.right=r),e.parent=r,r.left=e,e.balanceFactor+=1,r.balanceFactor<0&&(e.balanceFactor-=r.balanceFactor),r.balanceFactor+=1,e.balanceFactor>0&&(r.balanceFactor+=e.balanceFactor),r}function l(e){var r=e.left;return e.left=r.right,e.left&&(e.left.parent=e),r.parent=e.parent,r.parent&&(r.parent.left===e?r.parent.left=r:r.parent.right=r),e.parent=r,r.right=e,e.balanceFactor-=1,r.balanceFactor>0&&(e.balanceFactor-=r.balanceFactor),r.balanceFactor-=1,e.balanceFactor<0&&(r.balanceFactor+=e.balanceFactor),r}var u=function(e,r){void 0===r&&(r=!1),this._comparator=e||s,this._root=null,this._size=0,this._noDuplicates=!!r},c={size:{configurable:!0}};return u.prototype.destroy=function(){return this.clear()},u.prototype.clear=function(){return this._root=null,this._size=0,this},c.size.get=function(){return this._size},u.prototype.contains=function(e){if(this._root)for(var r=this._root,t=this._comparator;r;){var a=t(e,r.key);if(0===a)return!0;r=a<0?r.left:r.right}return!1},u.prototype.next=function(e){var r=e;if(r)if(r.right)for(r=r.right;r.left;)r=r.left;else for(r=e.parent;r&&r.right===e;)e=r,r=r.parent;return r},u.prototype.prev=function(e){var r=e;if(r)if(r.left)for(r=r.left;r.right;)r=r.right;else for(r=e.parent;r&&r.left===e;)e=r,r=r.parent;return r},u.prototype.forEach=function(e){for(var r=this._root,t=[],a=!1,i=0;!a;)r?(t.push(r),r=r.left):t.length>0?(r=t.pop(),e(r,i++),r=r.right):a=!0;return this},u.prototype.range=function(e,r,t,a){for(var i,n=this,o=[],s=this._comparator,f=this._root;0!==o.length||f;)if(f)o.push(f),f=f.left;else{if(f=o.pop(),i=s(f.key,r),i>0)break;if(s(f.key,e)>=0&&t.call(a,f))return n;f=f.right}return this},u.prototype.keys=function(){for(var e=this._root,r=[],t=[],a=!1;!a;)e?(r.push(e),e=e.left):r.length>0?(e=r.pop(),t.push(e.key),e=e.right):a=!0;return t},u.prototype.values=function(){for(var e=this._root,r=[],t=[],a=!1;!a;)e?(r.push(e),e=e.left):r.length>0?(e=r.pop(),t.push(e.data),e=e.right):a=!0;return t},u.prototype.at=function(e){for(var r=this._root,t=[],a=!1,i=0;!a;)if(r)t.push(r),r=r.left;else if(t.length>0){if(r=t.pop(),i===e)return r;i++,r=r.right}else a=!0;return null},u.prototype.minNode=function(){var e=this._root;if(!e)return null;for(;e.left;)e=e.left;return e},u.prototype.maxNode=function(){var e=this._root;if(!e)return null;for(;e.right;)e=e.right;return e},u.prototype.min=function(){var e=this._root;if(!e)return null;for(;e.left;)e=e.left;return e.key},u.prototype.max=function(){var e=this._root;if(!e)return null;for(;e.right;)e=e.right;return e.key},u.prototype.isEmpty=function(){return!this._root},u.prototype.pop=function(){var e=this._root,r=null;if(e){for(;e.left;)e=e.left;r={key:e.key,data:e.data},this.remove(e.key)}return r},u.prototype.find=function(e){for(var r,t=this._root,a=t,i=this._comparator;a;){if(r=i(e,a.key),0===r)return a;a=r<0?a.left:a.right}return null},u.prototype.insert=function(e,r){var t=this;if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:e,data:r},this._size++,this._root;var a=this._comparator,i=this._root,n=null,o=0;if(this._noDuplicates)for(;i;){if(o=a(e,i.key),n=i,0===o)return null;i=o<0?i.left:i.right}else for(;i;)o=a(e,i.key),n=i,i=o<=0?i.left:i.right;var s,u={left:null,right:null,balanceFactor:0,parent:n,key:e,data:r};for(o<=0?n.left=u:n.right=u;n&&(o=a(n.key,e),o<0?n.balanceFactor-=1:n.balanceFactor+=1,0!==n.balanceFactor);){if(n.balanceFactor<-1){1===n.right.balanceFactor&&l(n.right),s=f(n),n===t._root&&(t._root=s);break}if(n.balanceFactor>1){n.left.balanceFactor===-1&&f(n.left),s=l(n),n===t._root&&(t._root=s);break}n=n.parent}return this._size++,u},u.prototype.remove=function(e){var r=this;if(!this._root)return null;for(var t=this._root,a=this._comparator,i=0;t&&(i=a(e,t.key),0!==i);)t=i<0?t.left:t.right;if(!t)return null;var n,o,s=t.key;if(t.left){for(n=t.left;n.left||n.right;){for(;n.right;)n=n.right;t.key=n.key,t.data=n.data,n.left&&(t=n,n=n.left)}t.key=n.key,t.data=n.data,t=n}if(t.right){for(o=t.right;o.left||o.right;){for(;o.left;)o=o.left;t.key=o.key,t.data=o.data,o.right&&(t=o,o=o.right)}t.key=o.key,t.data=o.data,t=o}for(var u,c=t.parent,d=t;c&&(c.left===d?c.balanceFactor-=1:c.balanceFactor+=1,c.balanceFactor<-1?(1===c.right.balanceFactor&&l(c.right),u=f(c),c===r._root&&(r._root=u),c=u):c.balanceFactor>1&&(c.left.balanceFactor===-1&&f(c.left),u=l(c),c===r._root&&(r._root=u),c=u),c.balanceFactor!==-1&&1!==c.balanceFactor);)d=c,c=c.parent;return t.parent&&(t.parent.left===t?t.parent.left=null:t.parent.right=null),t===this._root&&(this._root=null),this._size--,s},u.prototype.load=function(e,r,t){if(void 0===e&&(e=[]),void 0===r&&(r=[]),0!==this._size)throw new Error("bulk-load: tree is not empty");var a=e.length;return t&&o(e,r,0,a-1,this._comparator),this._root=i(null,e,r,0,a),n(this._root),this._size=a,this},u.prototype.isBalanced=function(){return t(this._root)},u.prototype.toString=function(r){return e(this._root,r)},Object.defineProperties(u.prototype,c),u.default=u,u});